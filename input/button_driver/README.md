# 触控按键驱动 - MicroPython版本
## 目录
- [简介](#简介)
- [主要功能](#主要功能)
- [硬件要求](#硬件要求)
- [文件说明](#文件说明)
- [软件设计核心思想](#软件设计核心思想)
- [使用说明](#使用说明)
- [示例程序](#示例程序)
- [注意事项](#注意事项)
- [联系方式](#联系方式)
- [许可协议](#许可协议)
---

## 简介

触控按键是一种基于电容感应或触摸传感芯片实现的输入设备，能够检测人体手指触碰并输出数字信号。相比传统机械按键，触控按键具有无机械磨损、响应灵敏、寿命长等优点，广泛应用于家电控制面板、灯具开关、多媒体交互等场景。
本项目提供基于 MicroPython 的驱动代码，封装 GPIO 读取、状态检测与事件回调功能，支持快速集成。

> **注意**：适用于常见电容式触控模块（如 TTP223 系列），不适用于需要模拟位置检测的电位器或高精度电容传感器。

---

## 主要功能

* 读取 GPIO 数字电平（0/1），判断触摸状态（触摸/未触摸）
* 支持轮询或事件回调方式检测按键状态
* 聚合返回完整状态数据，接口简洁，适配多种触控模块

---

## 硬件要求

### 推荐测试硬件

* MicroPython 开发板（如树莓派 Pico）
* 电容式触控按键模块（如 TTP223）
* 杜邦线 3 根、（可选）面包板

### 模块引脚说明

| 触控按键模块引脚 | 功能描述 | 连接说明                 |
| -------- | ---- | -------------------- |
| VCC      | 电源输入 | 接开发板 3.3V（部分模块支持 5V） |
| OUT      | 信号输出 | 接开发板 GPIO 输入引脚       |
| GND      | 接地   | 接开发板 GND             |

---

## 文件说明
### touchkey.py

该文件实现 **触控/机械按键** 的核心驱动功能，仅包含 `TouchKey` 类，用于处理按键信号读取、防抖和状态管理。

`TouchKey` 类通过封装 GPIO 输入与定时器防抖逻辑，提供按键状态检测、事件回调等功能。类中包含以下主要属性：

* `_pin`：用于存储 GPIO 引脚对象，负责读取按键输出信号。
* `_idle_state`：定义空闲状态电平（高电平=1 或 低电平=0），用于区分按下/释放状态。
* `_debounce_time`：防抖时间（单位 ms，默认 50），避免机械按键或触摸抖动导致的误判。

类的主要方法包括：

* `__init__(pin_num: int, idle_state: int, debounce_time: int = 50, press_callback: callable = None, release_callback: callable = None)`
  初始化驱动对象，绑定 GPIO 引脚，设置空闲状态、防抖时间和回调函数。
* `_irq_handler(pin)`
  中断触发函数，用于捕获电平变化并启动防抖定时器。
* `_debounce_handler()`
  定时器防抖处理函数，在设定的延时后确认电平变化，触发回调。
* `get_state() -> bool`
  返回当前按键逻辑状态（True = 按下，False = 释放）。

该类支持 **机械按键** 与 **电容触控模块（如 TTP223）**，通过调整 `idle_state` 参数即可兼容不同默认电平逻辑。

---

### main.py

该文件为 **触控按键的功能测试程序**，无自定义类，仅包含程序入口逻辑。

主程序功能：

* 初始化与触控按键模块连接的 GPIO 引脚。
* 创建 `TouchKey` 驱动实例，并传入回调函数 `on_press` / `on_release`。
* 在循环中周期性调用 `get_state()` 方法，实时打印按键状态（Pressed / Released）。
* 支持通过 `Ctrl+C` 手动终止测试。

该程序可用于验证按键硬件连接正确性、防抖逻辑与回调触发功能是否正常。

---

## 软件设计核心思想

* **模块化**：按键检测与应用逻辑解耦，核心功能封装在 `TouchKey` 类中，测试程序保持简洁。
* **防抖适配**：通过中断 + 定时器实现防抖，避免因触摸/机械抖动导致的误触发。
* **硬件兼容**：支持机械按键和电容触控模块，用户可通过 `idle_state` 参数灵活适配。
* **事件驱动**：支持按下/释放回调，方便扩展为应用层的交互事件。

---

## 使用说明
### 硬件接线（树莓派 Pico 示例）

| 触控按键模块引脚 | Pico引脚                      | 接线功能   |
| -------- | --------------------------- | ------ |
| VCC      | 3.3V（Pin36）                 | 电源输入   |
| OUT      | GP15（Pin21，可更换任意 GPIO 输入引脚） | 按键信号输入 |
| GND      | GND（Pin38）                  | 接地     |
---
### 软件依赖

* 固件：MicroPython v1.23+
* 内置库：`machine`（GPIO 控制）、`time`（延时）、`utime`（可选）
* 开发工具：Thonny / PyCharm / mpremote
---
### 安装步骤

1. 烧录 MicroPython 固件到开发板
2. 上传 `touchkey.py` 和 `main.py` 到开发板
3. 修改 `main.py` 中 `pin_num=15` 为实际接线的 GPIO 引脚
4. 运行 `main.py`，触摸按键模块，观察串口输出 **Pressed / Released** 状态变化

---

## 示例程序
```python
# Python env   : MicroPython v1.23.0
# -*- coding: utf-8 -*-
# @Time    : 2025/8/28 上午11:22
# @Author  : ben0i0d
# @File    : main.py
# @Description : 触控按键驱动测试文件

# ======================================== 导入相关模块 =========================================

# 导入时间相关模块
import time
# 导入按钮驱动模块
from touchkey import TouchKey

# ======================================== 全局变量 ============================================

# ======================================== 功能函数 ============================================

def on_press():
    print("Button pressed")

def on_release():
    print("Button released")

# ======================================== 自定义类 ============================================

# ======================================== 初始化配置 ===========================================

# 上电延时3s
time.sleep(3)
print("FreakStudio:Testing Button")

# 创建 TouchKey 对象
button = TouchKey(pin_num=15, idle_state=TouchKey.high, debounce_time=50, press_callback=on_press, release_callback=on_release)

# ========================================  主程序  ============================================

try:
    while True:
        state = button.get_state()
        print("Current button state:", "Pressed" if state else "Released")
        time.sleep(0.5)

except KeyboardInterrupt:
    print("Exit button test program")
```
---
👌 我来帮你把 **滑动变阻器的注意事项** 改写成 **触控按键（TouchKey 模块）** 的注意事项，逻辑保持完整，但内容替换为触控按键实际需要关心的问题：

---

## 注意事项
### 电气特性限制
* **电压限制**：触控按键模块（如 TTP223）通常工作在 **2.5V\~5.5V** 范围，使用树莓派 Pico 时应接 **3.3V** 电源，避免直接接 5V 导致 GPIO 损坏。
* **电流消耗**：触控按键模块功耗极低（典型值 < 10µA，触发时 < 1mA），一般无需额外电源设计，但请确保电源稳压良好。
* **输出电平**：模块的 OUT 引脚输出与 VCC 一致，即接 3.3V 时输出高电平为 3.3V。若接 5V，请确认开发板 GPIO 是否 **5V 容忍**，否则需加电平转换。

---

### 硬件接线与配置注意事项
* **共地要求**：触控按键模块 GND 必须与开发板 GND 共地，否则会出现触摸无效或误触发。
* **接线可靠性**：使用面包板测试时需确保 OUT 引脚与 GPIO 插牢，长期使用建议焊接排针或导线，避免接触不良。
* **GPIO 引脚选择**：触控按键只需数字输入引脚，不可接 ADC 或特殊功能引脚（如 SWD）。
* **干扰防护**：电容式触控模块对电磁干扰较敏感，OUT 信号线应避免与电机、继电器等大电流器件平行布线，必要时可加 RC 滤波。

---

### 环境影响
* **温度限制**：触控按键模块推荐工作温度为 -20℃\~70℃。过高温度可能导致芯片性能下降，过低温度可能使电容检测灵敏度降低。
* **湿度限制**：高湿环境（>85%RH）可能改变电容值，引发灵敏度异常甚至误触发。需为模块加防潮外壳，避免直接暴露在水汽中。
* **表面污染**：触控面若被灰尘、油污或水滴覆盖，会改变电容特性，影响触控灵敏度。建议定期用干净柔软的布擦拭，避免使用化学溶剂。
* **外部材料影响**：触控按键支持一定厚度的绝缘覆盖层（如亚克力、玻璃）。若增加外壳，应控制厚度 ≤5mm，并选用介电常数合适的材料，否则会导致检测不灵敏。

---
### 联系方式
如有任何问题或需要帮助，请通过以下方式联系开发者：  
📧 **邮箱**：10696531183@qq.com  
💻 **GitHub**：[https://github.com/FreakStudioCN](https://github.com/FreakStudioCN)  

---
### 许可协议
本项目中，除 `machine` 等 MicroPython 官方模块（MIT 许可证）外，所有由作者编写的驱动与扩展代码均采用 **知识共享署名-非商业性使用 4.0 国际版 (CC BY-NC 4.0)** 许可协议发布。  

您可以自由地：  
- **共享** — 在任何媒介以任何形式复制、发行本作品  
- **演绎** — 修改、转换或以本作品为基础进行创作  

惟须遵守下列条件：  
- **署名** — 您必须给出适当的署名，提供指向本许可协议的链接，同时标明是否（对原始作品）作了修改。您可以用任何合理的方式来署名，但是不得以任何方式暗示许可人为您或您的使用背书。  
- **非商业性使用** — 您不得将本作品用于商业目的。  
- **合理引用方式** — 可在代码注释、文档、演示视频或项目说明中明确来源。  

**版权归 FreakStudio 所有。**