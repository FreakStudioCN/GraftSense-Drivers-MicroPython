# PCF8574 äº”å‘æŒ‰é”®æµ‹è¯•ç¨‹åº - MicroPythonç‰ˆæœ¬
## ç›®å½•
- [ç®€ä»‹](#ç®€ä»‹)
- [ä¸»è¦åŠŸèƒ½](#ä¸»è¦åŠŸèƒ½)
- [ç¡¬ä»¶è¦æ±‚](#ç¡¬ä»¶è¦æ±‚)
- [æ–‡ä»¶è¯´æ˜](#æ–‡ä»¶è¯´æ˜)
- [è½¯ä»¶è®¾è®¡æ ¸å¿ƒæ€æƒ³](#è½¯ä»¶è®¾è®¡æ ¸å¿ƒæ€æƒ³)
- [ä½¿ç”¨è¯´æ˜](#ä½¿ç”¨è¯´æ˜)
- [ç¤ºä¾‹ç¨‹åº](#ç¤ºä¾‹ç¨‹åº)
- [æ³¨æ„äº‹é¡¹](#æ³¨æ„äº‹é¡¹)
- [è”ç³»æ–¹å¼](#è”ç³»æ–¹å¼)
- [è®¸å¯åè®®](#è®¸å¯åè®®)
---
## ç®€ä»‹
PCF8574 æ˜¯ä¸€æ¬¾ I2C æ¥å£çš„ GPIO æ‰©å±•èŠ¯ç‰‡ï¼Œå¯é€šè¿‡ 2 æ ¹ I2C å¼•è„šæ‰©å±• 8 è·¯ GPIO å£ï¼Œå¹¿æ³›ç”¨äºèµ„æºå—é™çš„åµŒå…¥å¼ç³»ç»Ÿä¸­æ‰©å±•å¤–è®¾æ¥å£ã€‚æœ¬é¡¹ç›®åŸºäº PCF8574 èŠ¯ç‰‡å®ç°äº”å‘æŒ‰é”®ï¼ˆä¸Šã€ä¸‹ã€å·¦ã€å³ã€ä¸­ï¼‰çš„çŠ¶æ€æ£€æµ‹ï¼Œæä¾›æŒ‰é”®æ¶ˆæŠ–ã€çŠ¶æ€å›è°ƒã€æ‰¹é‡è¯»å–ç­‰åŠŸèƒ½ï¼Œé€‚ç”¨äºæ™ºèƒ½è®¾å¤‡æ§åˆ¶ã€å°å‹äººæœºäº¤äº’ç•Œé¢ã€åµŒå…¥å¼ç³»ç»Ÿè¾“å…¥ç­‰åœºæ™¯ã€‚

> **æ³¨æ„**ï¼šè¯¥ç¨‹åºä»…é€‚ç”¨äºåŸºäº PCF8574 èŠ¯ç‰‡çš„æŒ‰é”®æ‰©å±•æ–¹æ¡ˆï¼Œä¸æ”¯æŒå…¶ä»–å‹å· GPIO æ‰©å±•èŠ¯ç‰‡ï¼›æŒ‰é”®æ£€æµ‹ç²¾åº¦å—æ¶ˆæŠ–æ—¶é—´å‚æ•°å½±å“ï¼Œéœ€æ ¹æ®å®é™…ç¡¬ä»¶è°ƒæ•´ã€‚
æœ¬é¡¹ç›®æä¾›åŸºäº MicroPython çš„é©±åŠ¨ä»£ç ï¼ˆ`pcf8574.py`ã€`pcf8574keys.py`ï¼‰åŠæµ‹è¯•ä¸»ç¨‹åºï¼ˆ`main.py`ï¼‰ï¼Œæ–¹ä¾¿å¼€å‘è€…å¿«é€Ÿæ¥å…¥äº”å‘æŒ‰é”®æ¨¡å—ï¼Œå®ç°ç¨³å®šçš„æŒ‰é”®çŠ¶æ€è¯»å–ä¸äº¤äº’åŠŸèƒ½ã€‚
---
## ä¸»è¦åŠŸèƒ½
- **I2C æ¥å£æ‰©å±•**ï¼šé€šè¿‡ PCF8574 èŠ¯ç‰‡å°† I2C æ€»çº¿æ‰©å±•ä¸º GPIO å£ï¼Œå®ç°äº”å‘æŒ‰é”®çš„é›†ä¸­å¼è¿æ¥
- **æŒ‰é”®æ¶ˆæŠ–å¤„ç†**ï¼šå†…ç½®æ¶ˆæŠ–é€»è¾‘ï¼Œè¿‡æ»¤æŒ‰é”®æœºæ¢°æŠ–åŠ¨å¯¼è‡´çš„è¯¯è§¦å‘ï¼Œé»˜è®¤æ¶ˆæŠ–æ—¶é—´ 50msï¼ˆå¯é…ç½®ï¼‰
- **çŠ¶æ€å›è°ƒæœºåˆ¶**ï¼šæ”¯æŒæŒ‰é”®æŒ‰ä¸‹/é‡Šæ”¾çŠ¶æ€å˜åŒ–çš„å›è°ƒå‡½æ•°ï¼Œä¾¿äºå®æ—¶å“åº”æŒ‰é”®äº‹ä»¶
- **æ‰¹é‡çŠ¶æ€è¯»å–**ï¼šæä¾› `read_all()` æ¥å£ï¼Œä¸€æ¬¡æ€§è¯»å–æ‰€æœ‰äº”å‘æŒ‰é”®çš„å½“å‰çŠ¶æ€
- **çµæ´»çš„å¼•è„šæ˜ å°„**ï¼šæ”¯æŒè‡ªå®šä¹‰æŒ‰é”®ä¸ PCF8574 å¼•è„šçš„æ˜ å°„å…³ç³»ï¼Œé€‚é…ä¸åŒç¡¬ä»¶æ¥çº¿
- **è·¨å¹³å°å…¼å®¹**ï¼šä»…ä¾èµ– MicroPython æ ‡å‡†åº“ï¼Œå…¼å®¹ ESP32ã€ESP8266ã€æ ‘è“æ´¾ Pico ç­‰å¼€å‘æ¿
- **èµ„æºé‡Šæ”¾ä¼˜åŒ–**ï¼šç¨‹åºç»ˆæ­¢æ—¶è‡ªåŠ¨é‡Šæ”¾ I2C æ€»çº¿èµ„æºï¼Œé¿å…ç¡¬ä»¶å ç”¨å†²çª
---
## ç¡¬ä»¶è¦æ±‚
### æ¨èæµ‹è¯•ç¡¬ä»¶
- MicroPython å…¼å®¹å¼€å‘æ¿ï¼ˆESP32/ESP8266/æ ‘è“æ´¾ Picoï¼‰
- PCF8574 I2C GPIO æ‰©å±•æ¨¡å—
- äº”å‘æŒ‰é”®æ¨¡å—ï¼ˆå«ä¸Šã€ä¸‹ã€å·¦ã€å³ã€ä¸­ 5 è·¯æŒ‰é”®ï¼‰
- æœé‚¦çº¿è‹¥å¹²ï¼ˆè‡³å°‘ 4 æ ¹ï¼šVCCã€GNDã€SCLã€SDAï¼‰
- ï¼ˆå¯é€‰ï¼‰é¢åŒ…æ¿ï¼ˆä¾¿äºä¸´æ—¶æ¥çº¿æµ‹è¯•ï¼‰

### æ¨¡å—å¼•è„šè¯´æ˜
| PCF8574 å¼•è„š | åŠŸèƒ½æè¿° | ç”µæ°”ç‰¹æ€§ |
|--------------|----------|----------|
| VCC          | ç”µæºæ­£æ | 3.3V-5Vï¼ˆå®½ç”µå‹å…¼å®¹ï¼‰ |
| GND          | ç”µæºè´Ÿæ | æ¥åœ°ï¼Œéœ€ä¸å¼€å‘æ¿å…±åœ° |
| SCL          | I2C æ—¶é’Ÿçº¿ | å•å‘æ—¶é’Ÿè¾“å…¥ï¼Œéœ€æ¥å¼€å‘æ¿å¯¹åº” I2C SCL å¼•è„š |
| SDA          | I2C æ•°æ®çº¿ | åŒå‘æ•°æ®ä¼ è¾“ï¼Œéœ€æ¥å¼€å‘æ¿å¯¹åº” I2C SDA å¼•è„š |
| P0-P7        | æ‰©å±• GPIO å£ | å¯é…ç½®ä¸ºè¾“å…¥/è¾“å‡ºï¼Œæœ¬é¡¹ç›®ä¸­ä½œä¸ºæŒ‰é”®è¾“å…¥å¼•è„š |

| äº”å‘æŒ‰é”®æ¨¡å—å¼•è„š | åŠŸèƒ½æè¿° |
|------------------|----------|
| UP              | ä¸Šæ–¹å‘æŒ‰é”® |
| DOWN            | ä¸‹æ–¹å‘æŒ‰é”® |
| LEFT            | å·¦æ–¹å‘æŒ‰é”® |
| RIGHT           | å³æ–¹å‘æŒ‰é”® |
| CENTER          | ä¸­é—´ç¡®è®¤æŒ‰é”® |
| GND             | æŒ‰é”®å…¬å…±åœ° |
---
## æ–‡ä»¶è¯´æ˜
### 1. pcf8574.py
æ ¸å¿ƒç±»ä¸º `PCF8574`ï¼Œç”¨äºå®ç° PCF8574 èŠ¯ç‰‡çš„ I2C é€šä¿¡ä¸ GPIO æ§åˆ¶ï¼Œå„æ–¹æ³•ä½œç”¨å¦‚ä¸‹ï¼š
- `__init__(self, i2c, address=0x20)`ï¼šåˆå§‹åŒ– PCF8574 å®ä¾‹ï¼Œå»ºç«‹ä¸èŠ¯ç‰‡çš„ I2C é€šä¿¡è¿æ¥ï¼›å‚æ•° `i2c` ä¸ºåº”ç”¨å±‚å·²åˆå§‹åŒ–çš„ I2C å®ä¾‹ï¼Œ`address` ä¸ºèŠ¯ç‰‡çš„ I2C åœ°å€ï¼ˆé»˜è®¤ 0x20ï¼Œå¯é€šè¿‡èŠ¯ç‰‡ A0/A1/A2 å¼•è„šè°ƒæ•´ï¼‰ã€‚
- `read(self) -> int`ï¼šè¯»å– 8 è·¯ GPIO å£çš„å½“å‰æ•´ä½“çŠ¶æ€ï¼Œè¿”å› 1 å­—èŠ‚æ•´æ•°ï¼›æ•´æ•°çš„æ¯ä¸€ä½å¯¹åº” 1 è·¯å¼•è„šï¼Œ1 è¡¨ç¤ºé«˜ç”µå¹³ï¼Œ0 è¡¨ç¤ºä½ç”µå¹³ã€‚
- `write(self, value)`ï¼šå‘ 8 è·¯ GPIO å£å†™å…¥æ§åˆ¶æ•°æ®ï¼Œè®¾ç½®è¾“å‡ºçŠ¶æ€ï¼›å‚æ•° `value` ä¸º 1 å­—èŠ‚æ•´æ•°ï¼Œæ¯ä¸€ä½å¯¹åº” 1 è·¯å¼•è„šçš„è¾“å‡ºç”µå¹³ï¼ˆ1 é«˜ç”µå¹³ï¼Œ0 ä½ç”µå¹³ï¼‰ã€‚
- `set_pin(self, pin, value)`ï¼šå•ç‹¬æ§åˆ¶æŸä¸€è·¯ GPIO å£çš„è¾“å‡ºçŠ¶æ€ï¼›å‚æ•° `pin` ä¸ºå¼•è„šç¼–å·ï¼ˆ0-7ï¼‰ï¼Œ`value` ä¸ºè¾“å‡ºç”µå¹³ï¼ˆTrue é«˜ç”µå¹³ï¼ŒFalse ä½ç”µå¹³ï¼‰ã€‚
- `get_pin(self, pin) -> bool`ï¼šå•ç‹¬è¯»å–æŸä¸€è·¯ GPIO å£çš„è¾“å…¥çŠ¶æ€ï¼›å‚æ•° `pin` ä¸ºå¼•è„šç¼–å·ï¼ˆ0-7ï¼‰ï¼Œè¿”å›å¸ƒå°”å€¼ï¼ˆTrue é«˜ç”µå¹³ï¼ŒFalse ä½ç”µå¹³ï¼‰ã€‚

### 2. pcf8574keys.py
æ ¸å¿ƒç±»ä¸º `PCF8574Keys`ï¼ŒåŸºäº `PCF8574` ç±»å°è£…äº”å‘æŒ‰é”®çš„çŠ¶æ€ç®¡ç†ä¸æ¶ˆæŠ–é€»è¾‘ï¼Œå„æ–¹æ³•ä½œç”¨å¦‚ä¸‹ï¼š
- `__init__(self, pcf, keys_map, debounce_time=50, callback=None)`ï¼šåˆå§‹åŒ–äº”å‘æŒ‰é”®å®ä¾‹ï¼›å‚æ•° `pcf` ä¸ºå·²åˆå§‹åŒ–çš„ `PCF8574` å®ä¾‹ï¼Œ`keys_map` ä¸ºæŒ‰é”®åç§°ä¸ PCF8574 å¼•è„šçš„æ˜ å°„å­—å…¸ï¼ˆå¦‚ {"UP":4}ï¼‰ï¼Œ`debounce_time` ä¸ºæŒ‰é”®æ¶ˆæŠ–æ—¶é—´ï¼ˆé»˜è®¤ 50msï¼‰ï¼Œ`callback` ä¸ºæŒ‰é”®çŠ¶æ€å˜åŒ–æ—¶è§¦å‘çš„å›è°ƒå‡½æ•°ï¼ˆå‚æ•°ä¸ºæŒ‰é”®åç§°å’ŒçŠ¶æ€ï¼‰ã€‚
- `read_all(self) -> dict`ï¼šè¯»å–æ‰€æœ‰äº”å‘æŒ‰é”®çš„å½“å‰ç¨³å®šçŠ¶æ€ï¼ˆå·²æ¶ˆæŠ–ï¼‰ï¼Œè¿”å›å­—å…¸ï¼›å­—å…¸é”®ä¸ºæŒ‰é”®åç§°ï¼ˆå¦‚ "UP"ï¼‰ï¼Œå€¼ä¸ºå¸ƒå°”å€¼ï¼ˆTrue è¡¨ç¤ºæŒ‰é”®æŒ‰ä¸‹ï¼ŒFalse è¡¨ç¤ºé‡Šæ”¾ï¼‰ã€‚
- `update(self)`ï¼šä¸»åŠ¨æ›´æ–°æ‰€æœ‰æŒ‰é”®çŠ¶æ€ï¼Œæ£€æµ‹çŠ¶æ€å˜åŒ–ï¼›è‹¥æŸæŒ‰é”®å½“å‰çŠ¶æ€ä¸ä¸Šä¸€æ¬¡çŠ¶æ€ä¸ä¸€è‡´ï¼Œè§¦å‘ `callback` å›è°ƒå‡½æ•°ï¼›å»ºè®®åœ¨ä¸»å¾ªç¯ä¸­å®šæœŸè°ƒç”¨ï¼ˆå¦‚æ¯ 10ms ä¸€æ¬¡ï¼‰ä»¥å®æ—¶ç›‘æµ‹æŒ‰é”®ã€‚
- `_debounce(self, pin) -> bool`ï¼šå†…éƒ¨æ¶ˆæŠ–è¾…åŠ©æ–¹æ³•ï¼Œè¯»å–æŒ‡å®š PCF8574 å¼•è„šçš„ç¨³å®šçŠ¶æ€ï¼›å‚æ•° `pin` ä¸ºå¼•è„šç¼–å·ï¼Œåœ¨ `debounce_time` å†…å¤šæ¬¡é‡‡æ ·ï¼Œä»…å½“è¿ç»­ç»“æœä¸€è‡´æ—¶è¿”å›çŠ¶æ€ï¼ˆTrue æŒ‰ä¸‹ï¼ŒFalse é‡Šæ”¾ï¼‰ï¼Œè¿‡æ»¤æœºæ¢°æŠ–åŠ¨å¹²æ‰°ã€‚

### 3. main.py
æ— è‡ªå®šä¹‰ç±»ï¼Œä¸ºæµ‹è¯•ä¸»ç¨‹åºï¼Œæ ¸å¿ƒé€»è¾‘é€šè¿‡å‡½æ•°è°ƒç”¨å®ç°ï¼š
- åˆå§‹åŒ– I2C æ€»çº¿ï¼šé…ç½® I2C å¼•è„šï¼ˆé»˜è®¤ SCL=GPIO17ã€SDA=GPIO16ï¼‰ä¸é€šä¿¡é¢‘ç‡ï¼Œåˆ›å»º I2C å®ä¾‹ã€‚
- å®ä¾‹åŒ–ç¡¬ä»¶ç±»ï¼šåˆ›å»º `PCF8574` å®ä¾‹ï¼ˆæŒ‡å®š I2C åœ°å€ 0x20ï¼‰å’Œ `PCF8574Keys` å®ä¾‹ï¼ˆé…ç½®æŒ‰é”®-å¼•è„šæ˜ å°„ä¸å›è°ƒå‡½æ•°ï¼‰ã€‚
- å®šä¹‰å›è°ƒå‡½æ•°ï¼š`key_callback(key_name, state)`ï¼Œå½“æŒ‰é”®çŠ¶æ€å˜åŒ–æ—¶è§¦å‘ï¼Œæ‰“å°æŒ‰é”®åç§°ä¸çŠ¶æ€ï¼ˆ"press" æŒ‰ä¸‹æˆ– "release" é‡Šæ”¾ï¼‰ã€‚
- ä¸»å¾ªç¯é€»è¾‘ï¼šæ¯ 500ms è°ƒç”¨ `read_all()` æ‰¹é‡è¯»å–æŒ‰é”®çŠ¶æ€å¹¶æ‰“å°ï¼ŒåŒæ—¶è°ƒç”¨ `update()` æ›´æ–°çŠ¶æ€å¹¶æ£€æµ‹å˜åŒ–ï¼›æ”¯æŒé”®ç›˜ä¸­æ–­ï¼ˆCtrl+Cï¼‰ç»ˆæ­¢ç¨‹åºï¼Œæ‰“å°é€€å‡ºä¿¡æ¯ã€‚
---
## è½¯ä»¶è®¾è®¡æ ¸å¿ƒæ€æƒ³
### åˆ†å±‚è®¾è®¡
- åº•å±‚ï¼š`pcf8574.py` å°è£… PCF8574 èŠ¯ç‰‡çš„ I2C é€šä¿¡ä¸ GPIO æ“ä½œï¼Œå±è”½ç¡¬ä»¶å¯„å­˜å™¨ç»†èŠ‚ï¼Œæä¾›é€šç”¨ GPIO æ§åˆ¶æ¥å£ã€‚
- ä¸­å±‚ï¼š`pcf8574keys.py` åŸºäºåº•å±‚é©±åŠ¨ï¼Œèšç„¦æŒ‰é”®åœºæ™¯ï¼Œè¡¥å……æ¶ˆæŠ–ã€çŠ¶æ€ç¼“å­˜ã€å›è°ƒç­‰ä¸“ç”¨é€»è¾‘ï¼Œå½¢æˆæŒ‰é”®æ§åˆ¶æ¨¡å—ã€‚
- é«˜å±‚ï¼š`main.py` ä½œä¸ºåº”ç”¨ç¤ºä¾‹ï¼Œç»„åˆè°ƒç”¨åº•å±‚ä¸ä¸­å±‚æ¨¡å—ï¼Œæ¼”ç¤ºå®Œæ•´ä½¿ç”¨æµç¨‹ï¼Œé™ä½å¼€å‘è€…ç§»æ¤éš¾åº¦ã€‚

### æ¶ˆæŠ–é€»è¾‘è®¾è®¡
- é‡‡ç”¨â€œæ—¶é—´çª—å£+å¤šæ¬¡é‡‡æ ·â€æœºåˆ¶ï¼šåœ¨ `debounce_time` å†…å¤šæ¬¡è¯»å–å¼•è„šçŠ¶æ€ï¼Œä»…å½“è¿ç»­é‡‡æ ·ç»“æœä¸€è‡´æ—¶ç¡®è®¤çŠ¶æ€ï¼Œé¿å…å•æ¬¡é‡‡æ ·å—æœºæ¢°æŠ–åŠ¨å½±å“ã€‚
- çŠ¶æ€ç¼“å­˜ä¼˜åŒ–ï¼šé€šè¿‡ `last_states` è®°å½•ä¸Šä¸€æ¬¡æŒ‰é”®çŠ¶æ€ï¼Œä»…åœ¨å½“å‰çŠ¶æ€ä¸ç¼“å­˜çŠ¶æ€ä¸ä¸€è‡´æ—¶è§¦å‘å›è°ƒï¼Œå‡å°‘æ— æ•ˆçš„çŠ¶æ€å¤„ç†ï¼Œæå‡æ•ˆç‡ã€‚

### æ¥å£è§£è€¦
- ç¡¬ä»¶åˆå§‹åŒ–åˆ†ç¦»ï¼šI2C å®ä¾‹ç”±åº”ç”¨å±‚åˆ›å»ºå¹¶ä¼ å…¥ `PCF8574` ç±»ï¼Œé©±åŠ¨ä¸ç»‘å®šå…·ä½“ç¡¬ä»¶å¼•è„šï¼Œé€‚é… ESP32ã€æ ‘è“æ´¾ Pico ç­‰ä¸åŒå¼€å‘æ¿ã€‚
- å›è°ƒå‡½æ•°æ³¨å…¥ï¼šæŒ‰é”®çŠ¶æ€çš„å¤„ç†é€»è¾‘é€šè¿‡ `callback` å‚æ•°æ³¨å…¥ï¼Œå¼€å‘è€…å¯çµæ´»æ‰©å±•åŠŸèƒ½ï¼ˆå¦‚æ§åˆ¶ LEDã€å‘é€ä¸²å£æŒ‡ä»¤ç­‰ï¼‰ï¼Œæ— éœ€ä¿®æ”¹é©±åŠ¨ä»£ç ã€‚

### è·¨å¹³å°å…¼å®¹
- ä¾èµ–æœ€å°åŒ–ï¼šä»…ä½¿ç”¨ MicroPython æ ‡å‡†åº“ï¼ˆ`machine`ã€`time`ï¼‰ï¼Œä¸ä¾èµ–ç¡¬ä»¶å¹³å°ä¸“å± APIï¼Œç¡®ä¿åœ¨ä¸åŒ MicroPython å¼€å‘æ¿ä¸Šå‡å¯è¿è¡Œã€‚
- é…ç½®å‚æ•°åŒ–ï¼šI2C å¼•è„šã€è®¾å¤‡åœ°å€ã€æŒ‰é”®æ˜ å°„ã€æ¶ˆæŠ–æ—¶é—´ç­‰å‡é€šè¿‡å‚æ•°é…ç½®ï¼Œä¿®æ”¹ `main.py` ä¸­çš„å‚æ•°å³å¯é€‚é…ä¸åŒç¡¬ä»¶æ¥çº¿ï¼Œæ— éœ€æ”¹åŠ¨é©±åŠ¨æ–‡ä»¶ã€‚
---
## ä½¿ç”¨è¯´æ˜
### ç¡¬ä»¶æ¥çº¿ï¼ˆæ ‘è“æ´¾pico ç¤ºä¾‹ï¼‰
| PCF8574 å¼•è„š |  GPIO å¼•è„š | äº”å‘æŒ‰é”®æ¨¡å—è¿æ¥ | å¤‡æ³¨ |
|--------------|----------------|------------------|------|
| VCC          | 3.3V           | -                | è‹¥æ¨¡å—æ”¯æŒ 5V å¯æ¥ 5Vï¼Œé¿å…è¿‡å‹æŸå |
| GND          | GND            | GNDï¼ˆæŒ‰é”®å…¬å…±åœ°ï¼‰ | å¿…é¡»ä¸å¼€å‘æ¿å…±åœ°ï¼Œå¦åˆ™æŒ‰é”®çŠ¶æ€æ£€æµ‹å¼‚å¸¸ |
| SCL          | GPIO17         | -                | éœ€ä¸å¼€å‘æ¿ I2C SCL å¼•è„šå¯¹åº”ï¼Œä¸åŒå¼€å‘æ¿å¼•è„šä¸åŒ |
| SDA          | GPIO16         | -                | éœ€ä¸å¼€å‘æ¿ I2C SDA å¼•è„šå¯¹åº”ï¼Œä¸åŒå¼€å‘æ¿å¼•è„šä¸åŒ |
| P0           | -              | RIGHT æŒ‰é”®        | æŒ‰ `keys_map` é…ç½®ï¼Œå¯æ ¹æ®æ¥çº¿ä¿®æ”¹æ˜ å°„å…³ç³» |
| P1           | -              | DOWN æŒ‰é”®         | æŒ‰ `keys_map` é…ç½®ï¼Œå¯æ ¹æ®æ¥çº¿ä¿®æ”¹æ˜ å°„å…³ç³» |
| P2           | -              | LEFT æŒ‰é”®         | æŒ‰ `keys_map` é…ç½®ï¼Œå¯æ ¹æ®æ¥çº¿ä¿®æ”¹æ˜ å°„å…³ç³» |
| P3           | -              | CENTER æŒ‰é”®       | æŒ‰ `keys_map` é…ç½®ï¼Œå¯æ ¹æ®æ¥çº¿ä¿®æ”¹æ˜ å°„å…³ç³» |
| P4           | -              | UP æŒ‰é”®           | æŒ‰ `keys_map` é…ç½®ï¼Œå¯æ ¹æ®æ¥çº¿ä¿®æ”¹æ˜ å°„å…³ç³» |

> **æ³¨æ„ï¼š**
> - è‹¥æŒ‰é”®çŠ¶æ€å§‹ç»ˆä¸ºâ€œé‡Šæ”¾â€æˆ–â€œæŒ‰ä¸‹â€ï¼Œæ£€æŸ¥ PCF8574 å¼•è„šæ˜¯å¦é…ç½®ä¸Šæ‹‰ç”µé˜»ï¼ˆéƒ¨åˆ†æ¨¡å—å·²å†…ç½®ï¼Œæ— å†…ç½®æ—¶éœ€å¤–æ¥ 10kÎ© ä¸Šæ‹‰ç”µé˜»è‡³ VCCï¼‰ã€‚
> - æ ‘è“æ´¾ Pico å¸¸ç”¨ I2C å¼•è„šï¼šI2C 0ï¼ˆSCL=GP1ã€SDA=GP0ï¼‰ã€I2C 1ï¼ˆSCL=GP3ã€SDA=GP2ï¼‰ï¼Œéœ€æ ¹æ®å®é™…ä½¿ç”¨çš„ I2C æ€»çº¿è°ƒæ•´æ¥çº¿ã€‚

### è½¯ä»¶ä¾èµ–
- **å›ºä»¶ç‰ˆæœ¬**ï¼šMicroPython v1.23.0 åŠä»¥ä¸Š  
- **å†…ç½®åº“**ï¼š
  - `machine`ï¼šæä¾› I2C æ€»çº¿åˆå§‹åŒ–ã€GPIO æ§åˆ¶åŠŸèƒ½
  - `time`ï¼šæä¾›æ—¶é—´æˆ³è®°å½•ã€å»¶æ—¶åŠŸèƒ½ï¼Œç”¨äºæ¶ˆæŠ–ä¸å¾ªç¯é—´éš”æ§åˆ¶
- **å¼€å‘å·¥å…·**ï¼šæ¨è Thonnyï¼ˆæ“ä½œç®€å•ï¼Œæ”¯æŒ MicroPython ç›´æ¥è¿è¡Œä¸è°ƒè¯•ï¼‰ã€PyCharmï¼ˆéœ€å®‰è£… MicroPython æ’ä»¶ï¼‰

### å®‰è£…æ­¥éª¤
1. **çƒ§å½•å›ºä»¶**ï¼šæ ¹æ®å¼€å‘æ¿å‹å·ï¼ˆå¦‚ ESP32ã€æ ‘è“æ´¾ Picoï¼‰ä¸‹è½½å¯¹åº” MicroPython å›ºä»¶ï¼Œé€šè¿‡çƒ§å½•å·¥å…·ï¼ˆå¦‚ esptoolã€Raspberry Pi Imagerï¼‰çƒ§å½•åˆ°å¼€å‘æ¿ã€‚
2. **ä¸Šä¼ æ–‡ä»¶**ï¼šé€šè¿‡å¼€å‘å·¥å…·å°† `pcf8574.py`ã€`pcf8574keys.py`ã€`main.py` ä¸‰ä¸ªæ–‡ä»¶ä¸Šä¼ åˆ°å¼€å‘æ¿æ ¹ç›®å½•ã€‚
3. **ä¿®æ”¹é…ç½®**ï¼šæ‰“å¼€ `main.py`ï¼Œæ ¹æ®ç¡¬ä»¶æ¥çº¿ä¿®æ”¹ I2C å¼•è„šï¼ˆ`SCL_PIN`ã€`SDA_PIN`ï¼‰ã€PCF8574 åœ°å€ï¼ˆ`PCF8574_ADDR`ï¼‰ã€æŒ‰é”®-å¼•è„šæ˜ å°„ï¼ˆ`KEYS_MAP`ï¼‰ã€‚
4. **è¿è¡Œæµ‹è¯•**ï¼šåœ¨å¼€å‘å·¥å…·ä¸­è¿è¡Œ `main.py`ï¼Œæ“ä½œäº”å‘æŒ‰é”®ï¼Œé€šè¿‡ä¸²å£ç›‘è§†å™¨æŸ¥çœ‹æŒ‰é”®çŠ¶æ€æ‰“å°ä¿¡æ¯ï¼ˆæŒ‰ä¸‹/é‡Šæ”¾ï¼‰ã€‚
---
## ç¤ºä¾‹ç¨‹åº
```python
# Python env   : MicroPython v1.23.0
# -*- coding: utf-8 -*-
# @Time    : 2025/9/8 ä¸Šåˆ11:42
# @Author  : ç¼ªè´µæˆ
# @File    : main.py
# @Description : äº”å‘æŒ‰é”®æµ‹è¯•æ–‡ä»¶

# ======================================== å¯¼å…¥ç›¸å…³æ¨¡å— =========================================

from machine import I2C, Pin
import time
from pcf8574 import PCF8574
from pcf8574keys import PCF8574Keys

# ======================================== å…¨å±€å˜é‡ ============================================

# I2Cé…ç½®
I2C_ID = 0
# æ ¹æ®å®é™…ç¡¬ä»¶ä¿®æ”¹
SCL_PIN = 1
# æ ¹æ®å®é™…ç¡¬ä»¶ä¿®æ”¹
SDA_PIN = 0

PCF8574_ADDR = None

# äº”å‘æŒ‰é”®å¼•è„šæ˜ å°„ï¼ˆæ ¹æ®å®é™…æ¥çº¿ä¿®æ”¹ï¼‰
KEYS_MAP = {
    'UP': 4,
    'DOWN': 1,
    'LEFT': 2,
    'RIGHT': 0,
    'CENTER': 3
}

# ======================================== åŠŸèƒ½å‡½æ•° ============================================

def key_callback(key_name, state):
    """
    æŒ‰é”®äº‹ä»¶å›è°ƒå‡½æ•°ï¼Œå½“æŒ‰é”®çŠ¶æ€å‘ç”Ÿå˜åŒ–æ—¶è°ƒç”¨æ­¤å‡½æ•°ã€‚

    Args:
        key_name (str): æŒ‰é”®åç§°æˆ–æ ‡è¯†ç¬¦ï¼Œç”¨äºåŒºåˆ†ä¸åŒæŒ‰é”®ã€‚
        state (bool): æŒ‰é”®çŠ¶æ€ï¼ŒTrue è¡¨ç¤ºæŒ‰ä¸‹ï¼ŒFalse è¡¨ç¤ºé‡Šæ”¾ã€‚

    ===========================================

    Key event callback function, this function is called when the key state changes.

    Args:
        key_name (str): The name or identifier of the key, used to differentiate between different keys.
        state (bool): The key state, True indicates pressed, False indicates released.
    """
    status = "press" if state else "release"
    print(f"key {key_name} {status}")

# ======================================== è‡ªå®šä¹‰ç±» ============================================

# ======================================== åˆå§‹åŒ–é…ç½® ==========================================

time.sleep(3)
print("FreakStudio:PCF8574 Five-way Button Test Program")
# åˆå§‹åŒ–I2C
i2c = I2C(I2C_ID, scl=Pin(SCL_PIN), sda=Pin(SDA_PIN), freq=400000)
# å¼€å§‹æ‰«æI2Cæ€»çº¿ä¸Šçš„è®¾å¤‡ï¼Œè¿”å›ä»æœºåœ°å€çš„åˆ—è¡¨
devices_list: list[int] = i2c.scan()
print('START I2C SCANNER')
# è‹¥devices listä¸ºç©ºï¼Œåˆ™æ²¡æœ‰è®¾å¤‡è¿æ¥åˆ°I2Cæ€»çº¿ä¸Š
if len(devices_list) == 0:
    # è‹¥éç©ºï¼Œåˆ™æ‰“å°ä»æœºè®¾å¤‡åœ°å€
    print("No i2c device !")
else:
    # éå†ä»æœºè®¾å¤‡åœ°å€åˆ—è¡¨
    print('i2c devices found:', len(devices_list))
for device in devices_list:
    # åˆ¤æ–­è®¾å¤‡åœ°å€æ˜¯å¦ä¸ºçš„PCF8574åœ°å€
    if 0x20 <= device <= 0x28:
        # å‡è®¾ç¬¬ä¸€ä¸ªæ‰¾åˆ°çš„è®¾å¤‡æ˜¯PCF8574åœ°å€
        print("I2c hexadecimal address:", hex(device))
        PCF8574_ADDR = device
# åˆå§‹åŒ–PCF8574
pcf = PCF8574(i2c, PCF8574_ADDR)
try:
    pcf.check()
    print(f"PCF8574 found at address {PCF8574_ADDR:#x}")
except OSError as e:
    print(f"PCF8574 Initialize failed: {e}")
    while True:
        time.sleep(1)

# åˆå§‹åŒ–äº”å‘æŒ‰é”®
keys = PCF8574Keys(pcf, KEYS_MAP, key_callback)

# ========================================  ä¸»ç¨‹åº  ============================================

try:
    while True:
        # æ‰“å°å½“å‰æ‰€æœ‰æŒ‰é”®çŠ¶æ€
        all_states = keys.read_all()
        print("status:", {k: "press" if v else "release" for k, v in all_states.items()})
        # 500msåˆ·æ–°ä¸€æ¬¡çŠ¶æ€æ˜¾ç¤º
        time.sleep(0.5)
except KeyboardInterrupt:
    print("test stop")
finally:
    keys.deinit()
    print("Resource release")


```
---
## æ³¨æ„äº‹é¡¹
### 1. ç¡¬ä»¶è¿æ¥é—®é¢˜
- **ç”µæºåŒ¹é…**ï¼šPCF8574 æ¨¡å—è‹¥ä¸º 3.3V ç‰ˆæœ¬ï¼Œä¸å¯æ¥ 5V ç”µæºï¼›5V ç‰ˆæœ¬å¯å…¼å®¹ 3.3Vï¼Œä½†éœ€ç¡®è®¤æ¨¡å—æ˜¯å¦å¸¦ç”µå‹è½¬æ¢ç”µè·¯ï¼Œé¿å…èŠ¯ç‰‡çƒ§æ¯ã€‚
- **å…±åœ°è¦æ±‚**ï¼šPCF8574 çš„ GND å¿…é¡»ä¸å¼€å‘æ¿ GND ç›´æ¥è¿æ¥ï¼Œå¦åˆ™ I2C é€šä¿¡ä¼šå› ç”µå¹³å‚è€ƒä¸ä¸€è‡´å¯¼è‡´å¤±è´¥æˆ–æ•°æ®å¼‚å¸¸ã€‚
- **ä¸Šæ‹‰ç”µé˜»**ï¼šPCF8574 å¼•è„šä¸ºå¼€æ¼è¾“å‡ºï¼Œä½œä¸ºæŒ‰é”®è¾“å…¥æ—¶éœ€ä¸Šæ‹‰ï¼ˆæ¨¡å—å†…ç½®æˆ–å¤–æ¥ï¼‰ï¼›æ— ä¸Šå¤©æ‹‰æ—¶ï¼ŒæŒ‰é”®æŒ‰ä¸‹/é‡Šæ”¾çŠ¶æ€å¯èƒ½æ— æ³•æ­£ç¡®æ£€æµ‹ã€‚

### 2. è½¯ä»¶é…ç½®é—®é¢˜
- **I2C åœ°å€å†²çª**ï¼šè‹¥åŒä¸€ I2C æ€»çº¿è¿æ¥å¤šä¸ªè®¾å¤‡ï¼Œéœ€ç¡®ä¿å„è®¾å¤‡åœ°å€ä¸åŒï¼ˆPCF8574 åœ°å€å¯é€šè¿‡ A0/A1/A2 å¼•è„šè°ƒæ•´ï¼ŒèŒƒå›´ 0x20-0x27ï¼‰ï¼Œé¿å…é€šä¿¡å†²çªã€‚
- **æ¶ˆæŠ–æ—¶é—´è°ƒæ•´**ï¼šè‹¥æŒ‰é”®ä»æœ‰è¯¯è§¦å‘ï¼Œå¯å¢å¤§ `debounce_time`ï¼ˆå¦‚ 100msï¼‰ï¼›è‹¥æŒ‰é”®å“åº”è¿Ÿé’ï¼Œå¯é€‚å½“å‡å°ï¼ˆå¦‚ 30msï¼‰ï¼Œéœ€æ ¹æ®æŒ‰é”®æœºæ¢°ç‰¹æ€§è°ƒæ•´ã€‚
- **å¾ªç¯é—´éš”æ§åˆ¶**ï¼šä¸»å¾ªç¯ä¸­ `update()` è°ƒç”¨é—´éš”å»ºè®®ä¸è¶…è¿‡ `debounce_time` çš„ä¸€åŠï¼ˆå¦‚æ¶ˆæŠ– 50ms æ—¶ï¼Œé—´éš” 20msï¼‰ï¼Œç¡®ä¿ä¸é—æ¼æŒ‰é”®çŠ¶æ€å˜åŒ–ã€‚

### 3. æ€§èƒ½ä¸ç¨³å®šæ€§
- **é‡‡æ ·é¢‘ç‡**ï¼šå•æ¬¡æŒ‰é”®æ£€æµ‹ï¼ˆ`read_all()`+`update()`ï¼‰è€—æ—¶çº¦ 1-2msï¼Œå»ºè®®æ¯ç§’é‡‡æ ·ä¸è¶…è¿‡ 100 æ¬¡ï¼Œé¿å…å ç”¨è¿‡å¤š CPU èµ„æºå½±å“å…¶ä»–åŠŸèƒ½ã€‚
- **èµ„æºé‡Šæ”¾**ï¼šç¨‹åºç»ˆæ­¢æ—¶éœ€é€šè¿‡é”®ç›˜ä¸­æ–­ï¼ˆCtrl+Cï¼‰è§¦å‘èµ„æºé‡Šæ”¾é€»è¾‘ï¼Œé¿å…ç›´æ¥æ–­ç”µå¯¼è‡´ I2C æ€»çº¿å¤„äºå¼‚å¸¸çŠ¶æ€ï¼Œå½±å“ä¸‹æ¬¡å¯åŠ¨ã€‚
- **ç¯å¢ƒå¹²æ‰°**ï¼šå¼ºç”µç£ç¯å¢ƒï¼ˆå¦‚ç”µæœºã€ç»§ç”µå™¨é™„è¿‘ï¼‰å¯èƒ½å¹²æ‰° I2C é€šä¿¡ï¼Œå»ºè®®ä½¿ç”¨å±è”½çº¿è¿æ¥ SCL/SDA å¼•è„šï¼Œæˆ–å¢åŠ  100nF æ»¤æ³¢ç”µå®¹ï¼ˆé è¿‘ PCF8574 VCC-GND å¼•è„šï¼‰ã€‚
---

## è”ç³»æ–¹å¼
å¦‚æœ‰ä»»ä½•é—®é¢˜æˆ–éœ€è¦å¸®åŠ©ï¼Œè¯·é€šè¿‡ä»¥ä¸‹æ–¹å¼è”ç³»å¼€å‘è€…ï¼š  
ğŸ“§ **é‚®ç®±**ï¼š10696531183@qq.com  
ğŸ’» **GitHub**ï¼šhttps://github.com/FreakStudioCN

---

## è®¸å¯åè®®
æœ¬é¡¹ç›®ä¸­ï¼Œé™¤ `machine` ç­‰ MicroPython å®˜æ–¹æ¨¡å—ï¼ˆMIT è®¸å¯è¯ï¼‰å¤–ï¼Œæ‰€æœ‰ç”±ä½œè€…ç¼–å†™çš„é©±åŠ¨ä¸æ‰©å±•ä»£ç å‡é‡‡ç”¨ **çŸ¥è¯†å…±äº«ç½²å-éå•†ä¸šæ€§ä½¿ç”¨ 4.0 å›½é™…ç‰ˆ (CC BY-NC 4.0)** è®¸å¯åè®®å‘å¸ƒã€‚  

æ‚¨å¯ä»¥è‡ªç”±åœ°ï¼š  
- **å…±äº«** â€” åœ¨ä»»ä½•åª’ä»‹ä»¥ä»»ä½•å½¢å¼å¤åˆ¶ã€å‘è¡Œæœ¬ä½œå“  
- **æ¼”ç»** â€” ä¿®æ”¹ã€è½¬æ¢æˆ–ä»¥æœ¬ä½œå“ä¸ºåŸºç¡€è¿›è¡Œåˆ›ä½œ  

æƒŸé¡»éµå®ˆä¸‹åˆ—æ¡ä»¶ï¼š  
- **ç½²å** â€” æ‚¨å¿…é¡»ç»™å‡ºé€‚å½“çš„ç½²åï¼Œæä¾›æŒ‡å‘æœ¬è®¸å¯åè®®çš„é“¾æ¥ï¼ŒåŒæ—¶æ ‡æ˜æ˜¯å¦ï¼ˆå¯¹åŸå§‹ä½œå“ï¼‰ä½œäº†ä¿®æ”¹ã€‚æ‚¨å¯ä»¥ç”¨ä»»ä½•åˆç†çš„æ–¹å¼æ¥ç½²åï¼Œä½†æ˜¯ä¸å¾—ä»¥ä»»ä½•æ–¹å¼æš—ç¤ºè®¸å¯äººä¸ºæ‚¨æˆ–æ‚¨çš„ä½¿ç”¨èƒŒä¹¦ã€‚  
- **éå•†ä¸šæ€§ä½¿ç”¨** â€” æ‚¨ä¸å¾—å°†æœ¬ä½œå“ç”¨äºå•†ä¸šç›®çš„ã€‚  
- **åˆç†å¼•ç”¨æ–¹å¼** â€” å¯åœ¨ä»£ç æ³¨é‡Šã€æ–‡æ¡£ã€æ¼”ç¤ºè§†é¢‘æˆ–é¡¹ç›®è¯´æ˜ä¸­æ˜ç¡®æ¥æºã€‚  
- **è¯´æ˜** â€” ä»£ç å«å‚è€ƒéƒ¨åˆ†,å‡ºç°éæŠ€æœ¯é—®é¢˜å’Œç½²åä½œè€…æ— å…³ã€‚  
**ç‰ˆæƒå½’ FreakStudio æ‰€æœ‰ã€‚**
