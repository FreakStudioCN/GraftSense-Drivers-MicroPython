# 摇杆驱动 - MicroPython版本
## 目录
- [简介](#简介)
- [主要功能](#主要功能)
- [硬件要求](#硬件要求)
- [文件说明](#文件说明)
- [软件设计核心思想](#软件设计核心思想)
- [使用说明](#使用说明)
- [示例程序](#示例程序)
- [注意事项](#注意事项)
- [联系方式](#联系方式)
- [许可协议](#许可协议)
---
## 简介

摇杆模块（Joystick）是一种基于双电位器的输入设备，通常包含 X 轴与 Y 轴两个线性电阻通道，通过滑动触点位置输出电压信号，部分型号还带有数字按压开关。常用于机器人控制、游戏输入、机械臂操控等场景。本项目提供基于 MicroPython 的驱动代码，封装 **ADC 采样、电压转换、归一化比例计算** 功能，支持快速集成。

> **注意**：适用于常见的二维摇杆模块，不适用于高精度工业摇杆或数字式摇杆，不可用于高精度测量场景。

---

## 主要功能

* 分别读取 **X/Y 轴** ADC 原始值（0~~65535）、计算实际电压（0~~参考电压）、输出归一化比例（-1.0~~1.0 或 0.0~~1.0 可选）
* 读取按压开关状态（数字输入，按下=0，释放=1）
* 聚合返回完整状态数据，支持外部传入 ADC 实例适配不同硬件
* 兼容 MicroPython 主流开发板，接口简洁易用

---

## 硬件要求

### 推荐测试硬件

* MicroPython 开发板（如树莓派 Pico）
* 摇杆模块（典型 5 引脚：VCC/GND/VRx/VRy/SW）
* 杜邦线若干、（可选）面包板

### 模块引脚说明

| 摇杆引脚 | 功能描述    | 连接说明                          |
| ---- | ------- | ----------------------------- |
| VCC  | 电源输入    | 接开发板 3.3V                     |
| GND  | 接地      | 接开发板 GND                      |
| VRx  | X 轴电压输出 | 接开发板 ADC 引脚（如 Pico GP26/ADC0） |
| VRy  | Y 轴电压输出 | 接开发板 ADC 引脚（如 Pico GP27/ADC1） |
| SW   | 按压开关输出  | 接开发板 GPIO（需上拉电阻，部分开发板可内部上拉）   |

---

好，我帮你把 **文件说明 + 软件设计核心思想** 以及 `Potentiometer` 版本的内容完整改造成 **Joystick 摇杆版本**，并和你贴的代码描述保持一致：

---

## 文件说明
### joystick.py

该文件实现摇杆（Joystick）的核心驱动功能，仅包含 `Joystick` 类，用于处理 **X 轴、Y 轴 ADC 电压信号**与 **按键状态** 的读取和数据转换。

`Joystick` 类通过封装 ADC 采样与数字输入逻辑，提供摇杆的多维度数据访问接口。类中主要成员说明如下：

* `_adc_x`、`_adc_y`：存储外部传入的 ADC 实例，分别负责采集摇杆 X/Y 方向的电压信号。
* `_sw`：存储按键开关的 Pin 实例，负责采集数字输入状态。
* `_conversion_factor`：ADC 原始值到电压值的转换系数（`vref / 65535`，默认 vref=3.3V）。
* `_timer`：定时器实例，用于按指定频率自动采样摇杆状态。
* `_callback`：可选用户自定义回调函数，周期性返回摇杆状态数据。
* `_filter_alpha`：低通滤波系数，用于平滑化 X/Y 信号，减少抖动。

类的主要方法包括：

* `__init__(vrx_pin: int, vry_pin: int, vsw_pin: int, freq: int = 100, callback=None)`
  初始化驱动对象，绑定 X/Y ADC 引脚与开关引脚，配置采样频率和可选的回调函数。
* `start() -> None`
  启动定时器，按照设定频率定时采集摇杆状态。
* `_timer_callback(timer)`
  定时器回调函数，采集 X/Y/按键的最新值，执行低通滤波，并触发用户回调。
* `stop() -> None`
  停止数据采集，释放定时器资源。
* `get_values() -> tuple`
  获取当前摇杆状态 `(x_value, y_value, sw_value)`，其中 X/Y 为电压归一化值（0.0\~1.0），SW 为按键状态（0=按下，1=未按下）。
---
### main.py
该文件为摇杆功能测试程序，无自定义类，仅包含 `main` 函数作为程序入口。
`main` 函数的核心功能是：
1. 初始化与摇杆模块连接的 ADC 引脚和按键引脚。
2. 创建 `Joystick` 驱动实例，配置采样频率与用户回调函数。
3. 调用 `start()` 方法启动数据采集，实时获取摇杆状态并通过回调输出。
4. 运行一段时间后，调用 `stop()` 方法结束采集，并打印最后一次读取的摇杆值。
该程序支持通过 `freq` 参数调整采样频率，适合用于验证摇杆模块的硬件连接正确性和驱动功能完整性。

---

## 软件设计核心思想

* **模块化**：将 X/Y ADC 采样、按键读取、低通滤波、回调处理拆分为独立逻辑，便于维护与扩展。
* **分压采样**：基于摇杆内部电位器分压原理，准确计算 X/Y 电压比例，输出归一化值。
* **硬件解耦**：ADC/Pin 实例由应用层传入，驱动不负责底层硬件初始化，确保兼容不同 MicroPython 开发板。
* **实时响应**：通过定时器周期采样与回调函数机制，实现摇杆输入的实时性，支持应用层快速响应控制逻辑。

---
## 使用说明
### 硬件接线（树莓派 Pico 示例）

| 摇杆引脚 | Pico 引脚          | 接线功能                |
| ---- | ---------------- | ------------------- |
| VCC  | 3.3V（Pin36）      | 电源输入                |
| GND  | GND（Pin38）       | 接地                  |
| VRx  | GP26/ADC0（Pin31） | X 轴信号采样             |
| VRy  | GP27/ADC1（Pin32） | Y 轴信号采样             |
| SW   | GP22（Pin29）      | 按键输入（低电平=按下，高电平=释放） |

---
### 软件依赖

* **固件**：MicroPython v1.23+
* **内置库**：

  * `machine`（ADC、Pin 控制）
  * `time`（延时）
* **开发工具**：Thonny / PyCharm / mpremote
---
### 安装步骤
1. 烧录 MicroPython 固件到开发板。
2. 上传 `joystick.py` 和 `main.py` 到开发板。
3. 根据实际接线，修改 `main.py` 中的 `vrx_pin`、`vry_pin`、`vsw_pin` 参数（默认示例为 GP26/ADC0、GP27/ADC1、GP22）。
4. 运行 `main.py`，移动摇杆和按下按钮，观察终端打印的 X/Y 值与按键状态。
---

## 示例程序
```python
# Python env   : MicroPython v1.23.0
# -*- coding: utf-8 -*-        
# @Time    : 2024/8/27 下午10:02   
# @Author  : 李清水            
# @File    : main.py       
# @Description : ADC类实验，读取摇杆两端电压

# ======================================== 导入相关模块 ========================================

# 导入时间相关模块
import time
# 导入摇杆驱动模块
from joystick import Joystick, user_callback

# ======================================== 全局变量 ============================================

# ======================================== 功能函数 ============================================

# ======================================== 自定义类 ============================================

# ======================================== 初始化配置 ==========================================

# 延时3s等待设备上电完毕
time.sleep(3)
# 打印调试信息
print("FreakStudio : reading the voltage value of Joystick experiment")

# 创建摇杆实例，使用ADC0-GP26、ADC1-GP27作为Y轴和X轴，GP28 作为按键
joystick = Joystick(vrx_pin=0, vry_pin=1, vsw_pin=22, freq=10, callback=user_callback)

# ========================================  主程序  ===========================================

# 启动摇杆数据采集
joystick.start()
# 运行一段时间，观察摇杆的状态
time.sleep(30)
# 停止数据采集
joystick.stop()
# 获取最后一次读取的摇杆值
x_val, y_val, sw_val = joystick.get_values()
print("Final Joystick values: X = {:.2f}, Y = {:.2f}, Switch = {}".format(x_val, y_val, sw_val))
```
---
## 注意事项
### 电气特性限制

* **电压限制**：ADC 输入电压严禁超过参考电压（默认 3.3V），否则可能烧毁 ADC 模块；摇杆模块的 VCC 必须接与参考电压匹配的电源（如 3.3V）。
* **阻值范围**：常见摇杆内部电位器阻值为 **5KΩ\~10KΩ**，此范围适合大多数微控制器 ADC 输入；如使用非标准阻值摇杆，应确认其在供电电流和 ADC 驱动能力范围内。
* **按键电流**：摇杆按压开关为机械触点，通常仅支持小电流（<10mA），不可直接驱动高功率负载，必须通过 MCU GPIO 读取。
* **触点寿命**：摇杆内部电位器和按压开关均为机械结构，存在寿命限制（典型 10 万～100 万次操作）。高频输入场景下需准备冗余或考虑霍尔式无接触摇杆替代。

---

### 硬件接线与配置注意事项

* **共地要求**：摇杆模块 GND 必须与开发板 GND 可靠连接，否则 X/Y 输出电压会漂移，导致 ADC 读数异常。
* **接线可靠性**：模块化摇杆通常为排针接口，面包板测试时需确保插入牢固，长期使用建议焊接或使用插拔式连接器，避免虚接。
* **ADC 引脚选择**：确认开发板的 ADC 引脚位置（如 Pico 的 GP26\~GP28 支持 ADC 功能），不可将普通 GPIO 当作 ADC 使用。
* **干扰防护**：X/Y 模拟信号线应尽量短且避免靠近电机、继电器等强电磁干扰源；必要时使用屏蔽线或 RC 滤波器。
* **上拉电阻**：部分摇杆模块的 SW 按键输出为开漏形式，需要外部或内部上拉电阻，否则可能一直读取为低电平。

---

### 环境影响

* **温度限制**：摇杆最佳工作温度为 -10℃\~60℃。高温环境（>60℃）会加速电位器碳膜老化，导致输出漂移；低温环境（<-10℃）可能使触点接触电阻增大，出现抖动或死区。
* **湿度限制**：高湿环境（相对湿度 >85% RH）会导致电位器碳膜受潮、金属触点氧化，引发阻值漂移与接触不良。需加装外壳或涂覆防潮层，避免直接暴露。
* **粉尘防护**：长期处于粉尘环境会导致滑动接触面阻塞、阻值波动。建议定期用低压干燥气（≤0.3MPa）吹扫模块，严禁用尖锐工具刮擦内部电阻体或触点。

---

### 联系方式
如有任何问题或需要帮助，请通过以下方式联系开发者：  
📧 **邮箱**：10696531183@qq.com  
💻 **GitHub**：[https://github.com/yourusername](https://github.com/yourusername)  

---
### 许可协议
本项目中，除 `machine` 等 MicroPython 官方模块（MIT 许可证）外，所有由作者编写的驱动与扩展代码均采用 **知识共享署名-非商业性使用 4.0 国际版 (CC BY-NC 4.0)** 许可协议发布。  

您可以自由地：  
- **共享** — 在任何媒介以任何形式复制、发行本作品  
- **演绎** — 修改、转换或以本作品为基础进行创作  

惟须遵守下列条件：  
- **署名** — 您必须给出适当的署名，提供指向本许可协议的链接，同时标明是否（对原始作品）作了修改。您可以用任何合理的方式来署名，但是不得以任何方式暗示许可人为您或您的使用背书。  
- **非商业性使用** — 您不得将本作品用于商业目的。  
- **合理引用方式** — 可在代码注释、文档、演示视频或项目说明中明确来源。  

**版权归 FreakStudio 所有。**