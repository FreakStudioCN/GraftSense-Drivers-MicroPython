# MicroPython CC2530 Zigbee驱动库

## 目录
- [简介](#简介)
- [主要功能](#主要功能)
- [支持的协议](#支持的协议)
- [硬件要求](#硬件要求)
- [文件说明](#文件说明)
- [软件设计核心思想](#软件设计核心思想)
- [使用说明](#使用说明)
- [示例程序](#示例程序)
- [注意事项](#注意事项)
- [许可协议](#许可协议)

---

## 简介

本项目是一个针对 **CC2530 Zigbee 模块** 的 MicroPython 设备驱动库，提供了全面的数据收发与协议封装功能。该库设计简洁、模块化，支持多种 Zigbee 通信模式，可在多种 MicroPython 兼容硬件平台上运行，适用于物联网节点开发、无线传感网络、智能家居、远程数据传输等场景。

RL-CC2530-A1 模块是一个真正的片上系统（SoC）解决方案，适用于 **2.4 GHz IEEE 802.15.4、ZigBee 和 RF4CE** 等无线协议，结合了高性能 RF 收发器、增强型 8051 CPU、系统内可编程闪存和 8 KB RAM 等强大功能。

---

## 主要功能

* 提供非阻塞式 Zigbee 数据收发功能
* 支持多种数据封装和解封装模式
* 跨平台兼容：

  * 通信端：Raspberry Pi Pico / 其它 MicroPython 兼容开发板
* 与 uasyncio 兼容，可用于异步应用
* 提供测试程序便于验证和学习

---

## 支持的协议 / 模式

* 点对点（P2P）通信
* 多节点广播
* 简单的包头/校验机制
* Zigbee 网络拓扑支持（如星型、网状网络）

---

## 硬件要求

### 通信端

* **RL-CC2530-A1 Zigbee 模块**（2.4 GHz，支持 IEEE 802.15.4 / ZigBee / RF4CE）
* 连接导线
* 支持 MicroPython 的开发板（如 Raspberry Pi Pico、ESP32 等）

### 接线方式（树莓派 Pico 示例）

| 模块类型            | 引脚功能      | 连接说明                                   |
| --------------- | --------- | -------------------------------------- |
| RL-CC2530-A1 模块 | VCC       | 接开发板 3.3V（模块工作电压为 3.0~3.6V，请确认规格）      |
| RL-CC2530-A1 模块 | GND       | 接开发板 GND（共地）                           |
| RL-CC2530-A1 模块 | TXD       | 接开发板 GPIO RX 引脚（如 Pico 的 GP5/UART1 RX） |
| RL-CC2530-A1 模块 | RXD       | 接开发板 GPIO TX 引脚（如 Pico 的 GP4/UART1 TX） |
| RL-CC2530-A1 模块 | RESET/PIO | 可选，用于复位或控制模块工作状态（如 Pico 的 GP2）         |

---

## 文件说明

### cc253x_ttl.py

该文件实现 **RL-CC2530-A1 Zigbee TTL 模块** 的核心驱动功能，仅包含 `CC253xTTL` 类，用于处理 UART 通信、模块配置与数据收发。

`CC253xTTL` 类通过封装 UART 传输与透明传输协议，提供节点与协调器间点对点通信、多节点广播、透明数据发送/接收以及模块参数配置接口。类中包含以下主要属性：

* `_uart`：MicroPython UART 对象，用于与 CC253x 模块通信。
* `role`：模块角色（协调器/路由器/终端）。
* `baud`：串口波特率。
* `channel`：无线信道。
* `panid`：PANID 网络标识。
* `seek_time`：寻找网络的超时时间（秒）。
* `query_interval_ms`：查询间隔（毫秒）。
* `_recv_buf`：内部接收缓冲区。

类的主要方法包括：

* `__init__(uart, role, ...)`
  初始化模块驱动，设置 UART、默认参数与模块角色。
* `read_status()`
  查询模块是否已入网。
* `set_query_interval(ms)`
  设置查询间隔。
* `reset_factory()`
  恢复出厂设置。
* `read_panid_channel()` / `set_panid(panid)`
  读取或设置 PANID 与信道。
* `set_baud(baud_idx)`
  设置串口波特率。
* `set_seek_time(seconds)`
  设置寻找网络时间。
* `enter_sleep()`
  请求模块进入休眠模式。
* `read_mac()` / `read_short_addr()`
  读取模块 MAC 地址或短地址。
* `is_joined()`
  判断模块是否已入网。
* `send_transparent(data)`
  透明模式发送数据。
* `send_node_to_coord(data)` / `send_coord_to_node(short_addr, data)`
  节点与协调器之间的数据发送。
* `_uart_write_raw(frame)` / `_uart_read_raw()`
  UART 底层读写接口。
* `_process_receive_buffer()` / `_frame_expected_length(ctrl, header_bytes)`
  接收缓冲区解析与帧长度校验。

该类支持 **协调器与节点** 的点对点通信，以及透明数据传输模式，可灵活用于物联网节点与 Zigbee 网络应用开发。

---

### main.py

该文件为 **CC253xTTL 模块功能测试程序**，无自定义类，仅包含程序入口逻辑。

主程序功能：

* 初始化 UART 接口与 RL-CC2530-A1 模块连接的 GPIO 引脚。
* 创建 `CC253xTTL` 驱动实例 `cor`（协调器）和 `env`（终端）。
* 通过 GPIO 控制模块唤醒。
* 读取并打印模块的短地址和 MAC 地址，用于验证通信是否正常。
* 可根据需要扩展为发送/接收测试数据的循环程序。

示例流程：

1. 上电延时 3 秒以确保模块初始化完成。
2. 初始化 UART 端口（如 UART0、UART1），设置 TX/RX 引脚与波特率。
3. 使用 GPIO 控制模块唤醒信号。
4. 创建 `CC253xTTL` 实例并绑定 UART。
5. 调用 `read_short_addr()`、`read_mac()` 等方法读取模块信息。

该程序可用于验证 CC2530 Zigbee 模块的硬件连接、串口通信与基本功能是否正常。

---

## 软件设计核心思想

* **模块化**：UART 通信与 Zigbee 协议处理解耦，核心功能封装在 `CC253xTTL` 类中，测试程序保持简洁。
* **事件驱动**：支持透明模式与命令响应机制，便于接入异步应用或 uasyncio 环境。
* **硬件兼容**：支持协调器、路由器与终端角色，用户可通过 `role` 参数灵活配置。
* **可扩展性**：提供节点间通信、透明数据传输、参数配置与休眠控制接口，方便构建 Zigbee 网络应用。

---

## 使用说明

### 安装方法
通过`thonny`工具调试：

**`连接好硬件之后：将code下文件一起上传于根目录，点击运行按钮 `**`

---

## 示例程序
* python

```python
# Python env   : MicroPython v1.23.0
# -*- coding: utf-8 -*-
# @Time    : 2025/9/5 下午10:11
# @Author  : ben0i0d
# @File    : main.py
# @Description : cc253x_ttl测试文件

# ======================================== 导入相关模块 =========================================

import time
from machine import UART,Pin
from cc253x_ttl import CC253xTTL

# ======================================== 全局变量 ============================================

# ======================================== 功能函数 ============================================

# ======================================== 自定义类 =============================================

# ======================================== 初始化配置 ===========================================

# 上电延时3s
time.sleep(3)
print("FreakStudio:cc253x_ttl test")

uart0 = UART(0, baudrate=9600, tx=Pin(0), rx=Pin(1))
uart1 = UART(1, baudrate=9600, tx=Pin(4), rx=Pin(5))
key = Pin(2, mode=Pin.OUT)

# 唤醒
key.value(0)
time.sleep(0.05)
key.value(1)

cor = CC253xTTL(uart0)
env = CC253xTTL(uart1)

# ========================================  主程序  ===========================================

print(cor.read_short_addr())
print(env.read_mac())
```
---

## 注意事项

* 模块工作电压为 3.0~3.6V，禁止接 5V 电源，以免烧毁模块
* 上电后建议延时 2~3 秒再进行 UART 通信或控制操作
* UART TX 接 MCU RX，UART RX 接 MCU TX，电平为 3.3V TTL
* 波特率必须与模块匹配，否则无法通信
* 协调器与节点必须使用相同 PANID 和信道才能加入网络
* 节点未入网时短地址为 0xFFFE，协调器短地址固定为 0x0000
* 透明模式发送数据前，确保目标节点已入网
* GPIO RESET/PIO 或 KEY 引脚用于复位或唤醒，操作时需遵守模块手册时序
* 高频数据传输时注意 UART 缓冲区溢出，定期读取接收缓冲
* 避免 2.4GHz 干扰源（如 Wi-Fi 或蓝牙）影响 Zigbee 通信
* 调试时可参考模块 LED 指示或 RSSI 信号判断网络状态
* OTA 或远程升级时，确保网络稳定，避免升级中断导致模块不可用

---

## 联系方式
如有任何问题或需要帮助，请通过以下方式联系开发者：  
📧 **邮箱**：10696531183@qq.com  
💻 **GitHub**：[https://github.com/FreakStudioCN](https://github.com/FreakStudioCN)  

---

## 许可协议
本项目中，除 `machine` 等 MicroPython 官方模块（MIT 许可证）外，所有由作者编写的驱动与扩展代码均采用 **知识共享署名-非商业性使用 4.0 国际版 (MIT)** 许可协议发布。  

您可以自由地：  
- **共享** : 在任何媒介以任何形式复制、发行本作品  
- **演绎** : 修改、转换或以本作品为基础进行创作  

惟须遵守下列条件：  
- **署名** : 您必须给出适当的署名，提供指向本许可协议的链接，同时标明是否（对原始作品）作了修改。您可以用任何合理的方式来署名，但是不得以任何方式暗示许可人为您或您的使用背书。  
- **非商业性使用** :您不得将本作品用于商业目的。  
- **合理引用方式** : 可在代码注释、文档、演示视频或项目说明中明确来源。  
- **声明：** 本项目中所有内容仅可学习或者个人爱好者使用，禁止商用，不得以任何形式以此代码做任何不合理的事情，代码具体可参考这个github项目https://github.com/peterhinch/micropython_ir，发生任何事情与署名作者无关。

- **版权归 FreakStudio 所有。**