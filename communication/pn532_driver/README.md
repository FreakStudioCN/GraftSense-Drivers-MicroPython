# PN532 NFCæ¨¡å—é©±åŠ¨ - MicroPythonç‰ˆæœ¬

## ç›®å½•
- [ç®€ä»‹](#ç®€ä»‹)
- [ä¸»è¦åŠŸèƒ½](#ä¸»è¦åŠŸèƒ½)
- [ç¡¬ä»¶è¦æ±‚](#ç¡¬ä»¶è¦æ±‚)
- [æ–‡ä»¶è¯´æ˜](#æ–‡ä»¶è¯´æ˜)
- [è½¯ä»¶è®¾è®¡æ ¸å¿ƒæ€æƒ³](#è½¯ä»¶è®¾è®¡æ ¸å¿ƒæ€æƒ³)
- [ä½¿ç”¨è¯´æ˜](#ä½¿ç”¨è¯´æ˜)
- [ç¤ºä¾‹ç¨‹åº](#ç¤ºä¾‹ç¨‹åº)
- [æ³¨æ„äº‹é¡¹](#æ³¨æ„äº‹é¡¹)
- [è”ç³»æ–¹å¼](#è”ç³»æ–¹å¼)
- [è®¸å¯åè®®](#è®¸å¯åè®®)

---

## ç®€ä»‹
PN532æ˜¯ä¸€æ¬¾é«˜æ€§èƒ½NFCè¿‘åœºé€šä¿¡èŠ¯ç‰‡ï¼Œæ”¯æŒå¤šç§å¡å‹è¯»å†™ï¼ˆMifare Classicã€NTAG2XXç­‰ï¼‰å’Œé€šä¿¡æ¥å£ã€‚è¯¥èŠ¯ç‰‡å¹¿æ³›åº”ç”¨äºç§»åŠ¨æ”¯ä»˜ã€èº«ä»½è¯†åˆ«ã€æ•°æ®ä¼ è¾“ã€é—¨ç¦ç³»ç»Ÿç­‰åœºæ™¯ã€‚

æœ¬é¡¹ç›®æä¾›åŸºäºMicroPythonçš„PN532æ¨¡å—é©±åŠ¨ä»£ç åŠæµ‹è¯•ç¨‹åºï¼Œæ”¯æŒé€šè¿‡UARTæ¥å£ä¸æ¨¡å—é€šä¿¡ï¼Œæ–¹ä¾¿å¼€å‘è€…å¿«é€Ÿå®ç°NFCå¡ç‰‡çš„æ£€æµ‹ä¸æ•°æ®è¯»å†™åŠŸèƒ½ã€‚

---

## ä¸»è¦åŠŸèƒ½
- **å¤šç§å¡å‹æ”¯æŒ**ï¼š
  - Mifare Classicç³»åˆ—ï¼ˆ1K/4Kï¼‰
  - NTAG2XXç³»åˆ—
  - å…¶ä»–ç¬¦åˆISO 14443 Type Aæ ‡å‡†çš„å¡ç‰‡
- **å®Œæ•´æ“ä½œé›†**ï¼š
  - å¡ç‰‡æ£€æµ‹ä¸æ¿€æ´»
  - æ•°æ®å—è¯»å†™
  - å¡ç‰‡UIDè·å–
  - æ¨¡å—å›ºä»¶ç‰ˆæœ¬æŸ¥è¯¢
- **ä½åŠŸè€—æ”¯æŒ**ï¼šæä¾›ä¼‘çœ ä¸å”¤é†’åŠŸèƒ½
- **ç»Ÿä¸€æ¥å£**ï¼šé€šè¿‡`PN532`ç±»æä¾›ä¸€è‡´æ“ä½œæ–¹æ³•
- **è·¨å¹³å°å…¼å®¹**ï¼šæ”¯æŒESP32ã€ESP8266ã€æ ‘è“æ´¾Picoç­‰MicroPythonå¼€å‘æ¿

---

## ç¡¬ä»¶è¦æ±‚
### æ¨èæµ‹è¯•ç¡¬ä»¶
- ESP32/ESP8266/æ ‘è“æ´¾Picoå¼€å‘æ¿
- PN532 NFCæ¨¡å—ï¼ˆUARTæ¥å£ç‰ˆæœ¬ï¼‰
- Mifare Classicæˆ–NTAG2XXç³»åˆ—æµ‹è¯•å¡ç‰‡
- æœé‚¦çº¿è‹¥å¹²

### æ¨¡å—å¼•è„šè¯´æ˜
| PN532å¼•è„š | åŠŸèƒ½æè¿° |
|-----------|----------|
| VCC       | ç”µæºæ­£æï¼ˆ3.3Vï¼Œæ³¨æ„ï¼šéƒ¨åˆ†æ¨¡å—æ”¯æŒ5Vï¼‰ |
| GND       | ç”µæºè´Ÿæ |
| TX        | UARTå‘é€å¼•è„š |
| RX        | UARTæ¥æ”¶å¼•è„š |
| RST       | å¤ä½å¼•è„šï¼ˆä½ç”µå¹³æœ‰æ•ˆï¼‰ |
| SDA       | I2Cæ•°æ®å¼•è„šï¼ˆæœ¬é¡¹ç›®æœªä½¿ç”¨ï¼‰ |
| SCL       | I2Cæ—¶é’Ÿå¼•è„šï¼ˆæœ¬é¡¹ç›®æœªä½¿ç”¨ï¼‰ |
| SS        | SPIç‰‡é€‰å¼•è„šï¼ˆæœ¬é¡¹ç›®æœªä½¿ç”¨ï¼‰ |

---

## æ–‡ä»¶è¯´æ˜
### pn532.py
åŒ…å«`PN532`åŸºç±»ï¼Œæä¾›NFCåŠŸèƒ½çš„æ ¸å¿ƒæ¥å£ï¼š
- `__init__(uart, rst_pin, debug=False)`ï¼šåˆå§‹åŒ–PN532æ¨¡å—ï¼Œå»ºç«‹ä¸ç¡¬ä»¶çš„è¿æ¥
- `wake_up()`ï¼šå”¤é†’ä¼‘çœ çŠ¶æ€çš„æ¨¡å—å¹¶éªŒè¯é€šä¿¡è¿æ¥
- `get_firmware_version()`ï¼šè·å–æ¨¡å—å›ºä»¶ç‰ˆæœ¬ä¿¡æ¯ï¼Œè¿”å›ç‰ˆæœ¬å·
- `sam_configuration()`ï¼šé…ç½®å®‰å…¨è®¿é—®æ¨¡å—(SAM)ï¼Œè®¾ç½®å¡ç‰‡è¯»å–æ¨¡å¼
- `read_passive_target()`ï¼šæ£€æµ‹å¹¶æ¿€æ´»é™„è¿‘çš„NFCå¡ç‰‡ï¼Œè¿”å›å¡ç‰‡UID
- `mifare_classic_read_block(block_number)`ï¼šè¯»å–Mifare Classicå¡ç‰‡æŒ‡å®šå—çš„æ•°æ®
- `mifare_classic_write_block(block_number, data)`ï¼šå‘Mifare Classicå¡ç‰‡æŒ‡å®šå—å†™å…¥æ•°æ®
- `ntag2xx_write_page(page_number, data)`ï¼šå‘NTAG2XXç³»åˆ—å¡ç‰‡æŒ‡å®šé¡µå†™å…¥æ•°æ®

### pn532_uart.py
åŒ…å«`PN532_UART`ç±»ï¼Œç»§æ‰¿è‡ª`PN532`åŸºç±»ï¼Œå®ç°UARTé€šä¿¡åŠŸèƒ½ï¼š
- `__init__(uart, rst_pin, debug=False)`ï¼šåˆå§‹åŒ–UARTé€šä¿¡æ¥å£
- `_write(data)`ï¼šé€šè¿‡UARTå‘é€æ•°æ®å¸§åˆ°PN532æ¨¡å—
- `_read()`ï¼šé€šè¿‡UARTä»PN532æ¨¡å—æ¥æ”¶æ•°æ®å¸§å¹¶è§£æ

### main.py
æ— ç±»å®šä¹‰ï¼ŒåŒ…å«æµ‹è¯•ä¸»å‡½æ•°`main()`ï¼š
- åˆå§‹åŒ–ç¡¬ä»¶æ¥å£å’ŒPN532æ¨¡å—
- æ‰§è¡Œæ¨¡å—è‡ªæ£€ï¼ˆå›ºä»¶ç‰ˆæœ¬æŸ¥è¯¢ã€SAMé…ç½®ï¼‰
- å¾ªç¯æ£€æµ‹NFCå¡ç‰‡å¹¶è¾“å‡ºå¡ç‰‡UID
- æä¾›å¯æ‰©å±•çš„å¡ç‰‡è¯»å†™æµ‹è¯•æ¡†æ¶

---

## è½¯ä»¶è®¾è®¡æ ¸å¿ƒæ€æƒ³
### åˆ†å±‚è®¾è®¡
- åº•å±‚ï¼šUARTé€šä¿¡åè®®å®ç°ï¼ˆ`pn532_uart.py`ï¼‰
- ä¸­å±‚ï¼šPN532å‘½ä»¤å°è£…ä¸è§£æï¼ˆ`pn532.py`ï¼‰
- é«˜å±‚ï¼šåº”ç”¨çº§APIä¸æµ‹è¯•æµç¨‹ï¼ˆ`main.py`ï¼‰

### é€šä¿¡åè®®
- åŸºäºPN532çš„å¸§æ ¼å¼å®ç°æ•°æ®æ”¶å‘
- åŒ…å«æ ¡éªŒæœºåˆ¶ç¡®ä¿æ•°æ®å®Œæ•´æ€§
- å®ç°å‘½ä»¤è¶…æ—¶é‡è¯•æœºåˆ¶

### è·¨å¹³å°å…¼å®¹
- ä»…ä¾èµ–MicroPythonæ ‡å‡†åº“
- ç¡¬ä»¶æ¥å£é€šè¿‡å‚æ•°æ³¨å…¥ï¼Œä¸å…·ä½“å¹³å°è§£è€¦
- ç»Ÿä¸€çš„é”™è¯¯å¤„ç†æœºåˆ¶

---

## ä½¿ç”¨è¯´æ˜
### ç¡¬ä»¶æ¥çº¿
#### ä»¥æ ‘è“æ´¾picoç¤ºä¾‹
| PN532å¼•è„š | GPIOå¼•è„š |
|-----------|----------|
| VCC       | 3.3V     |
| GND       | GND      |
| TX        | GPIO4    |
| RX        | GPIO5    |
| RST       | GPIO15   |

> **æ³¨æ„ï¼š**
> - ç¡®è®¤æ¨¡å—å·¥ä½œç”µå‹ï¼Œé¿å…ä½¿ç”¨5VæŸå3.3Væ¨¡å—
> - æ¥çº¿å‰ç¡®ä¿å¼€å‘æ¿å·²æ–­ç”µ
> - å¯æ ¹æ®å®é™…éœ€æ±‚ä¿®æ”¹å¼•è„šé…ç½®

---

### è½¯ä»¶ä¾èµ–
- **å›ºä»¶ç‰ˆæœ¬**ï¼šMicroPython v1.23.0+
- **å†…ç½®åº“**ï¼š
  - `machine`ï¼ˆGPIOä¸UARTæ§åˆ¶ï¼‰
  - `time`ï¼ˆå»¶æ—¶åŠŸèƒ½ï¼‰

---

### å®‰è£…æ­¥éª¤
1. å°†MicroPythonå›ºä»¶çƒ§å½•åˆ°å¼€å‘æ¿
2. ä¸Šä¼ `pn532.py`ã€`uart.py`å’Œ`main.py`åˆ°å¼€å‘æ¿
3. æ ¹æ®ç¡¬ä»¶è¿æ¥ä¿®æ”¹`main.py`ä¸­çš„å¼•è„šé…ç½®
4. è¿è¡Œ`main.py`å¼€å§‹æµ‹è¯•

---

## ç¤ºä¾‹ç¨‹åº
```python
# MicroPython v1.23.0
# -*- coding: utf-8 -*-   
# @Time    : 2025/9/4 ä¸‹åˆ3:50
# @Author  : ç¼ªè´µæˆ
# @File    : main.py
# @Description : åŸºäºPN532çš„NFCæ¨¡å—é©±åŠ¨æµ‹è¯•æ–‡ä»¶   æµ‹è¯• Mifare Classic ç±»å‹ï¼ˆå…¬äº¤å¡ç­‰ï¼‰IDè¯»å–ã€Block4è®¤è¯ã€è¯»å†™

# ======================================== å¯¼å…¥ç›¸å…³æ¨¡å— =========================================

import time
from machine import UART, Pin
from uart import PN532_UART
from pn532 import MIFARE_CMD_AUTH_A

# ======================================== å…¨å±€å˜é‡ ============================================

# ======================================== åŠŸèƒ½å‡½æ•° ============================================

# ======================================== è‡ªå®šä¹‰ç±» ============================================

# ======================================== åˆå§‹åŒ–é…ç½® ===========================================

time.sleep(3)
print("FreakStudio: Test NFC module functionality")

# UART åˆå§‹åŒ– (æ ¹æ®ç¡¬ä»¶å®é™…å¼•è„šè°ƒæ•´)
uart = UART(1, baudrate=115200, tx=Pin(8), rx=Pin(9))
# å¯é€‰ï¼šResetå¼•è„š
# reset_pin = Pin(15, Pin.OUT)

# åˆ›å»º PN532 å®ä¾‹
nfc = PN532_UART(uart, reset=None, debug=True)

# åˆå§‹åŒ– PN532
print("Initializing PN532...")
# nfc.reset()

# è·å–å›ºä»¶ç‰ˆæœ¬
try:
    version = nfc.firmware_version
    print("PN532 firmware version:", version)
except RuntimeError as e:
    print("Failed to read firmware version:", e)
    time.sleep(3)

# é…ç½® SAM (ç”¨äºè¯»å¡)
nfc.SAM_configuration()
print("PN532 SAM configured")
time.sleep(3)

# ======================================== ä¸»ç¨‹åº =============================================

while True:
    try:
        print("---- Waiting for card (Mifare Classic) ----")
        uid = nfc.read_passive_target(timeout=1000)

        if uid is None:
            print("No card detected")
            time.sleep(2)
            continue

        print("Card detected UID:", [hex(i) for i in uid])
        time.sleep(2)

        # ==================== Mifare Classic æµ‹è¯• ====================
        key_default = b"\xFF\xFF\xFF\xFF\xFF\xFF"
        block_num = 4

        if nfc.mifare_classic_authenticate_block(uid, block_num, MIFARE_CMD_AUTH_A, key_default):
            print(f"Block {block_num} authentication successful")
            time.sleep(1)

            data = nfc.mifare_classic_read_block(block_num)
            if data:
                print(f"Read block {block_num} data:", [hex(i) for i in data])
            time.sleep(1)

            test_data = bytes([0x01] * 16)
            if nfc.mifare_classic_write_block(block_num, test_data):
                print(f"Successfully wrote block {block_num}: {[hex(i) for i in test_data]}")
            time.sleep(1)
        else:
            print(f"Block {block_num} authentication failed")
            time.sleep(1)

        # ==================== ä½åŠŸè€—æµ‹è¯• ====================
        print("Entering low power mode...")
        if nfc.power_down():
            print("PN532 entered low power mode")
        time.sleep(2)

        print("Waking up...")
        nfc.reset()
        print("Wake up complete")
        time.sleep(2)

    except Exception as e:
        print("Error:", e)
        time.sleep(2)


```
---

## æ³¨æ„äº‹é¡¹
### é€šä¿¡é—®é¢˜
- ç¡®ä¿ UART æ³¢ç‰¹ç‡ä¸æ¨¡å—ä¸€è‡´ï¼ˆé»˜è®¤é€šå¸¸ä¸º 115200ï¼‰
- è¿‡é•¿çš„æœé‚¦çº¿å¯èƒ½å¯¼è‡´é€šä¿¡ä¸ç¨³å®š
- é¿å…ä¸å…¶ä»– UART è®¾å¤‡å…±ç”¨åŒä¸€æ€»çº¿

### å¡ç‰‡å…¼å®¹æ€§
- Mifare Classic 4K å¡ç‰‡éœ€è¦ç‰¹æ®Šå¤„ç†æ‰‡åŒºç»“æ„
- NTAG2XX ç³»åˆ—å¡ç‰‡æœ‰ä¸åŒçš„é¡µå¤§å°å’Œå®¹é‡
- éƒ¨åˆ†åŠ å¯†å¡ç‰‡éœ€è¦å¯†é’¥æ‰èƒ½è¯»å†™æ•°æ®

### ç”µæºè¦æ±‚
- å»ºè®®ä½¿ç”¨ 3.3V ç¨³å®šç”µæº
- æ¨¡å—åœ¨è¯»å†™æ“ä½œæ—¶ç”µæµä¼šå¢å¤§ï¼Œç¡®ä¿ç”µæºèƒ½æä¾›è¶³å¤Ÿç”µæµ

### ä½¿ç”¨ç¯å¢ƒ
- é¿å…é‡‘å±ç¯å¢ƒå½±å“ NFC ä¿¡å·
- å¡ç‰‡ä¸æ¨¡å—è·ç¦»å»ºè®®ä¿æŒåœ¨ 5cm ä»¥å†…
- é«˜æ¸©é«˜æ¹¿ç¯å¢ƒå¯èƒ½å½±å“æ¨¡å—æ€§èƒ½

---

## è”ç³»æ–¹å¼
å¦‚æœ‰ä»»ä½•é—®é¢˜æˆ–éœ€è¦å¸®åŠ©ï¼Œè¯·é€šè¿‡ä»¥ä¸‹æ–¹å¼è”ç³»å¼€å‘è€…ï¼š  
ğŸ“§ **é‚®ç®±**ï¼š10696531183@qq.com  
ğŸ’» **GitHub**ï¼šhttps://github.com/FreakStudioCN

---

## è®¸å¯åè®®
æœ¬é¡¹ç›®ä¸­ï¼Œé™¤ `machine` ç­‰ MicroPython å®˜æ–¹æ¨¡å—ï¼ˆMIT è®¸å¯è¯ï¼‰å¤–ï¼Œæ‰€æœ‰ç”±ä½œè€…ç¼–å†™çš„é©±åŠ¨ä¸æ‰©å±•ä»£ç å‡é‡‡ç”¨ **çŸ¥è¯†å…±äº«ç½²å-éå•†ä¸šæ€§ä½¿ç”¨ 4.0 å›½é™…ç‰ˆ (CC BY-NC 4.0)** è®¸å¯åè®®å‘å¸ƒã€‚  

æ‚¨å¯ä»¥è‡ªç”±åœ°ï¼š  
- **å…±äº«** â€” åœ¨ä»»ä½•åª’ä»‹ä»¥ä»»ä½•å½¢å¼å¤åˆ¶ã€å‘è¡Œæœ¬ä½œå“  
- **æ¼”ç»** â€” ä¿®æ”¹ã€è½¬æ¢æˆ–ä»¥æœ¬ä½œå“ä¸ºåŸºç¡€è¿›è¡Œåˆ›ä½œ  

æƒŸé¡»éµå®ˆä¸‹åˆ—æ¡ä»¶ï¼š  
- **ç½²å** â€” æ‚¨å¿…é¡»ç»™å‡ºé€‚å½“çš„ç½²åï¼Œæä¾›æŒ‡å‘æœ¬è®¸å¯åè®®çš„é“¾æ¥ï¼ŒåŒæ—¶æ ‡æ˜æ˜¯å¦ï¼ˆå¯¹åŸå§‹ä½œå“ï¼‰ä½œäº†ä¿®æ”¹ã€‚æ‚¨å¯ä»¥ç”¨ä»»ä½•åˆç†çš„æ–¹å¼æ¥ç½²åï¼Œä½†æ˜¯ä¸å¾—ä»¥ä»»ä½•æ–¹å¼æš—ç¤ºè®¸å¯äººä¸ºæ‚¨æˆ–æ‚¨çš„ä½¿ç”¨èƒŒä¹¦ã€‚  
- **éå•†ä¸šæ€§ä½¿ç”¨** â€” æ‚¨ä¸å¾—å°†æœ¬ä½œå“ç”¨äºå•†ä¸šç›®çš„ã€‚  
- **åˆç†å¼•ç”¨æ–¹å¼** â€” å¯åœ¨ä»£ç æ³¨é‡Šã€æ–‡æ¡£ã€æ¼”ç¤ºè§†é¢‘æˆ–é¡¹ç›®è¯´æ˜ä¸­æ˜ç¡®æ¥æºã€‚  
- **è¯´æ˜** â€” ä»£ç å«å‚è€ƒéƒ¨åˆ†,å‡ºç°éæŠ€æœ¯é—®é¢˜å’Œç½²åä½œè€…æ— å…³ã€‚  
**ç‰ˆæƒå½’ FreakStudio æ‰€æœ‰ã€‚**
