# MicroPython TAS-LAN-755C驱动库

## 目录
- [简介](#简介)
- [主要功能](#主要功能)
- [支持的协议](#支持的协议)
- [硬件要求](#硬件要求)
- [文件说明](#文件说明)
- [软件设计核心思想](#软件设计核心思想)
- [使用说明](#使用说明)
- [示例程序](#示例程序)
- [注意事项](#注意事项)
- [许可协议](#许可协议)

---

## 简介

本项目是一个针对 **TAS-LAN-755C 串口转以太网模块** 的 MicroPython 设备驱动库，提供了串口与以太网之间的双向透明数据传输功能。
模块基于 **Cortex-M0 内核（32MHz 主频）**，内置完善的软件协议栈，支持 TCP/UDP/HTTP/Modbus 等多种常见应用场景。用户可通过简单的 AT 指令或网页配置，即可实现稳定可靠的数据传输，广泛应用于工业自动化、物联网网关、远程监控等领域。

---

## 主要功能

* 支持 **串口 ↔ 网口** 的双向透明传输
* 支持 **TCP Server 模式**（最多 3 路 Client 连接）
* 支持 **TCP/UDP/HTTP/ModbusRTU ↔ ModbusTCP 转换**
* 支持 **UDP 广播、UDP 组播**
* 支持 **DHCP 动态 IP、DNS 域名解析**
* 支持 **网页配置、AT 指令配置、UDP 广播配置**
* 提供 **自定义注册包**、**业务心跳包**、**底层协议心跳保活**，保证连接真实可靠
* 支持 **串口波特率 1200bps ~ 115200bps**，并支持 **None / Odd / Even** 校验模式
* 支持 **串口硬件流控、485 收发控制**
* 支持 **10 路自定义轮询**
* 支持 **定时重启、恢复出厂设置（AT 指令或硬件 Reload 引脚）**
* 支持 **塔石 DTU 云平台**，可通过网页远程查看数据

---

## 支持的协议 / 模式

* **TCP Client / TCP Server**
* **UDP 单播 / 组播 / 广播**
* **HTTP 数据传输**
* **Modbus RTU ↔ Modbus TCP 协议转换**
* **TAS 云平台接入**

---

## 硬件要求

### 通信端

* **TAS-LAN-755C 串口转以太网模块**
* 串口连接导线（TTL/RS485 视应用选择）
* 支持 MicroPython 的开发板（如 Raspberry Pi Pico、ESP32 等，用于串口配置与数据交互）

### 接线方式（以 TTL 串口模式 + Pico 为例）

| 模块类型         | 引脚功能   | 连接说明                                   |
| ------------ | ------ | -------------------------------------- |
| TAS-LAN-755C | VCC    | 接开发板 3.3V 或 5V（请确认模块规格）                |
| TAS-LAN-755C | GND    | 接开发板 GND（共地）                           |
| TAS-LAN-755C | TXD    | 接开发板 GPIO RX 引脚（如 Pico 的 GP5/UART1 RX） |
| TAS-LAN-755C | RXD    | 接开发板 GPIO TX 引脚（如 Pico 的 GP4/UART1 TX） |
| TAS-LAN-755C | RELOAD | 可选，用于恢复出厂设置（拉低一段时间触发）                  |
| TAS-LAN-755C | 485_EN | 可选，用于 RS485 模式下收发控制                    |

---

## 文件说明

### tas_755c_eth.py

该文件实现 **TAS-LAN-755C 串口转以太网模块** 的核心驱动功能，仅包含 `TAS_755C_ETH` 类，用于通过 UART 与模块交互并完成 AT 命令配置。

`TAS_755C_ETH` 类对 AT 命令进行了封装，提供串口、网络、HTTP、心跳、注册、轮询、Modbus、MQTT、云平台等功能的配置接口。类中包含以下主要特性：

* `_uart`：用于存储 UART 通信对象，负责与模块进行数据交互。
* `_send_at(cmd: str)`：封装 AT 命令发送与响应解析逻辑，统一返回 `(bool, str)` 格式。
* 支持丰富的配置方法（如 `set_uart_config`、`set_tcp_config`、`set_mqtt_client` 等），便于快速上手使用。
* 提供 `enter_command_mode()` 与 `enter_data_mode()`，支持命令模式与透传模式切换。
* 提供 `send_raw_command()` 与 `discovery()`，方便扩展与设备发现。

---

### main.py

该文件为 **TAS-LAN-755C 模块的功能测试程序**，无自定义类，仅包含程序入口逻辑。

主程序功能：

* 上电延时，保证模块初始化完成。
* 初始化与模块连接的 UART 引脚。
* 创建 `TAS_755C_ETH` 驱动实例，进入命令模式并执行测试操作（如 MQTT 配置读取）。
* 切换回数据透传模式，用于测试实际通信。
* 在循环中实时监控串口数据接收并打印输出。

该程序可用于验证 UART 硬件连接正确性、AT 命令交互与透传模式功能是否正常。

---

## 软件设计核心思想

* **模块化**：驱动类与应用逻辑分离，`TAS_755C_ETH` 专注于 AT 命令封装，测试程序保持简洁。
* **统一接口**：所有配置方法返回 `(bool, str)`，简化调用层对执行状态与结果的处理。
* **跨平台适配**：基于 `machine.UART` 实现，可在 ESP32、Raspberry Pi Pico 等多种 MicroPython 硬件上运行。
* **模式切换**：支持命令模式与数据模式自由切换，兼顾配置与透传应用。
* **扩展性**：保留原始命令接口，便于支持未封装的功能或自定义需求。
* **设备管理**：支持广播发现与网络配置，适合批量部署与远程管理场景。

---

## 使用说明

### 安装方法
通过`thonny`工具调试：

**`连接好硬件之后：将code下文件一起上传于根目录，点击运行按钮 `**`

---

## 示例程序
* python

```python
# Python env   : MicroPython v1.23.0
# -*- coding: utf-8 -*-
# @Time    : 2025/9/5 下午10:11
# @Author  : ben0i0d
# @File    : main.py
# @Description : tas755c测试文件

# ======================================== 导入相关模块 =========================================

import time
from machine import UART, Pin
from tas_755c_eth import TAS_755C_ETH

# ======================================== 全局变量 ============================================

# ======================================== 功能函数 ============================================

# ======================================== 自定义类 =============================================

# ======================================== 初始化配置 ===========================================

# 上电延时3s
time.sleep(3)
print("FreakStudio:tas755c test")
# 初始化 UART 通信（按硬件实际接线调整 TX/RX）
uart0 = UART(0, baudrate=9600, tx=Pin(0), rx=Pin(1))
# 创建 HC14_Lora 实例
tas = TAS_755C_ETH(uart0)
# 切换AT模式
tas.enter_command_mode()

print(tas.get_mqtt_pubtopic())

tas.enter_data_mode()
# ========================================  主程序  ===========================================
while True:
    
    if tas._uart.any():
        print(tas._uart.read().decode('utf-8'))
```
---

## 注意事项

* **供电电压**：模块需 3.3V/5V 稳定供电，电源波动可能导致复位或通信异常。
* **串口电平**：请确认开发板与模块串口电平匹配（TTL 3.3V/5V），避免电平不符造成损坏。
* **波特率配置**：串口波特率可设置为 1200bps~115200bps，需与上位机或 MCU 保持一致。
* **模式切换**：配置需在 **命令模式** 下进行，数据透传需切换至 **数据模式**，注意两者的区分。
* **网络配置**：支持 DHCP 和静态 IP，若处于局域网中建议开启 DHCP，跨网应用可使用静态配置。
* **心跳与注册包**：
  * TCP 心跳机制用于保持底层连接，防止掉线。
  * 自定义心跳/注册包可验证连接真实性，避免“假连接”。
* **多连接场景**：TCP Server 模式下最多支持 3 个客户端，需合理分配端口和连接数。
* **AT 指令恢复**：可通过 AT 命令或硬件 `Reload` 脚恢复出厂设置，避免误操作导致无法连接。
* **轮询与定时重启**：启用轮询时要注意间隔设置，避免对 MCU 或网络造成负担；定时重启功能适合远程无人值守场景。
* **协议转换**：支持 Modbus RTU ↔ TCP 转换，应用时需注意寄存器地址和协议一致性。
* **安全性**：若使用 HTTP/MQTT 透传云平台，建议开启登录校验，避免未经授权的访问。
* **应用环境**：避免强电磁干扰环境，确保网络稳定性；在 Internet 应用中建议使用固定公网或通过云平台转发。

---

## 联系方式
如有任何问题或需要帮助，请通过以下方式联系开发者：  
📧 **邮箱**：10696531183@qq.com  
💻 **GitHub**：[https://github.com/FreakStudioCN](https://github.com/FreakStudioCN)  

---

## 许可协议
本项目中，除 `machine` 等 MicroPython 官方模块（MIT 许可证）外，所有由作者编写的驱动与扩展代码均采用 **知识共享署名-非商业性使用 4.0 国际版 (CC BY-NC 4.0)** 许可协议发布。  

您可以自由地：  
- **共享** : 在任何媒介以任何形式复制、发行本作品  
- **演绎** : 修改、转换或以本作品为基础进行创作  

惟须遵守下列条件：  
- **署名** : 您必须给出适当的署名，提供指向本许可协议的链接，同时标明是否（对原始作品）作了修改。您可以用任何合理的方式来署名，但是不得以任何方式暗示许可人为您或您的使用背书。  
- **非商业性使用** :您不得将本作品用于商业目的。  
- **合理引用方式** : 可在代码注释、文档、演示视频或项目说明中明确来源。  
- **声明：** 本项目中所有内容仅可学习或者个人爱好者使用，禁止商用，不得以任何形式以此代码做任何不合理的事情，代码具体可参考这个github项目https://github.com/peterhinch/micropython_ir，发生任何事情与署名作者无关。

- **版权归 FreakStudio 所有。**