# GraftSense çº¢å¤–æ”¶å‘æ¨¡å—é©±åŠ¨ï¼ˆMicroPythonï¼‰

# GraftSense çº¢å¤–æ”¶å‘æ¨¡å—é©±åŠ¨é©±åŠ¨ï¼ˆMicroPythonï¼‰

## ç›®å½•

- [ç®€ä»‹](#ç®€ä»‹)
- [ä¸»è¦åŠŸèƒ½](#ä¸»è¦åŠŸèƒ½)
- [ç¡¬ä»¶è¦æ±‚](#ç¡¬ä»¶è¦æ±‚)
- [æ–‡ä»¶è¯´æ˜](#æ–‡ä»¶è¯´æ˜)
- [è½¯ä»¶è®¾è®¡æ ¸å¿ƒæ€æƒ³](#è½¯ä»¶è®¾è®¡æ ¸å¿ƒæ€æƒ³)
- [ä½¿ç”¨è¯´æ˜](#ä½¿ç”¨è¯´æ˜)
- [ç¤ºä¾‹ç¨‹åº](#ç¤ºä¾‹ç¨‹åº)
- [æ³¨æ„äº‹é¡¹](#æ³¨æ„äº‹é¡¹)
- [è”ç³»æ–¹å¼](#è”ç³»æ–¹å¼)
- [è®¸å¯åè®®](#è®¸å¯åè®®)

---

## ç®€ä»‹

æœ¬é¡¹ç›®ä¸º **GraftSense IR Receiver v1.1ï¼ˆåŸºäº TSOP34138 çš„çº¢å¤–æ¥æ”¶æ¨¡å—ï¼‰** æä¾›äº†å®Œæ•´çš„ MicroPython é©±åŠ¨æ”¯æŒï¼Œæ”¯æŒçº¢å¤–ä¿¡å·çš„æ¥æ”¶è§£ç ä¸å‘å°„ï¼Œå…¼å®¹ NEC åè®®ï¼ˆåŒ…æ‹¬ NEC_8ã€NEC_16 åŠä¸‰æ˜Ÿå˜ä½“ï¼‰ï¼Œå¹¶æä¾›åè®®å—…æ¢ä¸å›æ”¾åŠŸèƒ½ã€‚é©±åŠ¨é‡‡ç”¨åˆ†å±‚è®¾è®¡ï¼Œåœ¨æ ‘è“æ´¾ Pico ç­‰ RP2 å¹³å°ä¸Šé€šè¿‡ PIO å®ç°é«˜æ€§èƒ½çº¢å¤–å‘å°„ï¼Œé€‚ç”¨äºçº¢å¤–é¥æ§å®éªŒã€æ™ºèƒ½å®¶å±…æ§åˆ¶æ¼”ç¤ºã€ç”µå­ DIY æ— çº¿æ§åˆ¶ç­‰åœºæ™¯ï¼Œä¸ºéæ¥è§¦å¼çº¢å¤–äº¤äº’æä¾›å¯é çš„ä¿¡å·å¤„ç†èƒ½åŠ›ã€‚

---

## ä¸»è¦åŠŸèƒ½

- âœ… æ”¯æŒ NEC åè®®è§£ç ï¼šåŒ…å« NEC_8ï¼ˆ8 ä½åœ°å€ï¼‰ã€NEC_16ï¼ˆ16 ä½åœ°å€ï¼‰åŠä¸‰æ˜Ÿ NEC å˜ä½“
- âœ… æ”¯æŒçº¢å¤–ä¿¡å·å‘å°„ï¼šé€šè¿‡ PWM/PIO ç”Ÿæˆ 38kHz è½½æ³¢ï¼Œå‘é€ NEC åè®®æŒ‡ä»¤
- âœ… æä¾›åè®®å—…æ¢ä¸å›æ”¾ï¼šæ•è·åŸå§‹çº¢å¤–è„‰å†²åºåˆ—ï¼Œæ”¯æŒåè®®è¯†åˆ«ä¸æ•°æ®å­˜å‚¨
- âœ… RP2 å¹³å°ä¸“å±ä¼˜åŒ–ï¼šä½¿ç”¨ PIO çŠ¶æ€æœºå®ç°é«˜ç²¾åº¦è„‰å†²å‘å°„ï¼Œé™ä½ CPU å ç”¨
- âœ… å›è°ƒæœºåˆ¶è§£è€¦ï¼šæ¥æ”¶ä¿¡å·åè‡ªåŠ¨è§¦å‘ç”¨æˆ·å›è°ƒï¼Œæ”¯æŒåœ°å€ã€å‘½ä»¤åŠé‡å¤ç è§£æ
- âœ… å®Œå–„çš„é”™è¯¯å¤„ç†ï¼šå®šä¹‰å¤šç§å¼‚å¸¸ç ï¼ˆå¦‚ REPEATã€BADSTART ç­‰ï¼‰ï¼Œä¾¿äºè°ƒè¯•
- âœ… éµå¾ª Grove æ¥å£æ ‡å‡†ï¼Œå…¼å®¹ä¸»æµå¼€å‘æ¿ä¸ä¼ æ„Ÿå™¨ç”Ÿæ€

---

## ç¡¬ä»¶è¦æ±‚

1. **æ ¸å¿ƒç¡¬ä»¶**ï¼šGraftSense IR Receiver v1.1 çº¢å¤–æ¥æ”¶æ¨¡å—ï¼ˆåŸºäº TSOP34138 èŠ¯ç‰‡ï¼Œæ”¯æŒ 38kHz è½½æ³¢è§£è°ƒï¼‰
2. **ä¸»æ§è®¾å¤‡**ï¼šæ”¯æŒ MicroPython v1.23.0 åŠä»¥ä¸Šç‰ˆæœ¬çš„å¼€å‘æ¿ï¼ˆå¦‚æ ‘è“æ´¾ Picoã€ESP32 ç­‰ï¼ŒRP2 å¹³å°æ”¯æŒ PIO å‘å°„ä¼˜åŒ–ï¼‰
3. **æ¥çº¿é…ä»¶**ï¼šGrove 4Pin çº¿ï¼ˆç”¨äºè¿æ¥æ¨¡å—çš„ DINã€GNDã€VCC å¼•è„šä¸å¼€å‘æ¿ï¼‰
4. **ç”µæº**ï¼š3.3V~5V ç¨³å®šç”µæºï¼ˆæ¨¡å—å…¼å®¹ 3.3V å’Œ 5V ä¾›ç”µï¼Œå†…ç½®æ»¤æ³¢ç”µè·¯ï¼‰

---

## æ–‡ä»¶è¯´æ˜

---

## è½¯ä»¶è®¾è®¡æ ¸å¿ƒæ€æƒ³

1. **åˆ†å±‚æ¶æ„**ï¼šå°†å‘å°„ï¼ˆ`ir_tx`ï¼‰ä¸æ¥æ”¶ï¼ˆ`ir_rx`ï¼‰åŠŸèƒ½åˆ†ç¦»ï¼Œé™ä½æ¨¡å—è€¦åˆï¼Œä¾¿äºæ‰©å±•å…¶ä»–åè®®
2. **åè®®æŠ½è±¡**ï¼šé€šè¿‡ `NEC_ABC` åŸºç±»å°è£… NEC åè®®æ ¸å¿ƒé€»è¾‘ï¼Œå­ç±»å®ç°ä¸åŒåœ°å€æ¨¡å¼ï¼ˆ8 ä½ / 16 ä½ï¼‰ä¸ä¸‰æ˜Ÿå˜ä½“
3. **ç¡¬ä»¶åŠ é€Ÿ**ï¼šRP2 å¹³å°ä½¿ç”¨ PIO çŠ¶æ€æœºå®ç°çº¢å¤–å‘å°„ï¼Œå°†è„‰å†²ç”Ÿæˆå¸è½½åˆ°ç¡¬ä»¶ï¼Œæå‡å®æ—¶æ€§ä¸ CPU åˆ©ç”¨ç‡
4. **å›è°ƒé©±åŠ¨**ï¼šæ¥æ”¶è§£ç å®Œæˆåé€šè¿‡å›è°ƒå‡½æ•°é€šçŸ¥ç”¨æˆ·ï¼Œè§£è€¦ç¡¬ä»¶æ£€æµ‹ä¸ä¸šåŠ¡é€»è¾‘
5. **å¯ç§»æ¤æ€§**ï¼šæ ¸å¿ƒåè®®é€»è¾‘ä¾èµ–æ ‡å‡† MicroPython æ¥å£ï¼ŒPIO é©±åŠ¨ä»…ä½œä¸ºå¹³å°ä¸“å±ä¼˜åŒ–ï¼Œä¸å½±å“æ ¸å¿ƒåŠŸèƒ½ç§»æ¤
6. **é”™è¯¯ç è®¾è®¡**ï¼šå®šä¹‰ç»Ÿä¸€çš„å¼‚å¸¸ç ä½“ç³»ï¼Œä¾¿äºå¿«é€Ÿå®šä½åè®®è§£ææˆ–ç¡¬ä»¶é€šä¿¡é—®é¢˜

---

## ä½¿ç”¨è¯´æ˜

### ç¯å¢ƒå‡†å¤‡

- åœ¨å¼€å‘æ¿ä¸Šçƒ§å½• **MicroPython v1.23.0+** å›ºä»¶
- å°† `ir_tx`ã€`ir_rx` ç›®å½•åŠ `main.py` ä¸Šä¼ è‡³å¼€å‘æ¿æ–‡ä»¶ç³»ç»Ÿ

### ç¡¬ä»¶è¿æ¥

- **æ¥æ”¶æ¨¡å—**ï¼šä½¿ç”¨ Grove çº¿å°†æ¨¡å—çš„ `DIN` å¼•è„šè¿æ¥è‡³å¼€å‘æ¿æŒ‡å®š GPIO å¼•è„šï¼ˆå¦‚ç¤ºä¾‹ä¸­çš„ GPIO 14ï¼‰ï¼Œè¿æ¥ `GND` å’Œ `VCC` å¼•è„š
- **å‘å°„æ¨¡å—**ï¼šå°†çº¢å¤–å‘å°„ç®¡è¿æ¥è‡³å¼€å‘æ¿æŒ‡å®š GPIO å¼•è„šï¼ˆå¦‚ç¤ºä¾‹ä¸­çš„ GPIO 6ï¼‰ï¼Œç¡®ä¿ä¾›ç”µç¨³å®š
- **æ³¨æ„**ï¼šRP2 å¹³å°ä½¿ç”¨ PIO å‘å°„æ—¶ï¼Œéœ€ç¡®ä¿å¼•è„šä¸çŠ¶æ€æœºé…ç½®åŒ¹é…

### ä»£ç é…ç½®

- åœ¨ `main.py` ä¸­ä¿®æ”¹ `TX_PIN` å’Œ `RX_PIN` ä¸ºå®é™…è¿æ¥çš„ GPIO å¼•è„šå·
- å¦‚éœ€åˆ‡æ¢åè®®ï¼Œå¯æ›¿æ¢ `NEC_16` ä¸º `NEC_8` æˆ– `SAMSUNG`ï¼Œå¹¶è°ƒæ•´å›è°ƒå‡½æ•°å‚æ•°

### è¿è¡Œæµ‹è¯•

- é‡å¯å¼€å‘æ¿ï¼Œ`main.py` å°†è‡ªåŠ¨æ‰§è¡Œï¼Œå¾ªç¯å‘é€ NEC ä¿¡å·å¹¶å®æ—¶æ‰“å°æ¥æ”¶åˆ°çš„åœ°å€ã€å‘½ä»¤åŠé‡å¤ç ä¿¡æ¯

---

## ç¤ºä¾‹ç¨‹åº

### NEC åè®®æ”¶å‘æµ‹è¯•ï¼ˆmain.pyï¼‰

```python
import time
from machine import Pin
from ir_tx.nec import NEC
from ir_rx.nec import NEC_16

def ir_callback(addr: int, cmd: int, repeat: bool) -> None:
    print(f"[RX] Address=0x{addr:04X}, Cmd=0x{cmd:02X}, Repeat={repeat}")

time.sleep(3)
print("FreakStudio:Infrared transceiver test")

TX_PIN = Pin(6, Pin.OUT)
RX_PIN = Pin(14, Pin.IN)

ir_tx = NEC(TX_PIN, freq=38000)
ir_rx = NEC_16(RX_PIN, ir_callback)

print("[System] Ready... TX=GP6, RX=GP14")

while True:
    print("[TX] Sending NEC signal...")
    ir_tx.transmit(0x10, 0x20)
    time.sleep(2)
```

---

## æ³¨æ„äº‹é¡¹

1. **è½½æ³¢é¢‘ç‡**ï¼šæ¨¡å—é»˜è®¤æ”¯æŒ 38kHz è½½æ³¢ï¼Œå‘å°„æ—¶éœ€è®¾ç½® `freq=38000`ï¼Œé¿å…ä¸å…¶ä»–è®¾å¤‡å¹²æ‰°
2. **ç”µå¹³å…¼å®¹**ï¼šæ¨¡å—è¾“å‡ºä½ç”µå¹³æœ‰æ•ˆï¼ˆæ— æœ‰æ•ˆä¿¡å·æ—¶ä¸ºé«˜ç”µå¹³ï¼‰ï¼Œéœ€ç¡®ä¿ä¸»æ§ GPIO è¾“å…¥æ¨¡å¼é…ç½®æ­£ç¡®
3. **å¹³å°é™åˆ¶**ï¼š`rp2_rmt.py` ä»…æ”¯æŒ RP2 å¹³å°ï¼ˆå¦‚æ ‘è“æ´¾ Picoï¼‰ï¼Œå…¶ä»–å¹³å°éœ€ä½¿ç”¨é€šç”¨ PWM å‘å°„å®ç°
4. **å›è°ƒå‡½æ•°**ï¼šå›è°ƒå‡½æ•°åº”ä¿æŒç®€æ´ï¼Œé¿å…æ‰§è¡Œè€—æ—¶æ“ä½œï¼Œç¡®ä¿ä¸é˜»å¡ä¸­æ–­å¤„ç†
5. **ç¯å¢ƒå¹²æ‰°**ï¼šå¼ºå…‰ç¯å¢ƒå¯èƒ½å½±å“çº¢å¤–æ¥æ”¶çµæ•åº¦ï¼Œå»ºè®®åœ¨å®¤å†…æˆ–å¼±å…‰ç¯å¢ƒä¸‹ä½¿ç”¨
6. **é‡å¤ç å¤„ç†**ï¼šNEC åè®®æ”¯æŒé•¿æŒ‰é‡å¤ç ï¼Œå›è°ƒå‡½æ•°ä¸­é€šè¿‡ `repeat` å‚æ•°åŒºåˆ†é¦–æ¬¡è§¦å‘ä¸é•¿æŒ‰é‡å¤

---

## è”ç³»æ–¹å¼

å¦‚æœ‰ä»»ä½•é—®é¢˜æˆ–éœ€è¦å¸®åŠ©ï¼Œè¯·é€šè¿‡ä»¥ä¸‹æ–¹å¼è”ç³»å¼€å‘è€…ï¼š

ğŸ“§ **é‚®ç®±**ï¼šliqinghsui@freakstudio.cn

ğŸ’» **GitHub**ï¼š[https://github.com/FreakStudioCN](https://github.com/FreakStudioCN)

---

## è®¸å¯åè®®

```
MIT License

Copyright (c) 2025 FreakStudio

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in all
copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
SOFTWARE.
```