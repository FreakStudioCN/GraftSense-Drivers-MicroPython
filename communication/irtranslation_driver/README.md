# MicroPython IR 红外收发驱动库

## 目录
- [简介](#简介)
- [主要功能](#主要功能)
- [支持的协议](#支持的协议)
- [硬件要求](#硬件要求)
- [文件说明](#文件说明)
- [软件设计核心思想](#软件设计核心思想)
- [使用说明](#使用说明)
- [示例程序](#示例程序)
- [注意事项](#注意事项)
- [许可协议](#许可协议)

---

## 简介
本项目是一个针对红外（IR）遥控器的MicroPython设备驱动库，提供了全面的红外信号接收（解码）和发射（编码）功能。该库设计简洁、模块化，支持多种主流红外通信协议，可在多种MicroPython兼容硬件平台上运行，适用于遥控设备开发、红外信号分析等场景。

---

## 主要功能
- 提供非阻塞式红外接收和解码功能
- 支持多种红外协议的信号编码和发射
- 跨平台兼容：
  - 接收端：Raspberry Pi Pico
  - 发射端：Raspberry Pi Pico（RP2）
- 与uasyncio兼容，可用于异步应用
- 提供测试程序便于验证和学习

---

## 支持的协议
- NEC协议（包括8位地址、16位地址及三星变体）
---

## 硬件要求

### 接收端
- 红外接收芯片（需与遥控器载波频率匹配）：
  - 38KHz：Vishay TSOP4838或兼容型号
  - 36KHz/40KHz：相应频率的接收芯片
- 连接导线
- 支持MicroPython的开发板
### 发射端
- 红外LED
- 晶体管（用于驱动LED，提供足够电流）
- 限流电阻
- 本程序支持的开发板：Raspberry Pi Pico（RP2）
- 连接导线
### 接线方式（树莓派pico）
| 模块类型       | 引脚功能   | 连接说明                                                                 |
|----------------|------------|--------------------------------------------------------------------------|
| 红外接收模块   | VCC        | 接开发板 3.3V 或 5V（根据模块规格选择，多数支持 3.3V-5V）              |
| 红外接收模块   | GND        | 接开发板 GND（共地）                                                    |
| 红外接收模块   | OUT        | 接开发板 GPIO 输入引脚（任意一个支持输入的 GPIO，如 Pico 的 GP17）         |
| 红外发射模块   | VCC        | 接开发板 3.3V 或 5V（同上）                                             |
| 红外发射模块   | GND        | 接开发板 GND（共地）                                                    |
| 红外发射模块   | DATA       | 接开发板 GPIO 输出引脚（任意一个支持输出的 GPIO，如 Pico 的 GP16）         |
---

## 文件说明

### `ir_rx` 目录（红外接收/解码）
1. **`__init__.py`**  
   - `IR_RX`：接收端基类，所有接收协议类的父类。负责处理红外信号的边缘检测、时序记录和解码触发。

2. **`acquire.py`**  
   无类定义，提供捕获和分析红外脉冲序列的函数，辅助识别未知协议。

3. **`nec.py`**  
   - `NEC_ABC`：NEC协议抽象基类
   - `NEC_8`：8位地址的NEC协议解码类
   - `NEC_16`：16位地址的NEC协议解码类
   - `SAMSUNG`：三星特有的NEC变体协议解码类

4. **`print_error.py`**  
   无类定义，提供错误信息处理功能，将错误码转换为可读文本。

### `ir_tx` 目录（红外发射/编码）
1. **`__init__.py`**  
   - `IR`：发射端基类，所有发射协议类的父类。封装硬件控制和脉冲生成逻辑，支持多平台。
   - `Player`：用于直接发送自定义脉冲序列的类。

2. **`nec.py`**  
   - `NEC`：实现NEC协议编码功能，用于生成符合NEC协议的脉冲序列和重复码。

3. **`rp2_rmt.py`**  
   - `RP2_RMT`：为Raspberry Pi Pico（RP2芯片）实现模拟RMT功能的类，通过PIO生成精确脉冲序列。

### `main`文件：
   无定义类，传入自定义回调函数即可

---

## 软件设计核心思想
- **模块化设计**：将接收和发射功能分离为`ir_rx`和`ir_tx`两个独立模块
- **面向对象**：通过基类抽象公共逻辑，具体协议通过子类实现，便于扩展
- **跨平台适配**：针对不同硬件特性（如RMT模块、PIO）进行适配，确保多平台兼容性
- **非阻塞操作**：接收和发射操作设计为非阻塞模式，提高系统响应性
- **协议扩展性**：新协议可通过继承基类并实现特定方法轻松添加

---

## 使用说明

### 安装方法
通过`thonny`工具调试：

**`连接好硬件之后：将main文件置于根目录，同ir_rx和ir_tx一起上传后，点击运行按钮 `**`
## 基本使用流程

### 接收端
1. 导入对应协议的接收类
2. 初始化接收对象，指定接收引脚和回调函数
3. 回调函数处理解码后的地址和数据

### 发射端
1. 导入对应协议的发射类
2. 初始化发射对象，指定发射引脚和载波频率
3. 调用发送方法发送地址和数据

---

## 示例程序
* python

```python
# Python env   : MicroPython v1.23.0
# -*- coding: utf-8 -*-
# @Time    : 2025/8/26 下午10:11
# @Author  : 缪贵成
# @File    : main.py
# @Description : nec_16协议基于树莓派pico的测试文件  已通过

# ======================================== 导入相关模块 =========================================

import time
from machine import Pin
from ir_tx.nec import NEC
# nec_16三个参数 回调函数中
from ir_rx.nec import NEC_16

# ======================================== 全局变量 ============================================

# ======================================== 功能函数 ============================================

# 如果使用nec_8需要传入不定长参数，，此处是nec_16

def ir_callback(addr: int, cmd: int, repeat: bool) -> None:
    """
    NEC 协议接收回调函数（3 参数版）。

    Args:
        addr (int): 接收到的地址
        cmd (int): 接收到的命令码
        repeat (bool): 是否为重复码 (True = 是, False = 否)

    Notes:
        回调函数由 NEC 接收模块调用，非 ISR-safe。
        输出接收到的数据到串口。

    ==========================================

    NEC IR signal receive callback (3-parameter version).

    Args:
        addr (int): Received address
        cmd (int): Received command
        repeat (bool): Repeat flag (True = yes, False = no)
    Notes:
        Called by NEC IR receiver. Not ISR-safe.
        Prints received data to REPL.
    """
    print(f"[RX] Address=0x{addr:04X}, Cmd=0x{cmd:02X}, Repeat={repeat}")

# ======================================== 自定义类 =============================================

# ======================================== 初始化配置 ===========================================

time.sleep(3)
print("FreakStudio:Infrared transceiver test")
# 发射管接 GP15
TX_PIN = Pin(15, Pin.OUT)
# 接收头接 GP14
RX_PIN = Pin(14, Pin.IN)
# 38kHz 发射
ir_tx = NEC(TX_PIN, freq=38000)
# 接收 NEC
ir_rx = NEC_16(RX_PIN, ir_callback)
print("[System] Ready... TX=GP15, RX=GP14")

# ========================================  主程序  ===========================================
while True:
    print("[TX] Sending NEC signal...")
    # 地址=0x10, 命令=0x20
    ir_tx.transmit(0x10, 0x20)
    time.sleep(2)
```
---

## 注意事项
- 红外接收芯片需与遥控器使用的载波频率匹配
- 发射红外信号时，确保红外 LED 有足够驱动电流
- 避免在强光环境下使用，可能干扰红外接收
- 不同平台的引脚配置可能不同，需根据实际硬件调整

---

## 联系方式
如有任何问题或需要帮助，请通过以下方式联系开发者：  
📧 **邮箱**：10696531183@qq.com  
💻 **GitHub**：[https://github.com/FreakStudioCN](https://github.com/FreakStudioCN)  

---

## 许可协议
本项目中，除 `machine` 等 MicroPython 官方模块（MIT 许可证）外，所有由作者编写的驱动与扩展代码均采用 **知识共享署名-非商业性使用 4.0 国际版 (MIT)** 许可协议发布。  

您可以自由地：  
- **共享** : 在任何媒介以任何形式复制、发行本作品  
- **演绎** : 修改、转换或以本作品为基础进行创作  

惟须遵守下列条件：  
- **署名** : 您必须给出适当的署名，提供指向本许可协议的链接，同时标明是否（对原始作品）作了修改。您可以用任何合理的方式来署名，但是不得以任何方式暗示许可人为您或您的使用背书。  
- **非商业性使用** :您不得将本作品用于商业目的。  
- **合理引用方式** : 可在代码注释、文档、演示视频或项目说明中明确来源。  
- **声明：** 本项目中所有内容仅可学习或者个人爱好者使用，禁止商用，不得以任何形式以此代码做任何不合理的事情，代码具体可参考这个github项目https://github.com/peterhinch/micropython_ir，发生任何事情与署名作者无关。

- **版权归 FreakStudio 所有。**