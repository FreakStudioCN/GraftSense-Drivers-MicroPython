# GUVA-S12SD 紫外线传感器驱动 - MicroPython版本

## 目录
- [简介](#简介)
- [主要功能](#主要功能)
- [硬件要求](#硬件要求)
- [文件说明](#文件说明)
- [软件设计核心思想](#软件设计核心思想)
- [使用说明](#使用说明)
- [示例程序](#示例程序)
- [注意事项](#注意事项)
- [联系方式](#联系方式)
- [许可协议](#许可协议)

---

## 简介
GUVA-S12SD 是一款专为紫外线（UV）检测设计的模拟输出传感器，通过感知紫外线辐射强度输出对应模拟电压信号，可用于测量环境中的紫外线指数（UV Index）。该传感器具有体积小、功耗低、响应速度快等特点，广泛应用于户外紫外线监测设备、智能穿戴设备、环境监测系统、防晒提醒装置等场景。

本项目提供了基于 MicroPython 的驱动代码及示例程序，支持电压读取、紫外线指数转换等核心功能，通过多次采样平均降低噪声干扰，方便开发者快速集成到各类紫外线监测场景中。

> **注意**：该传感器测量结果基于经验数据映射，而且映射表并不完善，属于定性/半定量检测，不适合用于医疗级高精度紫外线测量；实际使用时需结合环境校准，确保数据准确性。

---

## 主要功能
- **核心检测能力**：
  - 读取传感器模拟输出电压（单位：V）
  - 将电压值转换为紫外线指数（UV Index，范围 0~11，符合通用 UV 指数标准）
- **数据稳定性优化**：
  - 默认 10 次采样取平均值，减少噪声干扰
  - 采样间隔 5ms，平衡响应速度与数据稳定性
- **便捷属性访问**：
  - `voltage` 属性：直接获取当前电压值
  - `uvi` 属性：直接获取当前紫外线指数
- **错误处理**：初始化 ADC 失败时抛出明确异常，便于问题排查
- **跨平台兼容**：仅依赖 MicroPython 标准库（`machine.ADC`、`time`），兼容树莓派 Pico 等主流开发板

---

## 硬件要求
### 推荐测试硬件
- 树莓派 Pico/Pico W
- GUVA-S12SD 紫外线传感器模块
- 杜邦线若干
- （可选）3.3V 电源模块（若开发板供电不稳定）

### 模块引脚说明
| GUVA-S12SD 引脚 | 功能描述 | 电压要求 | 连接说明 |
|-----------------|----------|----------|----------|
| VCC             | 电源正极 | 3.3V（不可接 5V，避免烧毁传感器） | 连接开发板 3.3V 引脚（如 Pico 的 Pin36） |
| GND             | 电源负极 | 接地 | 连接开发板 GND 引脚（如 Pico 的 Pin38） |
| OUT             | 模拟输出引脚 | 0V~3.3V（电压随紫外线强度升高而增大） | 连接开发板 ADC 引脚（如 Pico 的 GP26/ADC0） |

> **说明**：GUVA-S12SD 模块无数字输出（DO）引脚，仅通过 OUT 引脚输出模拟电压，需连接开发板的 ADC 引脚才能读取数据。

---

## 文件说明
### guva_s12sd.py
实现 GUVA-S12SD 紫外线传感器的核心驱动逻辑，核心类 `GUVA_S12SD` 封装所有功能接口，支持电压读取与紫外线指数转换。

#### 类定义：`GUVA_S12SD`
- **`__init__(analog_pin: int) -> None`**  
  初始化紫外线传感器：传入 ADC 引脚编号，创建 ADC 对象；若 ADC 初始化失败（如引脚错误），抛出 `ValueError` 并提示具体原因，确保初始化过程可追溯。
- **`read() -> float`**  
  读取传感器输出电压：默认进行 10 次 ADC 采样，每次采样间隔 5ms，取平均值后基于 3.3V 参考电压转换为实际电压（单位：V），返回值范围 0~3.3。
- **`get_uv_index() -> float`**  
  电压转紫外线指数：将 `read()` 方法获取的电压（转换为毫伏 mV）与经验映射区间匹配，返回对应的紫外线指数（范围 0~11），区间划分基于通用 UV 指数标准与传感器特性。
- **`voltage (property) -> float`**  
  属性方法：调用 `read()` 方法，直接返回当前传感器输出电压，简化代码调用（如 `sensor.voltage` 即可获取电压值）。
- **`uvi (property) -> float`**  
  属性方法：调用 `get_uv_index()` 方法，直接返回当前紫外线指数，简化代码调用（如 `sensor.uvi` 即可获取 UV 指数）。

### main.py
GUVA-S12SD 传感器功能测试程序，演示传感器初始化、电压读取、紫外线指数获取等完整流程，包含多类型异常捕获，确保测试过程稳定。

---

## 软件设计核心思想
### 数据稳定性优先
- **多次采样平均**：通过 10 次采样取平均值，有效过滤 ADC 读取的随机噪声，解决单次采样数据波动大的问题
- **固定采样间隔**：5ms 采样间隔平衡响应速度与硬件稳定性，避免频繁采样导致的系统资源占用过高

### 经验映射与标准兼容
- **UV 指数区间划分**：参考通用紫外线指数标准（0~11，数值越高表示紫外线强度越强），结合 GUVA-S12SD 传感器的电压输出特性，建立基于毫伏（mV）的经验映射表，确保输出结果符合用户认知
- **电压转换逻辑**：基于 MicroPython ADC 16 位分辨率（0~65535）与 3.3V 参考电压，推导电压计算公式 `(ADC值 / 65535) * 3.3`，确保转换结果准确

### 易用性与可维护性
- **属性化接口**：将 `read()` 和 `get_uv_index()` 封装为 `voltage` 和 `uvi` 属性，减少方法调用代码量，提升开发效率
- **明确错误提示**：初始化 ADC 失败时抛出 `ValueError` 并附带引脚信息，便于开发者快速定位硬件接线或引脚配置问题
- **模块化封装**：将传感器逻辑封装为独立类，与测试代码分离，便于后续扩展（如增加温度补偿、校准功能）

---

## 使用说明
### 硬件接线（树莓派 Pico 示例）
| GUVA-S12SD 引脚 | Pico GPIO 引脚 | 接线功能 |
|-----------------|----------------|----------|
| VCC             | 3.3V（Pin36）  | 传感器电源输入（必须 3.3V） |
| GND             | GND（Pin38）   | 电源接地，确保共地避免信号干扰 |
| OUT             | GP26（Pin31）  | 模拟信号输入（ADC0 通道） |

> **注意**：
> 1. 严禁将 GUVA-S12SD 传感器 VCC 引脚接 5V 电源，会直接烧毁传感器；必须使用 3.3V 供电
> 2. OUT 引脚必须连接开发板的 ADC 引脚（如 Pico 的 GP26~GP28），普通 GPIO 引脚无法读取模拟信号

---

### 软件依赖
- **固件版本**：MicroPython v1.23+  
- **内置库**：
  - `machine.ADC`：用于读取传感器模拟输出电压
  - `time`：用于采样间隔控制与上电延时
- **开发工具**：Thonny、PyCharm（带 MicroPython 插件）

---

### 安装步骤
1. **烧录固件**：将 MicroPython v1.23+ 固件烧录到树莓派 Pico
2. **上传文件**：将 `guva_s12sd.py` 和 `main.py` 上传到 Pico 的文件系统
3. **配置引脚**：根据硬件接线修改 `main.py` 中 `GUVA_S12SD` 初始化的 `analog_pin` 编号（默认使用 GP26/ADC0）
4. **运行测试**：在开发工具中执行 `main.py`，将传感器暴露在阳光下或紫外线光源下，观察电压与 UV 指数变化

---

## 示例程序
```python
# MicroPython v1.23.0
# -*- coding: utf-8 -*-   
# @Time    : 2025/8/24 下午3:37
# @Author  : 缪贵成
# @File    : main.py
# @Description : uv紫外线传感器驱动测试文件，测试等级理论上来讲有11个

# ======================================== 导入相关模块 =========================================

import time
from guva_s12sd import GUVA_S12SD

# ======================================== 全局变量 =============================================

# ======================================== 功能函数 =============================================

# ======================================== 自定义类 =============================================

# ========================================初始化配置 =============================================

time.sleep(3)
print("FreakStudio:  UV Sensor (GUVA-S12SD) Test Starting ")

# 初始化传感器 (GP26 -> ADC0)
sensor = GUVA_S12SD(26)

# ======================================== 主程序 ===============================================

try:
    while True:
        try:
            voltage = sensor.voltage
            uvi = sensor.uvi
            print(f"Voltage: {voltage:.3f} V | UV Index: {uvi:.2f}")
        except RuntimeError as e:
            print(f"[Error] Failed to read sensor data: {e}")

        time.sleep(2)

except ValueError as e:
    print(f"[Critical Error] Sensor initialization failed: {e}")
except Exception as e:
    print(f"[Unexpected Error] {e}")


```
---
## 注意事项

### 传感器特性限制
- **测量范围**：紫外线指数仅支持 0~11，超过 11 时默认返回 11（属于强紫外线范围，需提醒防护）
- **精度限制**：基于经验数据映射，测量误差约 ±0.5~1 个 UV 指数，受环境温度、光照角度影响
- **响应光谱**：主要响应 UVA（320~400nm）和部分 UVB（280~320nm），对 UVC（<280nm）无响应（UVC 通常被臭氧层吸收，环境中含量极低）
- **映射关系**：线性映射关系，强度上升电压上升，反之下降。
---

### 硬件接线与配置注意事项
- **严格电压匹配**：VCC 引脚必须接 3.3V，接 5V 会烧毁传感器；建议使用开发板原生 3.3V 引脚供电，避免外部电源波动影响
- **ADC 引脚选择**：OUT 引脚必须连接开发板的 ADC 引脚（如 Pico 的 GP26~GP28），普通 GPIO 引脚无 ADC 功能，无法读取数据
- **共地要求**：传感器 GND 必须与开发板 GND 可靠连接，否则会出现电压漂移，导致测量数据异常
- **布线规范**：OUT 引脚接线尽量短（建议不超过 10cm），远离电机、继电器等强电磁干扰源；必要时可在接线间增加屏蔽层，减少信号干扰

---

### 软件使用建议
- **采样次数调整**：若环境噪声较大（如工业场景），可在 `read()` 方法中增加采样次数（如 20 次），进一步降低噪声；若需更快响应速度，可减少采样次数（如 5 次）
- **校准建议**：首次使用前，建议在已知紫外线指数的环境下（如参考天气预报 UV 指数）校准，微调 `get_uv_index()` 中的电压区间，提升数据准确性
- **异常处理扩展**：实际项目中可基于 `voltage` 属性添加电压异常判断（如电压 >3.3V 或 <0V 时判定为传感器故障），增强系统鲁棒性
- **低功耗优化**：若用于电池供电设备，可延长采样间隔（如 10~30 秒一次），减少 ADC 唤醒次数，降低整体功耗

---

### 环境影响
- **温度影响**：传感器最佳工作温度为 -10℃~60℃，温度超过 60℃ 时灵敏度会下降，低于 -10℃ 可能出现数据冻结，需避免极端温度环境
- **光照干扰**：强烈可见光（如直射阳光）可能轻微影响传感器读数，建议在传感器前端增加 UV 专用滤光片，过滤可见光干扰
- **安装角度**：传感器应正面朝向紫外线来源（如户外朝上安装），避免倾斜导致接收面积减少，影响测量精度；安装时需远离遮挡物（如建筑物、树木）

## 联系方式
如有任何问题或需要帮助，请通过以下方式联系开发者：  
📧 **邮箱**：10696531183@qq.com  
💻 **GitHub**：[https://github.com/leezisheng](https://github.com/leezisheng)  

---

## 许可协议
本项目中，除 `machine`、`time` 等 MicroPython 官方模块（MIT 许可证）外，所有由作者编写的驱动与扩展代码均采用 **知识共享署名-非商业性使用 4.0 国际版 (CC BY-NC 4.0)** 许可协议发布。  

您可以自由地：  
- **共享** — 在任何媒介以任何形式复制、发行本作品  
- **演绎** — 修改、转换或以本作品为基础进行创作  

惟须遵守下列条件：  
- **署名** — 您必须给出适当的署名，提供指向本许可协议的链接，同时标明是否（对原始作品）作了修改。您可以用任何合理的方式来署名，但是不得以任何方式暗示许可人为您或您的使用背书。  
- **非商业性使用** — 您不得将本作品用于商业目的。  
- **合理引用方式** — 可在代码注释、文档、演示视频或项目说明中明确来源。  

**版权归 FreakStudio 所有。**