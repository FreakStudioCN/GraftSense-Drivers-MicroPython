# 六轴陀螺仪驱动 - MicroPython版本
## 目录
- [简介](#简介)
- [主要功能](#主要功能)
- [硬件要求](#硬件要求)
- [文件说明](#文件说明)
- [软件设计核心思想](#软件设计核心思想)
- [使用说明](#使用说明)
- [示例程序](#示例程序)
- [注意事项](#注意事项)
- [联系方式](#联系方式)
- [许可协议](#许可协议)
---
## 简介

六轴陀螺仪是一种集成加速度计和陀螺仪的传感器，可以同时测量三轴线性加速度和三轴角速度，广泛应用于姿态检测、运动跟踪、平衡控制、无人机导航等场景。本项目提供基于MicroPython的驱动代码，封装I²C通信、数据读取、单位转换、归一化计算功能，支持快速集成。

> **注意**：适用于标准六轴MEMS陀螺仪（如MPU6050、MPU6500），不适用于高精度惯性测量单元（IMU）或工业陀螺仪，不可用于高精度航向测量场景。

---

## 主要功能

* 通过I²C读取加速度和角速度原始数据
* 将原始值转换为物理单位（g、°/s）
* 输出归一化数据或角度估算（可选卡尔曼/互补滤波）
* 聚合返回完整状态数据，支持外部传入I²C实例适配不同硬件
* 兼容MicroPython主流开发板，接口简洁易用

---

## 硬件要求

### 推荐测试硬件

* MicroPython开发板（如树莓派Pico）
* MPU6050六轴陀螺仪模块
* 杜邦线4根
* （可选）面包板

### 模块引脚说明

| 模块引脚 | 功能描述   | 连接说明                       |
| ---- | ------ | -------------------------- |
| VCC  | 电源输入   | 接开发板3.3V                   |
| GND  | 接地     | 接开发板GND                    |
| SDA  | I²C数据线 | 接开发板对应I²C SDA引脚（如Pico的GP0） |
| SCL  | I²C时钟线 | 接开发板对应I²C SCL引脚（如Pico的GP1） |

---

## 文件说明
### imu.py

该文件实现六轴陀螺仪（IMU）的核心驱动功能，仅包含`IMU`类，用于处理陀螺仪与加速度计的数据读取与解析。

`IMU`类通过封装UART通信逻辑，提供三轴加速度、角速度和角度的访问接口。类中包含传感器数据转换系数和多种控制指令，用于初始化、校准和模式切换。

类的主要方法包括：

* `__init__(UART_Obj: UART) -> None`：初始化IMU对象，绑定UART实例并完成加速度校准与Z轴清零。
* `SendCMD(cmd: list[int]) -> bool`：发送控制指令到IMU，例如校准、模式切换、清零等。
* `RecvData() -> tuple[float, ...]`：接收并解析IMU返回的数据，包括三轴加速度、角速度和角度，并更新对象属性（`angle_x`、`angle_y`、`angle_z`等）。
* 属性如`angle_x`、`angle_y`、`angle_z`：存储当前三轴角度数据，单位为度（°）。

类中常用指令包括：

* `ZAXISCLEARCMD`：Z轴角度清零
* `ACCCALBCMD`：加速度校准
* `CONVSLEEPCMD`：睡眠/工作模式切换
* `UARTMODECMD`、`IICMODECMD`：通信模式切换
* `HORIZINSTCMD`、`VERTINSTCMD`：安装模式切换
* `BAUD115200CMD`、`BAUD9600CMD`：波特率设置

---

### main.py

该文件为六轴陀螺仪的功能测试程序，无自定义类，仅包含程序入口循环，用于实时读取IMU数据并输出。

核心功能：

1. 初始化UART端口，与IMU通信
2. 创建`IMU`对象，执行初始化和校准
3. 循环读取三轴角度数据，打印到控制台
4. 可选通过UART将角度数据发送到上位机
5. 指示灯（LED）闪烁，显示程序运行状态
6. 内存管理：当可用堆 RAM 低于阈值时，触发垃圾回收

---

## 软件设计核心思想

* **模块化**：将UART通信、数据解析、指令发送封装为独立方法
* **硬件解耦**：IMU对象接受外部UART实例，兼容不同开发板
* **实时性**：支持循环采样和上位机数据传输
* **内存优化**：结合垃圾回收管理长时间运行

---

## 使用说明

### 硬件接线（树莓派Pico示例）

| IMU模块引脚 | Pico引脚   | 接线功能           |
| ------- | -------- | -------------- |
| VCC     | 3.3V     | 电源输入           |
| GND     | GND      | 接地             |
| TX      | RX (GP5) | IMU → Pico数据输入 |
| RX      | TX (GP4) | Pico → IMU数据输出 |
| LED     | GP25     | 指示灯（可选）        |

### 软件依赖

* 固件：MicroPython v1.23+
* 内置库：`machine`（UART、Pin控制）、`time`（延时）、`gc`（内存管理）

### 安装步骤

1. 烧录MicroPython固件到开发板
2. 上传`imu.py`和`main.py`
3. 根据实际接线修改`UART`引脚参数
4. 运行`main.py`，观察控制台输出的三轴角度数据

---

## 示例程序
```python
# Python env   : MicroPython v1.23.0              
# -*- coding: utf-8 -*-        
# @Time    : 2024/6/24 上午10:32   
# @Author  : 李清水            
# @File    : main.py       
# @Description : 串口IMU类实验,主要通过串口获取IMU:JY61数据，然后通过Print函数打印数据

# ======================================== 导入相关模块 ========================================

# 硬件相关的模块
from machine import UART, Pin
# 时间相关的模块
import time
# 垃圾回收的模块
import gc
# IMU类模块
from imu import IMU

# ======================================== 全局变量 ============================================

# 程序运行时间变量
run_time: int = 0
# 程序起始时间点变量
start_time: int = 0
# 程序结束时间点变量
end_time: int = 0

# ======================================== 功能函数 ============================================

# ======================================== 自定义类 ============================================

# ======================================== 初始化配置 ==========================================

# 上电延时3s
time.sleep(3)
# 打印调试信息
print("FreakStudio : Using UART to communicate with IMU")

# 创建串口对象，设置波特率为115200
uart = UART(1, 115200)
# 初始化uart对象，数据位为8，无校验位，停止位为1
# 设置串口超时时间为5ms
uart.init(bits=8,
          parity=None,
          stop=1,
          tx=4,
          rx=5,
          timeout=5)

# 创建串口对象，设置波特率为115200，用于将三轴角度数据发送到上位机
uart_pc = UART(0, 115200)
# 初始化uart对象，数据位为8，无校验位，停止位为1，设置串口超时时间为5ms
uart_pc.init(bits=8,
             parity=None,
             stop=1,
             tx=0,
             rx=1,
             timeout=5)

# 设置GPIO 25为LED输出引脚，下拉电阻使能
LED = Pin(25, Pin.OUT, Pin.PULL_DOWN)

# 初始化一个IMU对象
imu_obj = IMU(uart)

# ========================================  主程序  ============================================

while True:
    # 点亮LED灯
    LED.on()
    # 接收陀螺仪数据
    imu_obj.RecvData()
    # 熄灭LED灯
    LED.off()

    # 打印 x 轴角度
    print(" X-axis angle : ", imu_obj.angle_x)
    # 打印 y 轴角度
    print(" Y-axis angle : ", imu_obj.angle_y)
    # 打印 z 轴角度
    print(" Z-axis angle : ", imu_obj.angle_z)
    # 返回可用堆 RAM 的字节数
    print(" the number of RAM remaining is %d bytes ", gc.mem_free())

    # 将三轴角度数据格式化成字符串
    angle_data = "{:.2f}, {:.2f}, {:.2f}\r\n".format(imu_obj.angle_x, imu_obj.angle_y, imu_obj.angle_z)
    # 通过串口0发送角度数据到上位机
    uart_pc.write(angle_data)

    # 当可用堆 RAM 的字节数小于 80000 时，手动触发垃圾回收功能
    if gc.mem_free() < 220000:
        # 手动触发垃圾回收功能
        gc.collect()
```
---
## 注意事项

### 电气特性限制

* **电压限制**：IMU 模块工作电压通常为 3.3V 或 5V，严禁超过模块标称电压，否则可能烧毁传感器芯片；UART/I²C 接口电平需与开发板匹配，必要时使用电平转换器。
* **通信电流与接口**：UART 或 I²C 接口电流较小，不可直接驱动大电流负载；避免在通信线上并联高功率器件。
* **传感器损耗**：MEMS 结构存在寿命限制，过大冲击或振动可能导致零偏漂移或损坏；长期使用建议避免强振动或撞击。

### 硬件接线与配置注意事项

* **共地要求**：IMU 模块 GND 必须与开发板 GND 可靠连接，否则 UART/I²C 信号可能出现通信错误或数据异常。
* **接线可靠性**：模块引脚较细，面包板测试时需确保插入稳固；长期使用建议焊接或使用杜邦端子。
* **接口选择**：确认开发板的 UART/I²C 引脚正确，并与 IMU 模块对应，避免将普通 GPIO 引脚作为通信接口。
* **干扰防护**：通信信号线尽量短且远离电机、继电器等强电磁干扰源；必要时可使用屏蔽线或加滤波电容。

### 环境影响

* **温度限制**：IMU 模块典型工作温度范围为 -40℃\~85℃，超出此范围可能导致 MEMS 零偏漂移或加速度计/陀螺仪测量异常。
* **湿度限制**：高湿环境（相对湿度 >85% RH）易导致电路板氧化和内部传感器受潮，进而影响测量精度或通信稳定性；必要时加防潮外壳。
* **振动与冲击防护**：MEMS 传感器对高频振动和冲击敏感，长期暴露在强振动环境中可能导致零偏漂移或测量异常；安装时应增加减震措施。
* **磁干扰防护**：IMU 内置陀螺仪对外部强磁场不敏感，但若集成磁力计时应远离强磁体，否则可能影响姿态计算。

---
### 联系方式
如有任何问题或需要帮助，请通过以下方式联系开发者：  
📧 **邮箱**：10696531183@qq.com  
💻 **GitHub**：[https://github.com/FreakStudioCN](https://github.com/FreakStudioCN)  

---
### 许可协议
本项目中，除 `machine` 等 MicroPython 官方模块（MIT 许可证）外，所有由作者编写的驱动与扩展代码均采用 **知识共享署名-非商业性使用 4.0 国际版 (CC BY-NC 4.0)** 许可协议发布。  

您可以自由地：  
- **共享** — 在任何媒介以任何形式复制、发行本作品  
- **演绎** — 修改、转换或以本作品为基础进行创作  

惟须遵守下列条件：  
- **署名** — 您必须给出适当的署名，提供指向本许可协议的链接，同时标明是否（对原始作品）作了修改。您可以用任何合理的方式来署名，但是不得以任何方式暗示许可人为您或您的使用背书。  
- **非商业性使用** — 您不得将本作品用于商业目的。  
- **合理引用方式** — 可在代码注释、文档、演示视频或项目说明中明确来源。  

**版权归 FreakStudio 所有。**