# MGç³»åˆ—æ°”ä½“ä¼ æ„Ÿå™¨é©±åŠ¨ - MicroPythonç‰ˆæœ¬

## ç›®å½•
- [ç®€ä»‹](#ç®€ä»‹)
- [ä¸»è¦åŠŸèƒ½](#ä¸»è¦åŠŸèƒ½)
- [ç¡¬ä»¶è¦æ±‚](#ç¡¬ä»¶è¦æ±‚)
- [æ–‡ä»¶è¯´æ˜](#æ–‡ä»¶è¯´æ˜)
- [è½¯ä»¶è®¾è®¡æ ¸å¿ƒæ€æƒ³](#è½¯ä»¶è®¾è®¡æ ¸å¿ƒæ€æƒ³)
- [ä½¿ç”¨è¯´æ˜](#ä½¿ç”¨è¯´æ˜)
- [ç¤ºä¾‹ç¨‹åº](#ç¤ºä¾‹ç¨‹åº)
- [æ³¨æ„äº‹é¡¹](#æ³¨æ„äº‹é¡¹)
- [è”ç³»æ–¹å¼](#è”ç³»æ–¹å¼)
- [è®¸å¯åè®®](#è®¸å¯åè®®)

---

## ç®€ä»‹

MG811 å’Œ MG812 ç³»åˆ—æ°”ä½“ä¼ æ„Ÿå™¨æ˜¯ä¸€ç±»åŸºäºå›ºæ€ç”µåŒ–å­¦/æ°§åŒ–ç‰©åŸç†çš„æ°”ä½“æ£€æµ‹è®¾å¤‡ï¼Œä¸»è¦ç”¨äºæ£€æµ‹äºŒæ°§åŒ–ç¢³ï¼ˆCOâ‚‚ï¼‰æµ“åº¦ã€‚è¯¥ç³»åˆ—ä¼ æ„Ÿå™¨å…·æœ‰é«˜çµæ•åº¦ã€å¿«é€Ÿå“åº”ã€è€ç”¨æ€§å¼ºç­‰ç‰¹ç‚¹ï¼Œå¹¿æ³›åº”ç”¨äºå®¤å†…ç©ºæ°”è´¨é‡ç›‘æµ‹ã€æ¸©å®¤ç¯å¢ƒæ£€æµ‹ã€ç§‘ç ”å®éªŒç­‰åœºæ™¯ã€‚

> **æ³¨æ„**ï¼šMG811/MG812 é€‚ç”¨äºå‚è€ƒæ€§ COâ‚‚ æµ“åº¦æ£€æµ‹ï¼Œä¸èƒ½æ›¿ä»£ç²¾å¯†å·¥ä¸šçº§ COâ‚‚ æµ‹é‡ä»ªå™¨ã€‚

æœ¬é¡¹ç›®æä¾›äº†åŸºäº MicroPython çš„é©±åŠ¨ä»£ç åŠç¤ºä¾‹ç¨‹åºï¼Œæ–¹ä¾¿å¼€å‘è€…å¿«é€Ÿæ¥å…¥ MG811/MG812 ä¼ æ„Ÿå™¨ï¼Œå®ç° COâ‚‚ æµ“åº¦æ£€æµ‹åŠŸèƒ½ã€‚

---

## ä¸»è¦åŠŸèƒ½

* **ä¼ æ„Ÿå™¨æ”¯æŒ**ï¼š

  * MG811ï¼ˆé«˜çµæ• COâ‚‚ æ£€æµ‹ï¼Œé€‚ç”¨äº 0â€“10,000 ppm èŒƒå›´ï¼‰
  * MG812ï¼ˆé«˜çµæ• COâ‚‚ æ£€æµ‹ï¼Œé€‚ç”¨äº 0â€“5,000 ppm èŒƒå›´ï¼Œå¯ç”¨äºä½æµ“åº¦ç¯å¢ƒï¼‰
  * æ”¯æŒè‡ªå®šä¹‰ä¼ æ„Ÿå™¨æ ‡å®šæ›²çº¿
* **æ ¸å¿ƒæ£€æµ‹æŒ‡æ ‡**ï¼š

  * ç”µå‹å€¼ï¼ˆVï¼‰
  * COâ‚‚ æµ“åº¦ï¼ˆppmï¼‰
* **ä¸­æ–­æ”¯æŒ**ï¼šé€šè¿‡å¤–æ¥æ¯”è¾ƒå™¨å¯å®ç°é˜ˆå€¼æŠ¥è­¦ï¼ˆå¯é€‰ï¼‰
* **æ•°æ®å¤„ç†**ï¼š

  * å¤šé‡‡æ ·å¹³å‡æ»¤æ³¢
  * å¤šé¡¹å¼æˆ–å¯¹æ•°æµ“åº¦è½¬æ¢
* **ç»Ÿä¸€æ¥å£**ï¼šæä¾› `read_voltage()` å’Œ `read_ppm()` æ ‡å‡†æ¥å£ï¼Œä¾¿äºå¿«é€Ÿé›†æˆ
* **è·¨å¹³å°æ”¯æŒ**ï¼šå…¼å®¹å¤šç§ MicroPython å¼€å‘æ¿ï¼ˆæ ‘è“æ´¾ Pico ç­‰ï¼‰

---

## ç¡¬ä»¶è¦æ±‚
### æ¨èæµ‹è¯•ç¡¬ä»¶

* æ ‘è“æ´¾ Pico/Pico W
* MG811 æˆ– MG812 COâ‚‚ ä¼ æ„Ÿå™¨æ¨¡å—
* æœé‚¦çº¿è‹¥å¹²
* 10kÎ© ç”µé˜»ï¼ˆç”¨äºåˆ†å‹æˆ–æ¨¡å—å¤–æ¥è´Ÿè½½ï¼Œéƒ¨åˆ†æ¨¡å—å·²é›†æˆï¼‰

### æ¨¡å—å¼•è„šè¯´æ˜

| ä¼ æ„Ÿå™¨å¼•è„š | åŠŸèƒ½æè¿°                           |
| ----- | ------------------------------ |
| VCC   | ç”µæºæ­£æï¼ˆ5V æ¨èï¼Œéƒ¨åˆ†æ¨¡å—å¯ç”¨ 3.3Vï¼Œä½†æ€§èƒ½ç•¥ä¸‹é™ï¼‰ |
| GND   | ç”µæºè´Ÿæ                           |
| AOUT  | æ¨¡æ‹Ÿè¾“å‡ºï¼ˆè¿æ¥ ADC è¯»å–ç”µå‹ï¼‰              |
| DOUT  | æ•°å­—è¾“å‡ºï¼ˆé˜ˆå€¼æŠ¥è­¦ï¼Œå¯é€‰ï¼‰                  |

---

## æ–‡ä»¶è¯´æ˜

### mgx.py

å®ç°äº† MG811/MG812 COâ‚‚ ä¼ æ„Ÿå™¨çš„é©±åŠ¨åŠŸèƒ½ï¼Œæ ¸å¿ƒç±» `MGX` æä¾›å®Œæ•´æ§åˆ¶æ¥å£ã€‚

#### ç±»å®šä¹‰ï¼š`MGX`

* **`__init__(adc_pin: int, comp_pin: int = None, callback: callable = None, rl_ohm: float = 10000, vref: float = 3.3) -> None`**
  åˆå§‹åŒ–ä¼ æ„Ÿå™¨ï¼Œå‚æ•°åŒ…æ‹¬ ADC å¼•è„šç¼–å·ã€å¯é€‰æ¯”è¾ƒå™¨å¼•è„šã€å¯é€‰ä¸­æ–­å›è°ƒå‡½æ•°ã€è´Ÿè½½ç”µé˜»å’Œå‚è€ƒç”µå‹ã€‚

* **`read_voltage() -> float`**
  è¯»å–å½“å‰ä¼ æ„Ÿå™¨æ¨¡æ‹Ÿç”µå‹å€¼ï¼ˆVï¼‰ã€‚

* **`read_ppm(samples: int = 1, delay_ms: int = 0) -> float`**
  è¯»å– COâ‚‚ æµ“åº¦ï¼ˆppmï¼‰ï¼Œæ”¯æŒå¤šæ¬¡é‡‡æ ·å¹³å‡å’Œå»¶æ—¶ã€‚

* **`select_builtin(sensor_name: str) -> None`**
  é€‰æ‹©å†…ç½®æ ‡å®šæ¨¡å‹ï¼ˆMG811 æˆ– MG812ï¼‰ã€‚

* **`set_custom_polynomial(coeffs: list[float]) -> None`**
  è®¾ç½®ç”¨æˆ·è‡ªå®šä¹‰å¤šé¡¹å¼ï¼Œç”¨äºç”µå‹â†’ppm è½¬æ¢ã€‚

* **`enable_interrupt() -> None`** / **`disable_interrupt() -> None`**
  å¯ç”¨æˆ–ç¦ç”¨æ¯”è¾ƒå™¨ä¸­æ–­ï¼Œå¹¶åœ¨è§¦å‘æ—¶è°ƒç”¨å›è°ƒå‡½æ•°ã€‚

* **`deinit() -> None`**
  é‡Šæ”¾ä¼ æ„Ÿå™¨èµ„æºï¼Œå–æ¶ˆä¸­æ–­ã€‚

---

### main.py

ç¤ºä¾‹ç¨‹åºï¼Œæ¼”ç¤º MG811/MG812 ä¼ æ„Ÿå™¨åŠŸèƒ½ï¼ŒåŒ…æ‹¬ç”µå‹è¯»å–ã€COâ‚‚ æµ“åº¦è®¡ç®—å’Œä¸­æ–­å›è°ƒã€‚
---

## è½¯ä»¶è®¾è®¡æ ¸å¿ƒæ€æƒ³

### æ¨¡å—åŒ–è®¾è®¡

* å°†ä¼ æ„Ÿå™¨æ“ä½œå°è£…ä¸ºç‹¬ç«‹ç±»ï¼ŒèŒè´£å•ä¸€
* åˆ†ç¦»ç¡¬ä»¶æ§åˆ¶ä¸ä¸šåŠ¡é€»è¾‘ï¼Œä¾¿äºç»´æŠ¤
* æä¾›ç»Ÿä¸€æ¥å£ï¼Œç®€åŒ–é›†æˆéš¾åº¦

### ä¸­æ–­é©±åŠ¨æœºåˆ¶

* æ”¯æŒæ¯”è¾ƒå™¨å¼•è„šä¸­æ–­ï¼Œå¿«é€Ÿå“åº”é˜ˆå€¼å˜åŒ–
* ä½¿ç”¨ `micropython.schedule` è°ƒåº¦å›è°ƒï¼Œé¿å…ä¸­æ–­ä¸­æ‰§è¡Œå¤æ‚æ“ä½œ
* å¯å¯ç”¨/ç¦ç”¨ä¸­æ–­ï¼Œçµæ´»æ§åˆ¶

### çŠ¶æ€ç®¡ç†

* ä¿å­˜æœ€æ–°ç”µå‹å’Œ ppm å€¼ï¼Œæä¾›æŸ¥è¯¢æ¥å£
* æ”¯æŒé˜»å¡/éé˜»å¡è¯»å–
* é¿å…é‡å¤è§¦å‘å›è°ƒ

### æ˜“ç”¨æ€§è®¾è®¡

* é»˜è®¤å»¶æ—¶å’Œè´Ÿè½½ç”µé˜»é…ç½®ï¼Œç®€åŒ–åˆå§‹åŒ–
* å¯é€‰ä¸­æ–­å›è°ƒï¼Œæ”¯æŒç”¨æˆ·è‡ªå®šä¹‰é€»è¾‘
* å®Œå–„å¼‚å¸¸å¤„ç†ï¼Œæé«˜ç¨³å®šæ€§

---

## ä½¿ç”¨è¯´æ˜

### ç¡¬ä»¶æ¥çº¿ï¼ˆæ ‘è“æ´¾ Pico ç¤ºä¾‹ï¼‰

| ä¼ æ„Ÿå™¨å¼•è„š | Pico GPIO å¼•è„š         |
| ----- | -------------------- |
| VCC   | 5V æˆ– 3.3Vï¼ˆMG811æ¨è5Vï¼‰ |
| GND   | GND                  |
| AOUT  | GP26 (ADC0)          |
| DOUT  | GP15 (å¯é€‰ï¼Œä¸­æ–­æ¯”è¾ƒå™¨è¾“å‡º)    |

> **æ³¨æ„**ï¼šMG811/MG812 ä¼ æ„Ÿå™¨ä¸Šç”µåéœ€é¢„çƒ­ï¼ˆé€šå¸¸ 1\~3 åˆ†é’Ÿï¼‰ï¼Œå¹¶ç¡®ä¿è´Ÿè½½ç”µé˜»æ¥å…¥æ­£ç¡®ã€‚

---

### è½¯ä»¶ä¾èµ–

* **å›ºä»¶ç‰ˆæœ¬**ï¼šMicroPython v1.23+
* **å†…ç½®åº“**ï¼š`machine`, `time`, `micropython`
* **å¼€å‘å·¥å…·**ï¼šThonny æˆ– PyCharm

---
## ç¤ºä¾‹ç¨‹åº
```python
# Python env   : MicroPython v1.23.0
# -*- coding: utf-8 -*-
# @Time    : 2025/08/20 10:21
# @Author  : ç¼ªè´µæˆ
# @File    : main.py
# @Description : æµ‹è¯•MGç³»åˆ—æ°”ä½“ä¼ æ„Ÿå™¨æ¨¡å—é©±åŠ¨ç¨‹åº

# ======================================== å¯¼å…¥ç›¸å…³æ¨¡å— =========================================

from machine import Pin, ADC
import time
from time import sleep
from mgx import MGX

# ======================================== å…¨å±€å˜é‡ ============================================

# ======================================== åŠŸèƒ½å‡½æ•° ============================================

# ç”¨æˆ·å›è°ƒå‡½æ•°
def mg_callback(voltage: float) -> None:
    """
    å½“æ¯”è¾ƒå™¨å¼•è„šè§¦å‘ä¸­æ–­æ—¶è°ƒç”¨è¯¥å‡½æ•°ï¼Œæ‰“å°å½“å‰ç”µå‹å€¼ã€‚

    Args:
        voltage (float): ç”µå‹å€¼ (å•ä½: V)ã€‚

    ==========================================

    This function is called when the comparator pin triggers an IRQ,
    and prints the measured voltage.

    Args:
        voltage (float): Voltage value in volts.

    """
    print("[IRQ] Voltage: {:.3f} V".format(voltage))

# ======================================== è‡ªå®šä¹‰ç±» ============================================

# ======================================== åˆå§‹åŒ–é…ç½® ==========================================

# ä¸Šç”µå»¶æ—¶3s
time.sleep(3)
# æ‰“å°è°ƒè¯•æ¶ˆæ¯
print("Measuring Gas Concentration with MG Series Gas Sensor Modules")

# Pico ADC0 (GPIO26)
adc = ADC(Pin(26))
# Comparator output (GPIO15, optional)
comp = Pin(19, Pin.IN)
mg = MGX(adc, comp, mg_callback, rl_ohm=10000, vref=3.3)

# é€‰æ‹©å†…ç½®å¤šé¡¹å¼ï¼ˆMG811,MG812ï¼‰
mg.select_builtin("MG811")

# ä¼ å…¥è‡ªå®šä¹‰çš„å¤šé¡¹å¼
# mq.set_custom_polynomial([1.0, -2.5, 3.3])

# ========================================  ä¸»ç¨‹åº  ===========================================

print("===== MG Sensor Test Program Started =====")
try:
    while True:
        # è¯»å–ç”µå‹
        v = mg.read_voltage()
        print("Voltage: {:.3f} V".format(v))

        # è¯»å– ppmï¼ˆ5 æ¬¡é‡‡æ ·ï¼Œé—´éš” 200 msï¼‰
        ppm = mg.read_ppm(samples=5, delay_ms=200)
        print("Gas concentration: {:.2f} ppm".format(ppm))

        print("-" * 40)
        # ä¸»å¾ªç¯é—´éš”
        sleep(2)
except KeyboardInterrupt:
    print("User interrupted, exiting program...")
finally:
    mg.deinit()
    print("Sensor resources released.")

```
---

## æ³¨æ„äº‹é¡¹
### ä¼ æ„Ÿå™¨ç‰¹æ€§

* **æ£€æµ‹æ°”ä½“**ï¼šä¸»è¦æ£€æµ‹ COâ‚‚ æµ“åº¦
* **æ£€æµ‹èŒƒå›´**ï¼š0â€“5,000 ppmï¼ˆMG812ï¼‰æˆ– 0â€“10,000 ppmï¼ˆMG811ï¼‰ï¼Œå…·ä½“å–å†³äºå‹å·
* **å“åº”ç‰¹æ€§**ï¼š

  * å“åº”æ—¶é—´ï¼šçº¦ 10â€“30 ç§’è¾¾åˆ° 90% æµ“åº¦å˜åŒ–
  * æ¢å¤æ—¶é—´ï¼šçº¦ 30â€“60 ç§’ä»é«˜æµ“åº¦æ¢å¤åˆ°åŸºçº¿
* **æ¸©æ¹¿åº¦å½±å“**ï¼šé«˜æ¸©é«˜æ¹¿ç¯å¢ƒå¯èƒ½å½±å“æµ‹é‡ç²¾åº¦

---

### å®‰è£…æ³¨æ„äº‹é¡¹

* é¿å…å°†ä¼ æ„Ÿå™¨å®‰è£…åœ¨çƒ­æºé™„è¿‘ï¼ˆå¦‚ç©ºè°ƒå‡ºé£å£ã€åŠ çƒ­å™¨ï¼‰
* é¿å…é˜³å…‰ç›´å°„æˆ–å¼ºå…‰æºç›´æ¥ç…§å°„
* å®‰è£…é«˜åº¦å»ºè®® 1â€“2 ç±³ï¼Œä»¥è·å¾—è¾ƒå‡åŒ€çš„ç©ºæ°”é‡‡æ ·
* ç¡®ä¿ç©ºæ°”æµé€šï¼Œé¿å…å¯†é—­è§’è½å¯¼è‡´ COâ‚‚ æµ“åº¦ç§¯ç´¯å½±å“è¯»æ•°

---

### ä½¿ç”¨é™åˆ¶

* ä»…ç”¨äºå‚è€ƒæ€§ COâ‚‚ æµ“åº¦æµ‹é‡ï¼Œä¸èƒ½æ›¿ä»£ç²¾å¯†ä»ªå™¨
* å¯¹å¿«é€Ÿç¬æ—¶æµ“åº¦å˜åŒ–çš„å“åº”æœ‰é™
* ä¸é€‚åˆæ£€æµ‹å…¶ä»–æ°”ä½“ï¼ˆé COâ‚‚ï¼‰
* ä¸é€‚ç”¨äºé«˜ç²¾åº¦å®‰å…¨ç›‘æµ‹æˆ–å·¥ä¸šæ’æ”¾æ§åˆ¶

---

### ç”µæºè¦æ±‚

* ç¡®ä¿ä¾›ç”µç¨³å®šï¼Œé¿å…ç”µå‹æ³¢åŠ¨å¯¼è‡´æµ‹é‡å¼‚å¸¸
* MG811/MG812 æ¨è 5V ä¾›ç”µï¼ˆéƒ¨åˆ†æ¨¡å—å¯ç”¨ 3.3Vï¼Œä½†çµæ•åº¦ä¸‹é™ï¼‰
* ç”µæºç”µæµåº”æ»¡è¶³ä¼ æ„Ÿå™¨è¦æ±‚ï¼ˆé€šå¸¸ < 150 mAï¼Œæ¨¡å—åŒ–é€šå¸¸ < 50 mAï¼‰

---

### è½¯ä»¶ä½¿ç”¨å»ºè®®

* ä¼ æ„Ÿå™¨åˆæ¬¡ä¸Šç”µåï¼Œå»ºè®®é¢„çƒ­ 1â€“3 åˆ†é’Ÿä»¥ç¨³å®šè¯»æ•°
* å›è°ƒå‡½æ•°åº”å°½é‡ç®€çŸ­ï¼Œé¿å…åœ¨ä¸­æ–­ä¸­æ‰§è¡Œå¤æ‚æ“ä½œ
* é•¿æ—¶é—´ä¸ä½¿ç”¨æ—¶ï¼Œå¯é€šè¿‡ `deinit()` æˆ–ç¦ç”¨ä¸­æ–­é™ä½åŠŸè€—
* å¯æ ¹æ®åº”ç”¨åœºæ™¯è°ƒæ•´é‡‡æ ·æ¬¡æ•°ã€å»¶æ—¶å’Œå¤šé¡¹å¼æ ¡å‡†å‚æ•°

---
## è”ç³»æ–¹å¼
å¦‚æœ‰ä»»ä½•é—®é¢˜æˆ–éœ€è¦å¸®åŠ©ï¼Œè¯·é€šè¿‡ä»¥ä¸‹æ–¹å¼è”ç³»å¼€å‘è€…ï¼š  
ğŸ“§ **é‚®ç®±**ï¼š10696531183@qq.com  
ğŸ’» **GitHub**ï¼š[https://github.com/FreakStudioCN](https://github.com/FreakStudioCN)  

---

## è®¸å¯åè®®
æœ¬é¡¹ç›®ä¸­ï¼Œé™¤ `machine` ç­‰ MicroPython å®˜æ–¹æ¨¡å—ï¼ˆMIT è®¸å¯è¯ï¼‰å¤–ï¼Œæ‰€æœ‰ç”±ä½œè€…ç¼–å†™çš„é©±åŠ¨ä¸æ‰©å±•ä»£ç å‡é‡‡ç”¨ **çŸ¥è¯†å…±äº«ç½²å-éå•†ä¸šæ€§ä½¿ç”¨ 4.0 å›½é™…ç‰ˆ (CC BY-NC 4.0)** è®¸å¯åè®®å‘å¸ƒã€‚  

æ‚¨å¯ä»¥è‡ªç”±åœ°ï¼š  
- **å…±äº«** â€” åœ¨ä»»ä½•åª’ä»‹ä»¥ä»»ä½•å½¢å¼å¤åˆ¶ã€å‘è¡Œæœ¬ä½œå“  
- **æ¼”ç»** â€” ä¿®æ”¹ã€è½¬æ¢æˆ–ä»¥æœ¬ä½œå“ä¸ºåŸºç¡€è¿›è¡Œåˆ›ä½œ  

æƒŸé¡»éµå®ˆä¸‹åˆ—æ¡ä»¶ï¼š  
- **ç½²å** â€” æ‚¨å¿…é¡»ç»™å‡ºé€‚å½“çš„ç½²åï¼Œæä¾›æŒ‡å‘æœ¬è®¸å¯åè®®çš„é“¾æ¥ï¼ŒåŒæ—¶æ ‡æ˜æ˜¯å¦ï¼ˆå¯¹åŸå§‹ä½œå“ï¼‰ä½œäº†ä¿®æ”¹ã€‚æ‚¨å¯ä»¥ç”¨ä»»ä½•åˆç†çš„æ–¹å¼æ¥ç½²åï¼Œä½†æ˜¯ä¸å¾—ä»¥ä»»ä½•æ–¹å¼æš—ç¤ºè®¸å¯äººä¸ºæ‚¨æˆ–æ‚¨çš„ä½¿ç”¨èƒŒä¹¦ã€‚  
- **éå•†ä¸šæ€§ä½¿ç”¨** â€” æ‚¨ä¸å¾—å°†æœ¬ä½œå“ç”¨äºå•†ä¸šç›®çš„ã€‚  
- **åˆç†å¼•ç”¨æ–¹å¼** â€” å¯åœ¨ä»£ç æ³¨é‡Šã€æ–‡æ¡£ã€æ¼”ç¤ºè§†é¢‘æˆ–é¡¹ç›®è¯´æ˜ä¸­æ˜ç¡®æ¥æºã€‚  

**ç‰ˆæƒå½’ FreakStudio æ‰€æœ‰ã€‚**
