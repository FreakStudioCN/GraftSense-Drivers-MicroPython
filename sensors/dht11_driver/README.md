# dht11驱动 - MicroPython版本
## 目录
- [简介](#简介)
- [主要功能](#主要功能)
- [硬件要求](#硬件要求)
- [文件说明](#文件说明)
- [软件设计核心思想](#软件设计核心思想)
- [使用说明](#使用说明)
- [示例程序](#示例程序)
- [注意事项](#注意事项)
- [联系方式](#联系方式)
- [许可协议](#许可协议)
---
## 简介

DHT11 是一种常见的数字温湿度传感器，内部集成了温度和湿度的测量元件以及信号处理芯片，通过单总线输出经过校准的数字信号。适用于室内环境温湿度检测，如智能家居、气象监测、空气质量监测等场景。本项目提供基于 MicroPython 的驱动代码，封装数据采集、校验、温湿度读取等功能，支持快速集成。

> **注意**：DHT11 测量精度有限（温度±2℃、湿度±5%RH），不适合高精度工业测量场景。

---

## 主要功能

* 读取温度（℃）与湿度（%RH）的数值
* 提供数据校验，避免因通信错误导致的无效结果
* 聚合返回完整的温湿度状态数据
* 兼容 MicroPython 主流开发板，接口简洁易用

---

## 硬件要求

### 推荐测试硬件

* MicroPython 开发板（如树莓派 Pico）、DHT11 传感器模块、杜邦线 3 根、（可选）面包板

### 模块引脚说明

| DHT11 引脚 | 功能描述 | 连接说明                      |
| -------- | ---- | ------------------------- |
| VCC      | 电源输入 | 接开发板 3.3V 或 5V（推荐 5V，更稳定） |
| DATA     | 数据输出 | 接开发板任意 GPIO（需在代码中指定）      |
| GND      | 接地   | 接开发板 GND                  |

---

## 文件说明

### dht11.py

该文件实现 **DHT11 温湿度传感器** 的核心驱动功能，仅包含 `DHT11` 类，用于通过单总线 GPIO 接口采集温湿度数据。

`DHT11` 类封装了时序交互、数据解析与校验逻辑，提供了简洁的温度与湿度访问接口。类中包含两个私有属性：

* `_pin`：存储外部传入的 `Pin` 对象，负责单总线数据通信；
* `_last_measure`：上次测量的时间戳，用于控制测量间隔。

类的主要方法包括：

* `__init__(pin: Pin)`：初始化驱动对象，绑定 GPIO 引脚并完成硬件配置。
* `measure() -> None`：执行一次完整的数据采集流程，更新内部温湿度数值；若校验和错误，抛出 `InvalidChecksum` 异常。
* `temperature() -> float`：返回当前温度值（℃）。
* `humidity() -> float`：返回当前湿度值（%RH）。

### main.py

该文件为 **DHT11 传感器的功能测试程序**，无自定义类，仅包含 `main` 循环逻辑作为程序入口。

`main` 函数的核心功能是：初始化与 DHT11 传感器连接的 GPIO 引脚，创建 `DHT11` 驱动实例，通过循环调用 `temperature()` 与 `humidity()` 方法实时读取并打印温湿度数据。程序默认采样间隔为 2 秒，支持用户通过 `Ctrl+C` 手动终止测试，适用于验证硬件连接正确性与驱动功能完整性。

---

## 软件设计核心思想

* **模块化**：温湿度数据读取、校验、更新封装为独立方法，便于维护与扩展。
* **时序控制**：严格按照 DHT11 通信协议的时序规范实现，确保数据解析准确。
* **硬件解耦**：GPIO 引脚由应用层传入，驱动不负责硬件初始化，兼容不同开发板与引脚配置。

---

## 使用说明

### 硬件接线（树莓派 Pico 示例）

| DHT11 引脚 | Pico 引脚                  | 接线功能    |
| -------- |--------------------------| ------- |
| VCC      | 3.3V / 5V（Pin36 或 Pin40） | 电源输入    |
| DATA     | GP6                      | 单总线数据通信 |
| GND      | GND（Pin38）               | 接地      |

### 软件依赖

* 固件：MicroPython v1.23+
* 内置库：`machine`（GPIO 控制）、`time`（延时）
* 开发工具：Thonny / PyCharm

### 安装步骤

1. 烧录 MicroPython 固件到开发板
2. 上传 `dht11.py` 和 `main.py`，修改 `main.py` 中 `Pin(13)` 为实际接线引脚
3. 运行 `main.py`，观察串口打印的温湿度数据

---
## 示例程序
```python
# Python env   : MicroPython v1.23.0
# -*- coding: utf-8 -*-        
# @Time    : 2024/7/22 下午2:57   
# @Author  : 李清水            
# @File    : main.py       
# @Description : DHT11温湿度传感器类实验，使用单总线通信完成数据交互

# ======================================== 导入相关模块 ========================================

# 导入硬件相关的模块
from machine import Pin
# 导入时间相关的模块
import time
from dht11 import DHT11
# ======================================== 全局变量 ============================================

# 湿度数据
humidity = 0.0
# 温度数据
temperature = 0.0

# ======================================== 功能函数 ============================================

# ======================================== 自定义类 ============================================

# ======================================== 初始化配置 ==========================================

# 延时等待设备初始化
time.sleep(3)
# 打印调试信息
print('FreakStudio : Using OneWire to read DHT11 sensor')

# 延时1s，等待DHT11传感器上电完成
time.sleep(1)
# 初始化单总线通信引脚，下拉输出
DHT11_PIN = Pin(6, Pin.OUT, Pin.PULL_UP)
# 初始化DHT11实例
dht11 = DHT11(DHT11_PIN)

# ========================================  主程序  ============================================

while True:
    try:
        # 读取温湿度数据
        dht11.measure()
        # 读取温湿度数据
        temperature = dht11.temperature
        humidity = dht11.humidity
        # 打印温湿度数据
        print("temperature: {}℃, humidity: {}%".format(temperature, humidity))
        # 等待2秒
        time.sleep(2)
    except:
        pass

```
---

## 注意事项

### 电气特性限制

* **电源电压**：DHT11 工作电压范围 3.3V\~5.5V，推荐使用 5V 供电更稳定；若使用 3.3V 供电，需确保数据线电平匹配。
* **电流消耗**：典型工作电流约 0.5mA，最大不超过 2.5mA，通常可直接由开发板 GPIO 供电。
* **数据总线**：DHT11 使用单总线协议通信，数据线需要通过上拉电阻（通常 4.7KΩ\~10KΩ）连接到 VCC，否则可能无法正常输出数据。

### 硬件接线与配置注意事项

* **共地要求**：DHT11 的 GND 必须与开发板 GND 可靠连接，否则会导致通信失败或数据异常。
* **接线可靠性**：DHT11 模块引脚较细，面包板使用时需确保插接牢固；长期使用建议焊接杜邦线或插针。
* **GPIO 引脚选择**：数据线需接入支持输入/输出的 GPIO 引脚（如 Pico 的 GP13），不可接到专用 ADC 或仅支持输入的引脚。
* **线长限制**：DHT11 通信距离一般不超过 20cm，若线路过长需加粗导线或使用屏蔽线，避免信号畸变导致采集失败。

### 环境影响

* **温度限制**：DHT11 工作温度范围 0℃\~50℃，存储温度范围 -20℃\~60℃。超过范围可能导致数据严重漂移或器件损坏。
* **湿度限制**：工作湿度范围 20%\~90%RH（无冷凝），存储湿度范围 5%\~95%RH（无冷凝）。在冷凝环境下会导致数据异常甚至传感器永久损坏。
* **响应时间**：在空气流通性差的环境中（如封闭外壳），传感器响应会变慢，建议保证空气能够正常接触传感器。
* **污染与腐蚀防护**：传感器开口区域避免暴露在灰尘、油烟、腐蚀性气体中，否则可能导致探头失效。必要时可使用透气但防尘的保护罩。

---

### 联系方式
如有任何问题或需要帮助，请通过以下方式联系开发者：  
📧 **邮箱**：10696531183@qq.com  
💻 **GitHub**：[https://github.com/FreakStudioCN](https://github.com/FreakStudioCN)  

---
### 许可协议
本项目中，除 `machine` 等 MicroPython 官方模块（MIT 许可证）外，所有由作者编写的驱动与扩展代码均采用 **知识共享署名-非商业性使用 4.0 国际版 (CC BY-NC 4.0)** 许可协议发布。  

您可以自由地：  
- **共享** — 在任何媒介以任何形式复制、发行本作品  
- **演绎** — 修改、转换或以本作品为基础进行创作  

惟须遵守下列条件：  
- **署名** — 您必须给出适当的署名，提供指向本许可协议的链接，同时标明是否（对原始作品）作了修改。您可以用任何合理的方式来署名，但是不得以任何方式暗示许可人为您或您的使用背书。  
- **非商业性使用** — 您不得将本作品用于商业目的。  
- **合理引用方式** — 可在代码注释、文档、演示视频或项目说明中明确来源。  

**版权归 FreakStudio 所有。**