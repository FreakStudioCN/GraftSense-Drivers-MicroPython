# GraftSense SI5351 æ—¶é’Ÿä¿¡å·å‘ç”Ÿæ¨¡å— (MicroPython)

# GraftSense SI5351 æ—¶é’Ÿä¿¡å·å‘ç”Ÿæ¨¡å— (MicroPython)

## ç›®å½•

- [ç®€ä»‹](#ç®€ä»‹)
- [ä¸»è¦åŠŸèƒ½](#ä¸»è¦åŠŸèƒ½)
- [ç¡¬ä»¶è¦æ±‚](#ç¡¬ä»¶è¦æ±‚)
- [æ–‡ä»¶è¯´æ˜](#æ–‡ä»¶è¯´æ˜)
- [è½¯ä»¶è®¾è®¡æ ¸å¿ƒæ€æƒ³](#è½¯ä»¶è®¾è®¡æ ¸å¿ƒæ€æƒ³)
- [ä½¿ç”¨è¯´æ˜](#ä½¿ç”¨è¯´æ˜)
- [ç¤ºä¾‹ç¨‹åº](#ç¤ºä¾‹ç¨‹åº)
- [æ³¨æ„äº‹é¡¹](#æ³¨æ„äº‹é¡¹)
- [è”ç³»æ–¹å¼](#è”ç³»æ–¹å¼)
- [è®¸å¯åè®®](#è®¸å¯åè®®)

---

## ç®€ä»‹

æœ¬é¡¹ç›®ä¸º **GraftSense SI5351-based Clock Signal Generator Module V1.0** æä¾›äº†å®Œæ•´çš„ MicroPython é©±åŠ¨æ”¯æŒï¼ŒåŸºäº SI5351 èŠ¯ç‰‡å®ç°é«˜ç²¾åº¦ã€å¯ç¼–ç¨‹å¤šé€šé“æ—¶é’Ÿä¿¡å·ç”Ÿæˆã€‚æ¨¡å—é€šè¿‡ I2C æ¥å£é…ç½® PLL å€é¢‘ä¸ Multisynth åˆ†é¢‘ï¼Œæ”¯æŒ 4kHz~200MHz é¢‘ç‡è¾“å‡ºï¼Œæä¾› 3 è·¯ SMA æ¥å£è¾“å‡ºæ—¶é’Ÿä¿¡å·ï¼Œé€‚ç”¨äºç”µå­ DIY å®éªŒã€æ•°å­—ç”µè·¯æ—¶åºæ¼”ç¤ºã€åˆ›å®¢é¡¹ç›®ç­‰åœºæ™¯ï¼Œå…·æœ‰é¢‘ç‡ç¨³å®šã€å¯ç¼–ç¨‹ã€å¤šé€šé“è¾“å‡ºã€é«˜ç²¾åº¦çš„ä¼˜åŠ¿ï¼Œéµå¾ª Grove æ¥å£æ ‡å‡†ã€‚

---

## ä¸»è¦åŠŸèƒ½

- âœ… **I2C é€šä¿¡**ï¼šæ”¯æŒæ ‡å‡† I2C æ¥å£ï¼Œé»˜è®¤åœ°å€ 0x60ï¼Œå…¼å®¹ 3.3V/5V ç”µå¹³
- âœ… **PLL é…ç½®**ï¼šæ”¯æŒä¸¤è·¯ PLLï¼ˆPLLA/PLLBï¼‰å€é¢‘ï¼Œæ•´æ•°å€é¢‘èŒƒå›´ 15~90ï¼Œæ”¯æŒåˆ†æ•°å€é¢‘ï¼ˆåˆ†å­ 0~1048574ï¼Œåˆ†æ¯ 1~1048575ï¼‰
- âœ… **Multisynth åˆ†é¢‘**ï¼šæ”¯æŒ 3 è·¯è¾“å‡ºé€šé“çš„ Multisynth åˆ†é¢‘ï¼Œæ•´æ•°åˆ†é¢‘å› å­ 4~2047ï¼Œæ”¯æŒåˆ†æ•°åˆ†é¢‘ä¸é™„åŠ  2^rdiv åˆ†é¢‘ï¼ˆrdiv 0~7ï¼‰
- âœ… **è¾“å‡ºæ§åˆ¶**ï¼šæ”¯æŒé€šé“ä½¿èƒ½ / ç¦ç”¨ï¼Œå¯è®¾ç½®è¾“å‡ºé©±åŠ¨å¼ºåº¦ï¼ˆ2/4/6/8 mAï¼‰ã€ç›¸ä½åç§»ï¼ˆ0~255 ticksï¼‰ã€æ­£äº¤è¾“å‡ºä¸åç›¸è¾“å‡º
- âœ… **ç¦ç”¨çŠ¶æ€é…ç½®**ï¼šå¯è®¾ç½®è¾“å‡ºç¦ç”¨æ—¶çš„çŠ¶æ€ï¼ˆä½ç”µå¹³ / é«˜ç”µå¹³ / é«˜é˜» / æ°¸ä¸ç¦ç”¨ï¼‰
- âœ… **OEB å¼•è„šæ§åˆ¶**ï¼šæ”¯æŒå±è”½ OEB å¼•è„šå¯¹è¾“å‡ºé€šé“çš„æ§åˆ¶ï¼Œæå‡çµæ´»æ€§
- âœ… **é¢‘ç‡è®¾ç½®æ¨¡å¼**ï¼šæä¾›å›ºå®š PLL è°ƒæ•´åˆ†é¢‘ï¼ˆ`set_freq_fixedpll`ï¼‰å’Œå›ºå®šåˆ†é¢‘è°ƒæ•´ PLLï¼ˆ`set_freq_fixedms`ï¼‰ä¸¤ç§é¢‘ç‡é…ç½®æ–¹å¼
- âœ… **å‚æ•°æ ¡éªŒ**ï¼šå†…ç½®ä¸¥æ ¼çš„ç±»å‹ä¸èŒƒå›´æ ¡éªŒï¼Œé¿å…éæ³•é…ç½®å¯¼è‡´èŠ¯ç‰‡å·¥ä½œå¼‚å¸¸

---

## ç¡¬ä»¶è¦æ±‚

1. **æ ¸å¿ƒç¡¬ä»¶**ï¼šGraftSense SI5351-based Clock Signal Generator Module V1.0ï¼ˆåŸºäº SI5351 èŠ¯ç‰‡ï¼Œå†…ç½® DC-DC 5V è½¬ 3.3V ç”µè·¯ï¼Œ3 è·¯ SMA è¾“å‡ºæ¥å£ï¼‰
2. **ä¸»æ§è®¾å¤‡**ï¼šæ”¯æŒ MicroPython v1.23.0 åŠä»¥ä¸Šç‰ˆæœ¬çš„å¼€å‘æ¿ï¼ˆå¦‚æ ‘è“æ´¾ Picoã€ESP32 ç­‰ï¼‰
3. **æ¥çº¿é…ä»¶**ï¼š

   - Grove 4Pin çº¿æˆ–æœé‚¦çº¿ï¼šè¿æ¥æ¨¡å—çš„ SDAã€SCLã€GNDã€VCC å¼•è„š
   - åŒè½´ç”µç¼†ï¼šSMA è½¬ BNC æˆ– SMA è½¬ SMA çº¿ç¼†ï¼Œç”¨äºè¾“å‡ºæ—¶é’Ÿä¿¡å·
4. **ç”µæº**ï¼š3.3V~5V ç¨³å®šç”µæºï¼ˆæ¨¡å—å†…ç½®ç”µå¹³è½¬æ¢ç”µè·¯ï¼Œå…¼å®¹ä¸¤ç§ä¾›ç”µæ–¹å¼ï¼‰

---

## æ–‡ä»¶è¯´æ˜

---

## è½¯ä»¶è®¾è®¡æ ¸å¿ƒæ€æƒ³

1. **åˆ†å±‚æ¶æ„**ï¼šåº•å±‚å°è£… I2C è¯»å†™æ“ä½œï¼ˆ`_read`/`_write`/`_read_bulk`/`_write_bulk`ï¼‰ï¼Œä¸Šå±‚æä¾› PLL/Multisynth é…ç½®ã€è¾“å‡ºæ§åˆ¶ç­‰é«˜å±‚ APIï¼Œåˆ†ç¦»ç¡¬ä»¶æ“ä½œä¸ä¸šåŠ¡é€»è¾‘
2. **å‚æ•°æ ¡éªŒä¸å®¹é”™**ï¼šå¯¹æ‰€æœ‰é…ç½®å‚æ•°è¿›è¡Œä¸¥æ ¼çš„ç±»å‹æ£€æŸ¥ï¼ˆå¦‚ int/bool æ ¡éªŒï¼‰ä¸èŒƒå›´æ ¡éªŒï¼ˆå¦‚ PLL å€é¢‘ 15~90ã€åˆ†é¢‘å› å­ 4~2047ï¼‰ï¼Œé¿å…éæ³•å‚æ•°å¯¼è‡´èŠ¯ç‰‡å¼‚å¸¸
3. **çŠ¶æ€ç¼“å­˜æœºåˆ¶**ï¼šç¼“å­˜ PLL VCO é¢‘ç‡ã€Multisynth åˆ†é¢‘å› å­ã€è¾“å‡ºé€šé“é…ç½®ï¼ˆPLL é€‰æ‹©ã€é©±åŠ¨å¼ºåº¦ã€ç›¸ä½ç­‰ï¼‰ï¼Œé¿å…é‡å¤è¯»å–å¯„å­˜å™¨ï¼Œæå‡æ•ˆç‡
4. **åˆ†æ•°é€¼è¿‘ç®—æ³•**ï¼šå†…ç½®åŸºäºè¿åˆ†æ•°çš„åˆ†æ•°é€¼è¿‘ç®—æ³•ï¼ˆ`approximate_fraction`ï¼‰ï¼Œå°†ç›®æ ‡é¢‘ç‡è½¬æ¢ä¸ºèŠ¯ç‰‡æ”¯æŒçš„åˆ†æ•°åˆ†é¢‘ / å€é¢‘å‚æ•°ï¼Œæå‡é¢‘ç‡ç²¾åº¦
5. **ä¸­æ–­å®‰å…¨è®¾è®¡**ï¼šæ‰€æœ‰ I2C æ“ä½œå‡åœ¨ä¸»å¾ªç¯ä¸Šä¸‹æ–‡æ‰§è¡Œï¼Œé¿å…åœ¨ä¸­æ–­æœåŠ¡ç¨‹åºï¼ˆISRï¼‰ä¸­è°ƒç”¨é©±åŠ¨æ–¹æ³•ï¼Œç¡®ä¿ç³»ç»Ÿç¨³å®šæ€§
6. **å¯æ‰©å±•æ€§**ï¼šæ”¯æŒæ™¶æŒ¯é¢‘ç‡ã€è´Ÿè½½ç”µå®¹ã€I2C åœ°å€ç­‰å‚æ•°è‡ªå®šä¹‰ï¼Œé€‚é…ä¸åŒç¡¬ä»¶ç‰ˆæœ¬

---

## ä½¿ç”¨è¯´æ˜

### ç¯å¢ƒå‡†å¤‡

- åœ¨å¼€å‘æ¿ä¸Šçƒ§å½• **MicroPython v1.23.0+** å›ºä»¶
- å°† `silicon5351.py` å’Œ `main.py` ä¸Šä¼ è‡³å¼€å‘æ¿æ–‡ä»¶ç³»ç»Ÿ

### ç¡¬ä»¶è¿æ¥

- ä½¿ç”¨ Grove çº¿æˆ–æœé‚¦çº¿å°†æ¨¡å—çš„ **SDA** å¼•è„šè¿æ¥è‡³å¼€å‘æ¿æŒ‡å®š GPIO å¼•è„šï¼ˆå¦‚æ ‘è“æ´¾ Pico çš„ GP4ï¼‰
- å°†æ¨¡å—çš„ **SCL** å¼•è„šè¿æ¥è‡³å¼€å‘æ¿æŒ‡å®š GPIO å¼•è„šï¼ˆå¦‚æ ‘è“æ´¾ Pico çš„ GP5ï¼‰
- è¿æ¥ `GND` å’Œ `VCC` å¼•è„šï¼Œç¡®ä¿ 3.3V~5V ä¾›ç”µç¨³å®š
- ä½¿ç”¨åŒè½´ç”µç¼†è¿æ¥æ¨¡å—çš„ SMA è¾“å‡ºæ¥å£ï¼ˆå¦‚ CLK0ï¼‰è‡³æµ‹è¯•è®¾å¤‡ï¼ˆå¦‚ç¤ºæ³¢å™¨ï¼‰

### ä»£ç é…ç½®

```python
from machine import Pin, I2C
from silicon5351 import SI5351_I2C

# åˆå§‹åŒ– I2C æ€»çº¿ï¼ˆæ ‘è“æ´¾ Pico I2C0ï¼ŒSDA=GP4ï¼ŒSCL=GP5ï¼Œé¢‘ç‡ 100kHzï¼‰
i2c = I2C(0, scl=Pin(5), sda=Pin(4), freq=100000)

# åˆå§‹åŒ– SI5351 èŠ¯ç‰‡ï¼ˆæ™¶æŒ¯ 25MHzï¼Œè´Ÿè½½ 10pFï¼ŒI2C åœ°å€ 0x60ï¼‰
si = SI5351_I2C(i2c, crystal=25e6, load=SI5351_I2C.SI5351_CRYSTAL_LOAD_10PF)

# é…ç½® PLL0ï¼ˆPLLAï¼‰å€é¢‘ï¼š25MHz * 15 = 375MHz
si.setup_pll(pll=0, mul=15)

# åˆå§‹åŒ–è¾“å‡ºé€šé“ 0ï¼Œä½¿ç”¨ PLL0ï¼Œé©±åŠ¨å¼ºåº¦ 8mAï¼Œä¸å¯ç”¨æ­£äº¤/åç›¸è¾“å‡º
si.init_clock(output=0, pll=0, drive_strength=SI5351_I2C.SI5351_CLK_DRIVE_STRENGTH_8MA)

# è®¾ç½®è¾“å‡ºé¢‘ç‡ï¼šåŸºäºå›ºå®š PLL0ï¼Œåˆ†é¢‘å¾—åˆ° 2MHz è¾“å‡º
si.set_freq_fixedpll(output=0, freq=2.0e6)
```

### è¿è¡Œæµ‹è¯•

- é‡å¯å¼€å‘æ¿ï¼Œ`main.py` å°†è‡ªåŠ¨æ‰§è¡Œï¼š

  - é…ç½® PLL0 ä¸º 375MHz
  - è®¾ç½®é€šé“ 0 è¾“å‡º 2MHz æ—¶é’Ÿå¹¶ä½¿èƒ½
  - ä¿æŒè¾“å‡º 20 ç§’åè‡ªåŠ¨ç¦ç”¨é€šé“ 0
- ä½¿ç”¨ç¤ºæ³¢å™¨è§‚å¯Ÿ SMA è¾“å‡ºæ¥å£çš„æ—¶é’Ÿä¿¡å·ï¼ŒéªŒè¯é¢‘ç‡ä¸æ³¢å½¢æ˜¯å¦ç¬¦åˆé¢„æœŸ

---

## ç¤ºä¾‹ç¨‹åº

```python
from machine import Pin, I2C
import time
from silicon5351 import SI5351_I2C

# å…¨å±€é…ç½®
crystal = 25e6    # æ™¶æŒ¯é¢‘ç‡ 25MHz
mul = 15           # PLL å€é¢‘ç³»æ•°ï¼ˆ25MHz * 15 = 375MHzï¼‰
freq = 2.0e6       # ç›®æ ‡è¾“å‡ºé¢‘ç‡ 2MHz
quadrature = True  # æ­£äº¤è¾“å‡ºæ ‡å¿—
invert = False     # åç›¸è¾“å‡ºæ ‡å¿—

# ä¸Šç”µå»¶æ—¶
time.sleep(3)
print("FreakStudio: Use silicon5351 to output clock signals.")

# åˆå§‹åŒ– I2C
i2c = I2C(0, scl=Pin(5), sda=Pin(4), freq=100000)

# åˆå§‹åŒ– SI5351
si = SI5351_I2C(i2c, crystal=crystal)

# é…ç½® PLL0
si.setup_pll(pll=0, mul=mul)

# åˆå§‹åŒ–è¾“å‡ºé€šé“ 0
si.init_clock(output=0, pll=0)

# è®¾ç½®è¾“å‡ºé¢‘ç‡
si.set_freq_fixedpll(output=0, freq=freq)

# ä½¿èƒ½è¾“å‡ºé€šé“ 0
si.enable_output(output=0)
print(f'done freq={freq} mul={mul} quadrature={quadrature} invert={invert}')

# ä¿æŒè¾“å‡º 20 ç§’
time.sleep(20)

# ç¦ç”¨è¾“å‡ºé€šé“ 0
si.disable_output(output=0)
```

---

## æ³¨æ„äº‹é¡¹

1. **I2C åœ°å€**ï¼šæ¨¡å—é»˜è®¤ I2C åœ°å€ä¸º 0x60ï¼Œè‹¥å­˜åœ¨åœ°å€å†²çªï¼Œå¯é€šè¿‡ç¡¬ä»¶ä¿®æ”¹ï¼ˆéœ€å‚è€ƒæ¨¡å—åŸç†å›¾ï¼‰
2. **æ™¶æŒ¯é…ç½®**ï¼šé©±åŠ¨é»˜è®¤æ™¶æŒ¯é¢‘ç‡ä¸º 25MHzï¼Œè‹¥ä½¿ç”¨å…¶ä»–é¢‘ç‡æ™¶æŒ¯ï¼Œéœ€åœ¨åˆå§‹åŒ–æ—¶ä¿®æ”¹ `crystal` å‚æ•°ï¼Œå¹¶ç¡®ä¿æ™¶æŒ¯è´Ÿè½½ç”µå®¹ï¼ˆ6/8/10pFï¼‰ä¸ç¡¬ä»¶åŒ¹é…
3. **é¢‘ç‡èŒƒå›´**ï¼š

   - PLL VCO é¢‘ç‡èŒƒå›´ï¼š600MHz~900MHzï¼ˆç”±æ™¶æŒ¯ä¸å€é¢‘ç³»æ•°å†³å®šï¼Œéœ€æ»¡è¶³ `crystal * (mul + num/denom) âˆˆ [600e6, 900e6]`ï¼‰
   - è¾“å‡ºé¢‘ç‡èŒƒå›´ï¼šæœ€å° 4kHzï¼ˆç”± PLL é¢‘ç‡ä¸æœ€å¤§åˆ†é¢‘å†³å®šï¼‰ï¼Œæœ€å¤§ 200MHzï¼ˆç”±èŠ¯ç‰‡è§„æ ¼å†³å®šï¼‰
4. **PLL ä¸ Multisynth é™åˆ¶**ï¼š

   - PLL å€é¢‘ç³»æ•°ï¼šæ•´æ•°éƒ¨åˆ† 15~90ï¼Œåˆ†æ•°éƒ¨åˆ†åˆ†å­ 0~1048574ï¼Œåˆ†æ¯ 1~1048575
   - Multisynth åˆ†é¢‘å› å­ï¼šæ•´æ•°éƒ¨åˆ† 4~2047ï¼Œåˆ†æ•°éƒ¨åˆ†åŒ PLLï¼Œé™„åŠ  rdiv åˆ†é¢‘ 0~7ï¼ˆå³ 2^0~2^7 åˆ†é¢‘ï¼‰
5. **SMA æ¥å£è¦æ±‚**ï¼šè¾“å‡ºæ—¶é’Ÿä¿¡å·éœ€ä½¿ç”¨ 50Î© åŒè½´ç”µç¼†ï¼Œé¿å…ä¿¡å·åå°„ä¸è¡°å‡ï¼Œå»ºè®®ä½¿ç”¨ SMA è½¬ BNC çº¿ç¼†è¿æ¥æµ‹è¯•è®¾å¤‡
6. **ç¦ç”¨çŠ¶æ€è®¾ç½®**ï¼šé€šè¿‡ `disabled_states` æ–¹æ³•è®¾ç½®è¾“å‡ºç¦ç”¨æ—¶çš„çŠ¶æ€ï¼Œéœ€æ³¨æ„é«˜é˜»çŠ¶æ€å¯èƒ½å¯¼è‡´æµ‹è¯•è®¾å¤‡è¯¯åˆ¤
7. **ç”µæºæ»¤æ³¢**ï¼šæ¨¡å—å†…ç½®ç”µæºæ»¤æ³¢ç”µè·¯ï¼Œè‹¥ä½¿ç”¨é«˜é¢‘ç‡è¾“å‡ºï¼ˆ>100MHzï¼‰ï¼Œå»ºè®®é¢å¤–å¢åŠ ç”µæºå»è€¦ç”µå®¹ï¼Œæå‡ä¿¡å·è´¨é‡
8. **ä¸­æ–­å®‰å…¨**ï¼šé©±åŠ¨æ‰€æœ‰ I2C æ“ä½œå‡åœ¨ä¸»å¾ªç¯æ‰§è¡Œï¼Œç¦æ­¢åœ¨ ISR ä¸­è°ƒç”¨é©±åŠ¨æ–¹æ³•ï¼Œé¿å…æ—¶åºé”™ä¹±

---

## è”ç³»æ–¹å¼

å¦‚æœ‰ä»»ä½•é—®é¢˜æˆ–éœ€è¦å¸®åŠ©ï¼Œè¯·é€šè¿‡ä»¥ä¸‹æ–¹å¼è”ç³»å¼€å‘è€…ï¼š

ğŸ“§ **é‚®ç®±**ï¼šliqinghsui@freakstudio.cn

ğŸ’» **GitHub**ï¼š[https://github.com/FreakStudioCN](https://github.com/FreakStudioCN)

---

## è®¸å¯åè®®

```
MIT License

Copyright (c) 2026 FreakStudio

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in all
copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
SOFTWARE.
```